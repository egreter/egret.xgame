window.xgame={};var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__decorate=this&&this.__decorate||function(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();var __awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{h(i.next(t))}catch(t){o(t)}}function a(t){try{h(i.throw(t))}catch(t){o(t)}}function h(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=i[2&o[0]?"return":o[0]?"throw":"next"])&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[0,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};!function(t){t.getQualifiedClassName=function(t){var e=typeof t;if(!t||"object"!=e&&!t.prototype)return e;var n=t.prototype?t.prototype:Object.getPrototypeOf(t);if(!n)return e;if(n.hasOwnProperty("__class__"))return n.__class__;var i=n.constructor.toString().trim(),r=i.indexOf("("),o=i.substring(9,r);return Object.defineProperty(n,"__class__",{value:o,enumerable:!1,writable:!0}),o}}(xgame||(xgame={})),function(t){t.impl=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n=e.prototype?e.prototype:Object.getPrototypeOf(e);Object.defineProperty(n,"__implements__",{value:t,enumerable:!1,writable:!1})}}}(xgame||(xgame={})),function(t){t.IXObject=Symbol.for("IXObject")}(xgame||(xgame={})),function(t){function e(e){var n=t.hashCount++;return e&&null==e.hashCode&&(e.hashCode=n),n}t.hashCount=1,t.generateHashCode=e;var n=function(){function n(){this.$hashCode=0,this.$hashCode=e()}return Object.defineProperty(n.prototype,"hashCode",{get:function(){return this.$hashCode},enumerable:!0,configurable:!0}),n.prototype.toString=function(){return"{0}({1})".format(t.getQualifiedClassName(this),this.hashCode)},n=__decorate([t.impl(t.IXObject),__metadata("design:paramtypes",[])],n)}();t.XObject=n,__reflect(n.prototype,"xgame.XObject",["xgame.IXObject"])}(xgame||(xgame={})),function(t){t.IXGame=Symbol.for("IXGame")}(xgame||(xgame={})),function(t){t.IXBootstrap=Symbol.for("IXBootstrap")}(xgame||(xgame={})),function(t){t.IServiceProvider=Symbol.for("IServiceProvider")}(xgame||(xgame={})),function(t){t.IDisposable=Symbol.for("IDisposable")}(xgame||(xgame={})),function(t){var e;!function(t){t[t.None=0]="None",t[t.Limit=1]="Limit",t[t.Times=2]="Times"}(e||(e={}));var n=function(n){function i(t,i,r,o){void 0===o&&(o=0);var s=n.call(this)||this;return s.manager=t,s.action=i,s.thisObject=r,s.order=o,s.timeout=0,s.timer=0,s.times=0,s.mode=e.None,s}return __extends(i,n),i.prototype.setTimeout=function(t,n){void 0===n&&(n=0),this.timeout=t,this.timer=t,n>0?(this.mode=e.Times,this.times=n):(this.mode=e.Limit,this.times=0)},i.prototype.execute=function(){this.mode==e.None?this.action&&this.action.apply(this.thisObject):(this.timer-=t.Time.Instance().deltaTime,this.timer<=0&&(this.action&&this.action.apply(this.thisObject),this.timer+=this.timeout,this.mode==e.Times&&(this.times--,this.times<=0&&this.unregister())))},i.prototype.unregister=function(){this.manager.removeUpdate(this.hashCode)},i.prototype.dispose=function(){this.action=void 0,this.thisObject=void 0},i=__decorate([t.impl(t.IDisposable),__metadata("design:paramtypes",[Object,Function,Object,Number])],i)}(t.XObject);t.Scheduler=n,__reflect(n.prototype,"xgame.Scheduler",["xgame.IDisposable"])}(xgame||(xgame={})),function(t){t.ISchedulerManager=Symbol.for("ISchedulerManager")}(xgame||(xgame={})),function(t){t.isObj=function(t){return!!t&&"object"==typeof t},t.negate=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return!t.apply(void 0,e)}},t.composeComparers=function(t,e){return function(n,i){return t(n,i)||e(n,i)}},t.keyComparer=function(t,e){return function(n,i){var r=t(n),o=t(i);return r>o?e?-1:1:r<o?e?1:-1:0}}}(xgame||(xgame={})),function(t){var e=function(e){function i(t){void 0===t&&(t=[]);var n=e.call(this)||this;return n._elements=t,n}return __extends(i,e),i.prototype.add=function(t){this._elements.push(t)},i.prototype.append=function(t){this.add(t)},i.prototype.prepend=function(t){this._elements.unshift(t)},i.prototype.addRange=function(t){var e;(e=this._elements).push.apply(e,t)},i.prototype.aggregate=function(t,e){return this._elements.reduce(t,e)},i.prototype.all=function(t){return this._elements.every(t)},i.prototype.any=function(t){return t?this._elements.some(t):this._elements.length>0},i.prototype.average=function(t){return this.sum(t)/this.count(t)},i.prototype.cast=function(){return new i(this._elements)},i.prototype.clear=function(){this._elements.length=0},i.prototype.concat=function(t){return new i(this._elements.concat(t.toArray()))},i.prototype.contains=function(t){return this.any(function(e){return e===t})},i.prototype.count=function(t){return t?this.where(t).count():this._elements.length},i.prototype.defaultIfEmpty=function(t){return this.count()?this:new i([t])},i.prototype.distinctBy=function(t){var e=this.groupBy(t);return Object.keys(e).reduce(function(t,n){return t.add(e[n][0]),t},new i)},i.prototype.elementAt=function(t){if(t<this.count()&&t>=0)return this._elements[t];throw new Error("ArgumentOutOfRangeException: index is less than 0 or greater than or equal to the number of elements in source.")},i.prototype.elementAtOrDefault=function(t){return t<this.count()&&t>=0?this._elements[t]:void 0},i.prototype.except=function(t){return this.where(function(e){return!t.contains(e)})},i.prototype.first=function(t){if(this.count())return t?this.where(t).first():this._elements[0];throw new Error("InvalidOperationException: The source sequence is empty.")},i.prototype.firstOrDefault=function(t){return this.count(t)?this.first(t):void 0},i.prototype.forEach=function(t){return this._elements.forEach(t)},i.prototype.every=function(t){return this._elements.every(t)},i.prototype.filter=function(t){return this._elements.filter(t)},i.prototype.groupBy=function(t,e){void 0===e&&(e=function(t){return t});return this.aggregate(function(n,i){var r=t(i),o=n[r],s=e(i);return o?o.push(s):n[r]=[s],n},{})},i.prototype.groupJoin=function(t,e,n,i){return this.select(function(r){return i(r,t.where(function(t){return e(r)===n(t)}))})},i.prototype.indexOf=function(t){return this._elements.indexOf(t)},i.prototype.insert=function(t,e){if(t<0||t>this._elements.length)throw new Error("Index is out of range.");this._elements.splice(t,0,e)},i.prototype.intersect=function(t){return this.where(function(e){return t.contains(e)})},i.prototype.join=function(t,e,n,i){return this.selectMany(function(r){return t.where(function(t){return n(t)===e(r)}).select(function(t){return i(r,t)})})},i.prototype.last=function(t){if(this.count())return t?this.where(t).last():this._elements[this.count()-1];throw Error("InvalidOperationException: The source sequence is empty.")},i.prototype.lastOrDefault=function(t){return this.count(t)?this.last(t):void 0},i.prototype.max=function(t){return Math.max.apply(Math,this._elements.map(t||function(t){return t}))},i.prototype.min=function(t){return Math.min.apply(Math,this._elements.map(t||function(t){return t}))},i.prototype.ofType=function(t){var e;switch(t){case Number:e="number";break;case String:e="string";break;case Boolean:e=typeof!0;break;case Function:e="function";break;default:e=null}return null===e?this.where(function(e){return e instanceof t}).cast():this.where(function(t){return typeof t===e}).cast()},i.prototype.orderBy=function(e,i){return void 0===i&&(i=t.keyComparer(e,!1)),new n(this._elements,i)},i.prototype.orderByDescending=function(e,i){return void 0===i&&(i=t.keyComparer(e,!0)),new n(this._elements,i)},i.prototype.thenBy=function(t){return this.orderBy(t)},i.prototype.thenByDescending=function(t){return this.orderByDescending(t)},i.prototype.remove=function(t){return-1!==this.indexOf(t)&&(this.removeAt(this.indexOf(t)),!0)},i.prototype.removeAll=function(e){return this.where(t.negate(e))},i.prototype.removeAt=function(t){this._elements.splice(t,1)},i.prototype.reverse=function(){return new i(this._elements.reverse())},i.prototype.select=function(t){return new i(this._elements.map(t))},i.prototype.selectMany=function(t){var e=this;return this.aggregate(function(n,i,r){return n.addRange(e.select(t).elementAt(r).toArray()),n},new i)},i.prototype.sequenceEqual=function(t){return this.all(function(e){return t.contains(e)})},i.prototype.single=function(t){if(1!==this.count(t))throw new Error("The collection does not contain exactly one element.");return this.first(t)},i.prototype.singleOrDefault=function(t){return this.count(t)?this.single(t):void 0},i.prototype.skip=function(t){return new i(this._elements.slice(Math.max(0,t)))},i.prototype.skipLast=function(t){return new i(this._elements.slice(0,-Math.max(0,t)))},i.prototype.skipWhile=function(t){var e=this;return this.skip(this.aggregate(function(n){return t(e.elementAt(n))?++n:n},0))},i.prototype.sum=function(t){return t?this.select(t).sum():this.aggregate(function(t,e){return t+ +e},0)},i.prototype.take=function(t){return new i(this._elements.slice(0,Math.max(0,t)))},i.prototype.takeLast=function(t){return new i(this._elements.slice(-Math.max(0,t)))},i.prototype.takeWhile=function(t){var e=this;return this.take(this.aggregate(function(n){return t(e.elementAt(n))?++n:n},0))},i.prototype.toArray=function(){return this._elements},i.prototype.toDictionary=function(t,e){var n=this;return this.aggregate(function(i,r,o){return i[n.select(t).elementAt(o).toString()]=e?n.select(e).elementAt(o):r,i.add({Key:n.select(t).elementAt(o),Value:e?n.select(e).elementAt(o):r}),i},new i)},i.prototype.toSet=function(){for(var t=new Set,e=0,n=this._elements;e<n.length;e++){var i=n[e];t.add(i)}return t},i.prototype.toList=function(){return this},i.prototype.toLookup=function(t,e){return this.groupBy(t,e)},i.prototype.where=function(t){return new i(this._elements.filter(t))},i.prototype.zip=function(t,e){var n=this;return t.count()<this.count()?t.select(function(t,i){return e(n.elementAt(i),t)}):this.select(function(n,i){return e(n,t.elementAt(i))})},i}(t.XObject);t.List=e,__reflect(e.prototype,"xgame.List");var n=function(e){function n(t,n){var i=e.call(this,t)||this;return i._comparer=n,i._elements.sort(i._comparer),i}return __extends(n,e),n.prototype.thenBy=function(e){return new n(this._elements,t.composeComparers(this._comparer,t.keyComparer(e,!1)))},n.prototype.thenByDescending=function(e){return new n(this._elements,t.composeComparers(this._comparer,t.keyComparer(e,!0)))},n}(e);t.OrderedList=n,__reflect(n.prototype,"xgame.OrderedList")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.Instance=function(){return this.instance||(this.instance=new this),this.instance},e}(t.XObject);t.Singleton=e,__reflect(e.prototype,"xgame.Singleton")}(xgame||(xgame={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.deltaTime=0,e.timeScale=1,e.passedTime=0,e}return __extends(e,t),e.prototype.getTimeStamp=function(){return(new Date).valueOf()},e}(t.Singleton);t.Time=e,__reflect(e.prototype,"xgame.Time")}(xgame||(xgame={})),function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.$preUpdateItems=new Map,n.$preUpdateIndexes=new t.List,n.$updateItems=new Map,n.$updateIndexes=new t.List,n.$postUpdateItems=new Map,n.$postUpdateIndexes=new t.List,n}return __extends(n,e),n.prototype.tick=function(e){var n=this;t.__lockobject__(this).simple(function(){var i=t.Time.Instance();i.deltaTime=i.timeScale*e,i.passedTime+=i.deltaTime;var r=0,o=0,s=0;for(o=n.$preUpdateIndexes.count(),r=0;r<o;r++)s=n.$preUpdateIndexes.elementAt(r),n.$preUpdateItems.get(s).execute();for(o=n.$updateIndexes.count(),r=0;r<o;r++)s=n.$updateIndexes.elementAt(r),n.$updateItems.get(s).execute();for(o=n.$postUpdateIndexes.count(),r=0;r<o;r++)s=n.$postUpdateIndexes.elementAt(r),n.$postUpdateItems.get(s).execute()},this)},n.prototype.registerPreUpdate=function(t,e,n){return void 0===n&&(n=0),this.$register(1,t,e,n)},n.prototype.removePreUpdate=function(t){var e=t;"number"!=typeof t&&(e=t.hashCode),this.$remove(1,e)},n.prototype.registerUpdate=function(t,e,n){return void 0===n&&(n=0),this.$register(2,t,e,n)},n.prototype.removeUpdate=function(t){var e=t;"number"!=typeof t&&(e=t.hashCode),this.$remove(2,e)},n.prototype.registerPostUpdate=function(t,e,n){return void 0===n&&(n=0),this.$register(3,t,e,n)},n.prototype.removePostUpdate=function(t){var e=t;"number"!=typeof t&&(e=t.hashCode),this.$remove(3,e)},n.prototype.registerTimer=function(t,e,n,i,r){var o=this.$register(2,e,n,r);return o.setTimeout(t,i),o},n.prototype.removeTimer=function(t){var e=t;"number"!=typeof t&&(e=t.hashCode),this.$remove(2,e)},n.prototype.$register=function(e,n,i,r){var o=this;void 0===r&&(r=0);var s=new t.Scheduler(this,n,i,r);return t.__lockobject__(this).simple(function(){var t,n;if(1==e?(t=o.$preUpdateIndexes,n=o.$preUpdateItems):3==e?(t=o.$postUpdateIndexes,n=o.$postUpdateItems):(t=o.$updateIndexes,n=o.$updateItems),n.set(s.hashCode,s),r){var i=o.getInsertIndex(1,r);t.insert(i,s.hashCode)}else t.append(s.hashCode)},this),s},n.prototype.$remove=function(e,n){var i=this;t.__lockobject__(this).simple(function(){var t,r;(1==e?(t=i.$preUpdateIndexes,r=i.$preUpdateItems):3==e?(t=i.$postUpdateIndexes,r=i.$postUpdateItems):(t=i.$updateIndexes,r=i.$updateItems),t.contains(n)&&t.remove(n),r.has(n))&&(r.get(n).dispose(),r.delete(n))},this)},n.prototype.getInsertIndex=function(t,e){var n,i;void 0===e&&(e=0),1==t?(n=this.$preUpdateIndexes,i=this.$preUpdateItems):3==t?(n=this.$postUpdateIndexes,i=this.$postUpdateItems):(n=this.$updateIndexes,i=this.$updateItems);var r,o=0,s=0;if(0==(r=n.count()))return 0;for(o=0;o<r;o++)if(s=n.elementAt(o),i.get(s),e>e)return o;return r-1},n=__decorate([t.impl(t.ISchedulerManager),__metadata("design:paramtypes",[])],n)}(t.Singleton);t.SchedulerManager=e,__reflect(e.prototype,"xgame.SchedulerManager",["xgame.ISchedulerManager"])}(xgame||(xgame={})),function(t){t.that=null;var e=function(e){function n(n){var i=e.call(this)||this;if(i.bootstrap=n,i.$inited=!1,i.providers=[],t.that)throw new Error("引擎只能实例化一个对象");return t.that=i,i.container=t.ServiceContainer.Instance(),i}return __extends(n,e),n.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){switch(i.label){case 0:if(this.$inited)return[2];console.log("[XGame]: 框架初始化..."),this.registerServiceProvider(new t.XProvider),this.providers.sort(function(t,e){return t.priority>e.priority?-1:t.priority<e.priority?1:0}),e=0,i.label=1;case 1:return e<this.providers.length?[4,(n=this.providers[e]).onInit(this)]:[3,4];case 2:if(!i.sent())throw new Error("[IServiceProvider]: 初始化"+t.getQualifiedClassName(n)+"发生错误.");console.log("[IServiceProvider]: "+t.getQualifiedClassName(n)+"初始化."),i.label=3;case 3:return e++,[3,1];case 4:for(e=0;e<this.providers.length;e++)(n=this.providers[e]).onServiceRegister(this);this.bootstrap.onInit(this),console.log("[IXBootstrap]: {0}初始化.".format(t.getQualifiedClassName(this.bootstrap))),e=0,i.label=5;case 5:return e<this.providers.length?[4,(n=this.providers[e]).onStart(this)]:[3,8];case 6:if(!i.sent())throw new Error("[IServiceProvider]: 启动{0}错误.".format(t.getQualifiedClassName(n)));console.log("[IServiceProvider]: {0}已启动.".format(t.getQualifiedClassName(n))),i.label=7;case 7:return e++,[3,5];case 8:return this.bootstrap.onStart(this),console.log("[IXBootstrap]: {0}已启动.".format(t.getQualifiedClassName(this.bootstrap))),this.$inited=!0,console.log("[XGame]: 框架启动完成."),[2]}})})},n.prototype.tick=function(e){t.SchedulerManager.Instance().tick(e)},n.prototype.singleton=function(t,e){return this.container.singleton(t,e)},n.prototype.getService=function(t){return this.container.getService(t)},n.prototype.registerServiceProvider=function(t){return this.providers.push(t),this},n=__decorate([t.impl(t.IXGame),__metadata("design:paramtypes",[Object])],n)}(t.XObject);t.XGame=e,__reflect(e.prototype,"xgame.XGame",["xgame.IXGame"])}(xgame||(xgame={})),function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.priority=99999,t}return __extends(n,e),n.prototype.onInit=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,!0]})})},n.prototype.onStart=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){return e.getService(t.IXTaskManagerInternal).initialize(),e.getService(t.IPlayableManagerInternal).initialize(),[2,!0]})})},n.prototype.onServiceRegister=function(e){e.singleton(t.IPoolManager,t.PoolManager).withInstance(t.PoolManager.Instance()),console.log("[XProvider]: 注册管理器{0}".format(t.getQualifiedClassName(t.PoolManager))),e.singleton(t.IEventManager,t.EventManager).withInstance(t.EventManager.Instance()),console.log("[XProvider]: 注册管理器{0}".format(t.getQualifiedClassName(t.EventManager))),e.singleton(t.ISchedulerManager,t.SchedulerManager).withInstance(t.SchedulerManager.Instance()),console.log("[XProvider]: 注册管理器{0}".format(t.getQualifiedClassName(t.SchedulerManager))),e.singleton(t.IXTaskManager,t.XTaskManager).withInstance(t.XTaskManager.Instance()).setAlias(t.IXTaskManagerInternal),console.log("[XProvider]: 注册管理器{0}".format(t.getQualifiedClassName(t.XTaskManager))),e.singleton(t.IPlayableManager,t.PlayableManager).withInstance(t.PlayableManager.Instance()).setAlias(t.IPlayableManagerInternal),console.log("[XProvider]: 注册管理器{0}".format(t.getQualifiedClassName(t.PlayableManager)))},n=__decorate([t.impl(t.IServiceProvider),__metadata("design:paramtypes",[])],n)}(t.XObject);t.XProvider=e,__reflect(e.prototype,"xgame.XProvider",["xgame.IServiceProvider"])}(xgame||(xgame={})),function(t){var e=function(){function e(){}return e.bindProperty=function(e,n,i,r){var o=t.Watcher.watch(e,n,null,null);if(o){var s=function(t){i[r]=t};o.setHandler(s,null),s(o.getValue())}return o},e.bindHandler=function(e,n,i,r){var o=t.Watcher.watch(e,n,i,r);return o&&i.call(r,o.getValue()),o},e.$bindProperties=function(n,i,r,o,s){if(1==i.length&&1==r.length)return e.bindProperty(n,i[0].split("."),o,s);for(var a,h=function(){o[s]=function(e){for(var n=e[0],i=n instanceof t.Watcher?n.getValue():n,r=e.length,o=1;o<r;o++){var s=e[o];s instanceof t.Watcher&&(s=s.getValue()),i+=s}return i}(i)},u=r.length,c=0;c<u;c++){var p=r[c],l=i[p].split(".");(a=t.Watcher.watch(n,l,null,null))&&(i[p]=a,a.setHandler(h,null))}return h(),a},e}();t.Binding=e,__reflect(e.prototype,"xgame.Binding")}(xgame||(xgame={})),function(t){var e=function(t){function e(e,n,i,r){var o=t.call(this)||this;return o.$eventPhase=2,o.$currentTarget=null,o.$target=null,o.$isDefaultPrevented=!1,o.$isPropagationStopped=!1,o.$isPropagationImmediateStopped=!1,o.$type=e,o.$bubbles=!!n,o.$cancelable=!!i,o.data=r,o}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this.$type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bubbles",{get:function(){return this.$bubbles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancelable",{get:function(){return this.$cancelable},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventPhase",{get:function(){return this.$eventPhase},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this.$currentTarget},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.$target},enumerable:!0,configurable:!0}),e.prototype.$setTarget=function(t){return this.$target=t,!0},e.prototype.isDefaultPrevented=function(){return this.$isDefaultPrevented},e.prototype.preventDefault=function(){this.$cancelable&&(this.$isDefaultPrevented=!0)},e.prototype.stopPropagation=function(){this.$bubbles&&(this.$isPropagationStopped=!0)},e.prototype.stopImmediatePropagation=function(){this.$bubbles&&(this.$isPropagationImmediateStopped=!0)},e.prototype.clean=function(){this.data=this.$currentTarget=null,this.$setTarget(null)},e.dispatchEvent=function(t,n,i,r){void 0===i&&(i=!1);var o=e.create(e,n,i),s=e._getPropertyData(e);null!=r&&(s.data=r);var a=t.dispatchEvent(o);return e.release(o),a},e._getPropertyData=function(t){var e=t._props;return e||(e=t._props={}),e},e.create=function(t,e,n,i){var r;if(t.hasOwnProperty("eventPool")&&(r=t.eventPool),r||(r=t.eventPool=[]),r.length){var o=r.pop();return o.$type=e,o.$bubbles=!!n,o.$cancelable=!!i,o.$isDefaultPrevented=!1,o.$isPropagationStopped=!1,o.$isPropagationImmediateStopped=!1,o.$eventPhase=2,o}return new t(e,n,i)},e.release=function(t){t.clean(),Object.getPrototypeOf(t).constructor.eventPool.push(t)},e}(t.XObject);t.Event=e,__reflect(e.prototype,"xgame.Event")}(xgame||(xgame={})),function(t){t.IEventDispatcher=Symbol.for("IEventDispatcher")}(xgame||(xgame={})),function(t){var e=function(e){function n(t,n,i,r){var o=e.call(this,t,n,i)||this;return o.property=r,o}return __extends(n,e),n.dispatchPropertyEvent=function(e,i,r){if(!e.hasEventListener(i))return!0;var o=t.Event.create(n,i);o.property=r;var s=e.dispatchEvent(o);return t.Event.release(o),s},n.PROPERTY_CHANGE="propertyChange",n}(t.Event);t.PropertyEvent=e,__reflect(e.prototype,"xgame.PropertyEvent")}(xgame||(xgame={})),function(t){var e="__xgame_bindables__";t.registerBindable=function(t,n){if(t.hasOwnProperty(e))t[e].push(n);else{var i=[n];t[e]&&(i=t[e].concat(i)),t[e]=i}}}(xgame||(xgame={})),function(t){t.getImplements=function(e){for(var n=[],i=t.getPrototype(e);i;){var r=i.__implements__;if(r&&r.length)for(var o=0,s=r;o<s.length;o++){var a=s[o];-1==n.indexOf(a)&&n.push(a)}i=t.getPrototype(i)}return n}}(xgame||(xgame={})),function(t){t.isImplementOf=function(e,n){return t.getImplements(e).indexOf(n)>=0}}(xgame||(xgame={})),function(t){var e="__xgame_listeners__",n=0;function i(t,n){for(var i=t[e],r=i.length,o=0;o<r;o+=2){var s=i[o],a=i[o+1];s.call(a,n)}}var r=function(){function r(t,e,n,i){this.isExecuting=!1,this.property=t,this.handler=e,this.next=i,this.thisObject=n}return r.watch=function(t,e,n,i){if(e.length>0){var o=e.shift(),s=r.watch(null,e,n,i),a=new r(o,n,i,s);return a.reset(t),a}return null},r.checkBindable=function(r,o){var s=r.__xgame_bindables__;if(s&&-1!=s.indexOf(o))return!0;var a=t.isImplementOf(r,t.IEventDispatcher);a||r[e]||(r[e]=[]);var h=function t(e,n){var i=Object.getOwnPropertyDescriptor(e,n);if(i)return i;var r=Object.getPrototypeOf(e);return r?t(r,n):null}(r,o);if(h&&h.set&&h.get){var u=h.set;h.set=function(e){this[o]!=e&&(u.call(this,e),a?t.PropertyEvent.dispatchPropertyEvent(this,t.PropertyEvent.PROPERTY_CHANGE,o):i(this,o))}}else{if(h&&(h.get||h.set))return!1;var c="_"+ ++n+o;r[c]=h?h.value:null,(h={enumerable:!0,configurable:!0}).get=function(){return this[c]},h.set=function(e){this[c]!=e&&(this[c]=e,a?t.PropertyEvent.dispatchPropertyEvent(this,t.PropertyEvent.PROPERTY_CHANGE,o):i(this,o))}}Object.defineProperty(r,o,h),t.registerBindable(r,o)},r.prototype.unwatch=function(){this.reset(null),this.handler=null,this.next&&(this.next.handler=null)},r.prototype.getValue=function(){return this.next?this.next.getValue():this.getHostPropertyValue()},r.prototype.setHandler=function(t,e){this.handler=t,this.thisObject=e,this.next&&this.next.setHandler(t,e)},r.prototype.reset=function(n){var i=this.host;if(i)if(t.isImplementOf(i,t.IEventDispatcher))i.removeEventListener(t.PropertyEvent.PROPERTY_CHANGE,this.wrapHandler,this);else{var o,s=(o=i[e]).indexOf(this);o.splice(s-1,2)}(this.host=n,n)&&(r.checkBindable(n,this.property),t.isImplementOf(n,t.IEventDispatcher)?n.addEventListener(t.PropertyEvent.PROPERTY_CHANGE,this.wrapHandler,this,!1,100):((o=n[e]).push(this.onPropertyChange),o.push(this)));this.next&&this.next.reset(this.getHostPropertyValue())},r.prototype.getHostPropertyValue=function(){return this.host?this.host[this.property]:null},r.prototype.wrapHandler=function(t){var e=t;this.onPropertyChange(e.property)},r.prototype.onPropertyChange=function(t){if(t==this.property&&!this.isExecuting)try{this.isExecuting=!0,this.next&&this.next.reset(this.getHostPropertyValue()),this.handler.call(this.thisObject,this.getValue())}finally{this.isExecuting=!1}},r}();t.Watcher=r,__reflect(r.prototype,"xgame.Watcher")}(xgame||(xgame={})),function(t){t.IAttribute=Symbol.for("IAttribute")}(xgame||(xgame={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n=__decorate([t.impl(t.IAttribute)],n)}(t.XObject);t.Attribute=e,__reflect(e.prototype,"xgame.Attribute",["xgame.IAttribute"])}(xgame||(xgame={})),function(t){var e=function(t){function e(n){var i=t.call(this)||this;return n=n||{},i.Promise=n.Promise||Promise,i.queues={},i.timeout=n.timeout||e.DEFAULT_TIMEOUT,i.maxOccupationTime=n.maxOccupationTime||e.DEFAULT_MAX_OCCUPATION_TIME,n.maxPending===1/0||Number.isInteger(n.maxPending)&&n.maxPending>=0?i.maxPending=n.maxPending:i.maxPending=e.DEFAULT_MAX_PENDING,i}return __extends(e,t),e.prototype.acquire=function(t,e,n,i){if(Array.isArray(t))return this._acquireBatch(t,e,n,i);if("function"!=typeof e)throw new Error("You must pass a function to execute");var r=null,o=null,s=null;"function"!=typeof n&&(i=n,n=null,s=new this.Promise(function(t,e){r=t,o=e})),i=i||{};var a=!1,h=null,u=null,c=this,p=function(e,i,h){void 0===i&&(i=null),void 0===h&&(h=null),u&&(clearTimeout(u),u=null),e&&c.queues[t]&&0===c.queues[t].length&&delete c.queues[t],a||(s?i?o(i):r(h):"function"==typeof n&&n(i,h),a=!0),e&&c.queues[t]&&c.queues[t].length>0&&c.queues[t].shift()()},l=function(t){if(a)return p(t);if(h&&(clearTimeout(h),h=null),1===e.length){var n=!1;e(function(e,i){n||(n=!0,p(t,e,i))})}else c._promiseTry(function(){return e()}).then(function(e){p(t,void 0,e)},function(e){p(t,e)})};if(c.queues[t])if(c.queues[t].length>=c.maxPending)p(!1,new Error("Too much pending tasks"));else{var f=function(){l(!0)};i.skipQueue?c.queues[t].unshift(f):c.queues[t].push(f);var d=i.timeout||c.timeout;d&&(h=setTimeout(function(){h=null,p(!1,new Error("async-lock timed out"))},d))}else c.queues[t]=[],l(!0);var g=i.maxOccupationTime||c.maxOccupationTime;return g&&(u=setTimeout(function(){c.queues[t]&&p(!1,new Error("Maximum occupation time is exceeded"))},g)),s||void 0},e.prototype._acquireBatch=function(t,e,n,i){"function"!=typeof n&&(i=n,n=null);var r=this,o=e;if(t.reverse().forEach(function(t){o=function(t,e){return function(n){r.acquire(t,e,n,i)}}(t,o)}),"function"!=typeof n)return new this.Promise(function(t,e){1===o.length?o(function(n,i){n?e(n):t(i)}):t(o())});o(n)},e.prototype.isBusy=function(t){return t?!!this.queues[t]:Object.keys(this.queues).length>0},e.prototype._promiseTry=function(t){try{return this.Promise.resolve(t())}catch(t){return this.Promise.reject(t)}},e.DEFAULT_TIMEOUT=0,e.DEFAULT_MAX_OCCUPATION_TIME=0,e.DEFAULT_MAX_PENDING=1e3,e}(t.XObject);t.AsyncLock=e,__reflect(e.prototype,"xgame.AsyncLock")}(xgame||(xgame={})),function(t){function e(t){var e=typeof t;return"string"===e||"number"===e}var n=function(){function t(t,e,n){if(this.limit=0,this.__hashobjects__={},this.m_keys=[],this.m_values=[],this.limit=t||0,e&&n&&e.length&&n.length)for(var i=0;i<e.length;i++)this.add(e[i],n[i])}return t.prototype.copy=function(t){if(this.m_keys=t.keys,this.m_values=t.values,this.__hashobjects__={},this.m_keys.length&&e(this.m_keys[0]))for(var n=this.m_keys.length,i=0;i<n;i++)this.mapset(this.m_keys[i],this.m_values[i])},Object.defineProperty(t.prototype,"length",{get:function(){return this.m_keys.length},enumerable:!0,configurable:!0}),t.prototype.first=function(){return this.length>0?{key:this.m_keys[0],value:this.m_values[0]}:null},t.prototype.last=function(){return this.length>0?{key:this.m_keys[this.length-1],value:this.m_values[this.length-1]}:null},t.prototype.shift=function(){if(this.length>0){var t={key:this.m_keys.shift(),value:this.m_values.shift()};return this.mapdelete(t.key),t}return null},t.prototype.pop=function(){if(this.length>0){var t={key:this.m_keys.pop(),value:this.m_values.pop()};return this.mapdelete(t.key),t}return null},Object.defineProperty(t.prototype,"values",{get:function(){return this.m_values.concat()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keys",{get:function(){return this.m_keys.concat()},enumerable:!0,configurable:!0}),t.prototype.containsKey=function(t){return e(t)?void 0!==this.__hashobjects__[t]:this.indexOfKey(t)>=0},t.prototype.indexOfKey=function(t){return this.m_keys.indexOf(t)},t.prototype.containsValue=function(t){return this.indexOfValue(t)>=0},t.prototype.sortByKey=function(t){this.insertion_sort_for_key(t)},t.prototype.sortByValue=function(t){this.insertion_sort_for_value(t)},t.prototype.indexOfValue=function(t){return this.m_values.indexOf(t)},t.prototype.getKeyByValue=function(t){return this.m_keys[this.indexOfValue(t)]},t.prototype.set=function(t,n){if(!e(t)||this.containsKey(t)){var i=this.indexOfKey(t);i>=0?(this.m_values[i]=n,this.mapset(t,n)):this.add(t,n)}else this.add(t,n)},t.prototype.add=function(t,e){this.checkRepeat(t,e),this.m_keys.push(t),this.m_values.push(e),this.mapset(t,e),this.limit&&this.checkLimit()},t.prototype.unshift=function(t,e){this.checkRepeat(t,e),this.m_keys.unshift(t),this.m_values.unshift(e),this.mapset(t,e),this.limit&&this.checkLimit()},t.prototype.push=function(t,e){this.checkRepeat(t,e),this.m_keys.push(t),this.m_values.push(e),this.mapset(t,e),this.limit&&this.checkLimit()},t.prototype.checkLimit=function(t,e,n){if(t||(t=this.limit),t&&this.length>t)for(;this.length>t;){var i=this.shift();i&&e&&e.apply(n,[i])}},t.prototype.allocf=function(t,n){if(e(t)&&this.containsKey(t))return this.__hashobjects__[t];var i=this.indexOfKey(t);if(i>=0)return this.m_values[i];var r=n();return this.add(t,r),r},t.prototype.alloc=function(t,n){if(e(t)&&this.containsKey(t))return this.__hashobjects__[t];var i=this.indexOfKey(t);return i>=0?this.m_values[i]:(this.add(t,n),n)},t.prototype.get=function(t,n){if(e(t)&&this.containsKey(t))return this.__hashobjects__[t];var i=this.indexOfKey(t);return i>=0?this.m_values[i]:n},t.prototype.removeKeys=function(t){for(var e=t.length,n=0;n<e;n++)this.remove(t[n])},t.prototype.remove=function(t){var e=this.indexOfKey(t);return e>=0?(this.mapdelete(t),this.m_keys.splice(e,1),this.m_values.splice(e,1)[0]):null},t.prototype.removeByValue=function(t){var e=this.indexOfValue(t);if(e>=0){this.m_values.splice(e,1);var n=this.m_keys.splice(e,1)[0];return this.mapdelete(n),n}return null},t.prototype.filter=function(t,e,n){for(var i=[],r=this.m_keys.length-1;r>=0;r--)if(-1===t.indexOf(this.m_keys[r])){var o=!0,s=this.m_values[r];e&&!e.apply(n,[s])&&(o=!1),o&&(this.remove(this.m_keys[r]),i.push(s))}return i},t.prototype.clear=function(t){if(t)for(var n=this.m_values.length-1;n>=0;n--)t(this.m_values[n]);this.length&&e(this.m_keys[0])&&(this.__hashobjects__={}),this.m_keys.length=0,this.m_values.length=0},t.prototype.randomList=function(t){void 0===t&&(t=5);var e=[];for(t>this.length&&(t=this.length);e.length<t;){var n=this.random();-1===e.indexOf(n)&&e.push(n)}return e},t.prototype.random=function(){var t=Math.random()*this.keys.length<<0;return this.m_values[t]},t.prototype.index=function(t){return t<this.length?{key:this.m_keys[t],value:this.m_values[t]}:null},t.prototype.indexKey=function(t){return t<this.length?this.m_keys[t]:null},t.prototype.indexValue=function(t){return t<this.length?this.m_values[t]:null},t.prototype.forEach=function(t,e,n){var i=this.length;if(n)for(var r=i-1;r>=0&&!t.apply(e,[this.index(r),r]);r--);else for(r=0;r<i&&!t.apply(e,[this.index(r),r]);r++);},t.prototype.forKeys=function(t,e,n){var i=this.length;if(n)for(var r=i-1;r>=0&&!t.apply(e,[this.m_keys[r],r]);r--);else for(r=0;r<i&&!t.apply(e,[this.m_keys[r],r]);r++);},t.prototype.forValues=function(t,e,n){var i=this.length;if(n)for(var r=i-1;r>=0&&!t.apply(e,[this.m_values[r],r]);r--);else for(r=0;r<i&&!t.apply(e,[this.m_values[r],r]);r++);},t.prototype.insertion_sort_for_key=function(t){for(var e,n,i,r=this.m_keys.length,o=1;o<r;o++){for(e=o-1,n=this.m_keys[o],i=this.m_values[o];e>=0&&t(this.m_keys[e],n)>0;)this.m_keys[e+1]=this.m_keys[e],this.m_values[e+1]=this.m_values[e],e--;this.m_keys[e+1]=n,this.m_values[e+1]=i}},t.prototype.insertion_sort_for_value=function(t){for(var e,n,i,r=this.m_values.length,o=1;o<r;o++){for(e=o-1,n=this.m_values[o],i=this.m_keys[o];e>=0&&t(this.m_values[e],n)>0;)this.m_values[e+1]=this.m_values[e],this.m_keys[e+1]=this.m_keys[e],e--;this.m_values[e+1]=n,this.m_keys[e+1]=i}},t.prototype.checkRepeat=function(t,n){if(!e(t)||this.containsKey(t)){var i=this.indexOfKey(t);return i>=0&&(this.m_values.splice(i,1),this.m_keys.splice(i,1)),!0}return!1},t.prototype.mapdelete=function(t){e(t)&&delete this.__hashobjects__[t]},t.prototype.mapset=function(t,n){e(t)&&(this.__hashobjects__[t]=n)},t}();t.Dictionary=n,__reflect(n.prototype,"xgame.Dictionary")}(xgame||(xgame={})),function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.locker=new t.AsyncLock,n}return __extends(n,e),n.prototype.acquire=function(t,e,n){return this.locker.acquire("this",t,e,n)},n.prototype.simple=function(t,e){return this.acquire(function(n){t.apply(e),n()})},n}(t.XObject);t.Locker=e,__reflect(e.prototype,"xgame.Locker");var n=new t.Dictionary;t.__lockobject__=function(t){var i,r=t.hashCode;return r?(n.containsKey(r)?i=n.get(r):(i=new e,n.add(r,i)),i):null},t.__unlockobject__=function(t){var e=t.hashCode;return!!e&&!!n.containsKey(e)&&(n.remove(e),!0)}}(xgame||(xgame={})),function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.registeredDisposables=[],t}return __extends(n,e),n.prototype.dispose=function(){var t=this;this.simple(function(){for(;t.registeredDisposables.length;){t.registeredDisposables.shift().dispose()}},this)},n.prototype.register=function(t,e){var n=this;return void 0===e&&(e=!1),this.simple(function(){n.registeredDisposables.indexOf(t)>=0?e&&t.dispose():n.registeredDisposables.push(t)},this),this},n=__decorate([t.impl(t.IDisposable),__metadata("design:paramtypes",[])],n)}(t.Locker);t.DisposableGroup=e,__reflect(e.prototype,"xgame.DisposableGroup",["xgame.IDisposable","xgame.IXObject"])}(xgame||(xgame={})),function(t){var e=function(e){function n(){return e.call(this)||this}return __extends(n,e),n.prototype.dispose=function(){},n=__decorate([t.impl(t.IDisposable),__metadata("design:paramtypes",[])],n)}(t.XObject);t.DisposableObject=e,__reflect(e.prototype,"xgame.DisposableObject",["xgame.IDisposable"])}(xgame||(xgame={})),function(t){t.IInjectableAttribute=Symbol.for("IInjectableAttribute")}(xgame||(xgame={})),function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.injectable=!0,t}return __extends(n,e),n=__decorate([t.impl(t.IInjectableAttribute),__metadata("design:paramtypes",[])],n)}(t.Attribute);t.InjectableAttribute=e,__reflect(e.prototype,"xgame.InjectableAttribute",["xgame.IInjectableAttribute","xgame.IXObject"])}(xgame||(xgame={})),function(t){t.IMapping=Symbol.for("IMapping")}(xgame||(xgame={})),function(t){var e=function(t){function e(e,n,i){var r=t.call(this)||this;return r.namedInstances=new Map,r.identity=n,r.service=i,r.aliases=e,r}return __extends(e,t),e.prototype.withInstance=function(t,e){return e?this.namedInstances.set(e,t):this.instance=t,this},e.prototype.setAlias=function(t){return this.aliases.set(t,this.identity),this},e.prototype.create=function(t){if(!t)return this.instance||(this.instance=new this.service),this.instance;if(this.namedInstances.has(t))return this.namedInstances.get(t);var e=new this.service;return this.namedInstances.set(t,e),e},e}(t.XObject);t.Mapping=e,__reflect(e.prototype,"xgame.Mapping",["xgame.IMapping"])}(xgame||(xgame={})),function(t){t.IMethodParamAttribute=Symbol.for("IMethodParamAttribute")}(xgame||(xgame={})),function(t){var e=function(e){function n(t,n,i,r){var o=e.call(this)||this;return o.identity=t,o.key=n,o.index=i,o.named=r,o}return __extends(n,e),n=__decorate([t.impl(t.IMethodParamAttribute),__metadata("design:paramtypes",[Object,String,Number,String])],n)}(t.Attribute);t.MethodParamAttribute=e,__reflect(e.prototype,"xgame.MethodParamAttribute",["xgame.IMethodParamAttribute","xgame.IXObject"])}(xgame||(xgame={})),function(t){t.IPropertyAttribute=Symbol.for("IPropertyAttribute")}(xgame||(xgame={})),function(t){var e=function(e){function n(t,n,i){var r=e.call(this)||this;return r.identity=t,r.key=n,r.named=i,r}return __extends(n,e),n=__decorate([t.impl(t.IPropertyAttribute),__metadata("design:paramtypes",[Object,String,String])],n)}(t.Attribute);t.PropertyAttribute=e,__reflect(e.prototype,"xgame.PropertyAttribute",["xgame.IPropertyAttribute","xgame.IXObject"])}(xgame||(xgame={})),function(t){function e(t){if(t&&("object"==typeof t||t.prototype))return t.prototype?t.prototype:Object.getPrototypeOf(t)}t.getPrototype=e,t.getPrototypeChains=function(t){for(var n=[],i=t;i;)n.push(i),i=e(i);return n}}(xgame||(xgame={})),function(t){t.getTypes=function(e){for(var n=[],i=t.getPrototype(e);i;){var r=i.__types__;if(r&&r.length)for(var o=0,s=r;o<s.length;o++){var a=s[o];-1==n.indexOf(a)&&n.push(a)}i=t.getPrototype(i)}return n}}(xgame||(xgame={})),function(t){function e(e,n){var i=t.getTypes(e);return!!i&&-1!==i.indexOf(n)}t.is=function(n,i){if(!n||"object"!=typeof n)return!1;var r=typeof i;return"symbol"==r?t.isImplementOf(n,i):e(n,"string"==r?i:t.getQualifiedClassName(i))}}(xgame||(xgame={})),function(t){t.METADATA_ATTRIBUTES_KEY="xgame:attributes";var e=function(e){function n(){var t=e.call(this)||this;return t.mappings=new Map,t.aliases=new Map,t}return __extends(n,e),n.prototype.addAttributes=function(e,n,i){return i=i||t.METADATA_ATTRIBUTES_KEY,this.getOrCreateMetadata(i,e).push(n),this},n.prototype.getOrCreateMetadata=function(t,e){var n=[];return Reflect.hasOwnMetadata(t,e)?n=Reflect.getMetadata(t,e):Reflect.defineMetadata(t,n,e),n},n.prototype.hasAttribute=function(t,e,n){return!!this.getAttribute(t,e,n)},n.prototype.getAttributes=function(t,e,n){return this.getOwnAttributes(t,e,n).slice()},n.prototype.getOwnAttributes=function(e,n,i){i=i||t.METADATA_ATTRIBUTES_KEY;var r=[],o=Reflect.getMetadata(i,e)||[];if(o&&o.length)for(var s=0,a=o;s<a.length;s++){var h=a[s];t.is(h,n)&&r.push(h)}var u=e.prototype;if(u&&(u=Object.getPrototypeOf(u))){var c=Object.getPrototypeOf(u).constructor;if(c!==Object){var p=this.getOwnAttributes(c,n,i);r=r.concat(p)}}return r},n.prototype.getAttribute=function(t,e,n){var i=this.getAttributes(t,e,n);return i&&i.length?i[0]:null},n.prototype.isMapping=function(t){return this.aliases.has(t)&&(t=this.aliases.get(t)),this.mappings.has(t)},n.prototype.bind=function(t,e){return this.getOrCreate(t,e)},n.prototype.singleton=function(t,e){return this.getOrCreate(t,e)},n.prototype.getOrCreate=function(e,n){if(this.mappings.has(e))return this.mappings.get(e);var i=new t.Mapping(this.aliases,e,n);return this.mappings.set(e,i),i},n.prototype.getService=function(t,e){if(this.aliases.has(t)&&(t=this.aliases.get(t)),!this.mappings.has(t))throw new Error("xgame.Container ["+t.toString()+"] 此类型没有还没有注册.");return this.mappings.get(t).create(e)},n}(t.Singleton);t.ServiceContainer=e,__reflect(e.prototype,"xgame.ServiceContainer")}(xgame||(xgame={})),function(t){t.attributes=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n){for(var i=0,r=e;i<r.length;i++){var o=r[i];t.ServiceContainer.Instance().addAttributes(n,o)}}}}(xgame||(xgame={})),function(t){t.IEventManager=Symbol.for("IEventManager")}(xgame||(xgame={})),function(t){var e=[],n=function(n){function i(t){void 0===t&&(t=null);var e=n.call(this)||this;return e.$EventDispatcher={0:t||e,1:{},2:{},3:0},e}return __extends(i,n),i.prototype.$getEventMap=function(t){var e=this.$EventDispatcher;return t?e[2]:e[1]},i.prototype.addEventListener=function(t,e,n,i,r){this.$addListener(t,e,n,i,r)},i.prototype.once=function(t,e,n,i,r){this.$addListener(t,e,n,i,r,!0)},i.prototype.$addListener=function(t,e,n,i,r,o){var s=this.$EventDispatcher,a=i?s[2]:s[1],h=a[t];h?0!==s[3]&&(a[t]=h=h.concat()):h=a[t]=[],this.$insertEventBin(h,t,e,n,i,r,o)},i.prototype.$insertEventBin=function(t,e,n,i,r,o,s){o=0|+o;for(var a=-1,h=t.length,u=0;u<h;u++){var c=t[u];if(c.listener==n&&c.thisObject==i&&c.target==this)return!1;-1==a&&c.priority<o&&(a=u)}var p={type:e,listener:n,thisObject:i,priority:o,target:this,useCapture:r,dispatchOnce:!!s};return-1!==a?t.splice(a,0,p):t.push(p),!0},i.prototype.removeEventListener=function(t,e,n,i){var r=this.$EventDispatcher,o=i?r[2]:r[1],s=o[t];s&&(0!==r[3]&&(o[t]=s=s.concat()),this.$removeEventBin(s,e,n),0==s.length&&(o[t]=null))},i.prototype.$removeEventBin=function(t,e,n){for(var i=t.length,r=0;r<i;r++){var o=t[r];if(o.listener==e&&o.thisObject==n&&o.target==this)return t.splice(r,1),!0}return!1},i.prototype.hasEventListener=function(t){var e=this.$EventDispatcher;return!(!e[1][t]&&!e[2][t])},i.prototype.willTrigger=function(t){return this.hasEventListener(t)},i.prototype.dispatchEvent=function(t){return t.$currentTarget=this.$EventDispatcher[0],t.$setTarget(t.$currentTarget),this.$notifyListener(t,!1)},i.prototype.$notifyListener=function(t,n){var i=this.$EventDispatcher,r=(n?i[2]:i[1])[t.$type];if(!r)return!0;var o=r.length;if(0==o)return!0;var s=e;i[3]++;for(var a=0;a<o;a++){if((h=r[a]).listener.call(h.thisObject,t),h.dispatchOnce&&s.push(h),t.$isPropagationImmediateStopped)break}for(i[3]--;s.length;){var h;(h=s.pop()).target.removeEventListener(h.type,h.listener,h.thisObject,h.useCapture)}return!t.$isDefaultPrevented},i.prototype.dispatchEventWith=function(e,n,i,r){if(n||this.hasEventListener(e)){var o=t.Event.create(t.Event,e,n,r);o.data=i;var s=this.dispatchEvent(o);return t.Event.release(o),s}return!0},i=__decorate([t.impl(t.IEventDispatcher),__metadata("design:paramtypes",[Object])],i)}(t.XObject);t.EventDispatcher=n,__reflect(n.prototype,"xgame.EventDispatcher",["xgame.IEventDispatcher"])}(xgame||(xgame={})),function(t){var e=function(t){function e(e,n,i,r,o,s,a){var h=t.call(this)||this;return h.manager=e,h.moduleid=n,h.type=i,h.listener=r,h.thisObject=o,h.useCapture=s,h.priority=a,h}return __extends(e,t),e.prototype.dispose=function(){this.manager.removeEventListener(this.moduleid,this.type,this.listener,this.thisObject,this.useCapture)},e}(t.DisposableObject);t.EventListener=e,__reflect(e.prototype,"xgame.EventListener")}(xgame||(xgame={})),function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.moduleDispatchers=new Map,t}return __extends(n,e),n.prototype.addEventListener=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i,r,o,s,a,h=9999;return"function"==typeof e[1]?(i=e[0],r=e[1],o=e[2],s=e[3],a=e[4]):(h=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5]),this.getDispatcher(h).addEventListener(i,r,o,s,a),new t.EventListener(this,h,i,r,o,s,a)},n.prototype.once=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i,r,o,s,a,h=9999;return"string"==typeof e[0]?(i=e[0],r=e[1],o=e[2],s=e[3],a=e[4]):(h=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5]),h||(h=9999),this.getDispatcher(h).once(i,r,o,s,a),new t.EventListener(this,h,i,r,o,s,a)},n.prototype.removeEventListener=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n,i,r,o,s=9999;"string"==typeof t[0]?(n=t[0],i=t[1],r=t[2],o=t[3]):(s=t[0],n=t[1],i=t[2],r=t[3],o=t[4]),this.getDispatcher(s).removeEventListener(n,i,r,o)},n.prototype.hasEventListener=function(){for(var t,e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return"number"==typeof n[0]?(t=n[0],e=n[1]):(t=9999,e=n[0]),this.getDispatcher(t).hasEventListener(e)},n.prototype.dispatchEvent=function(){for(var e,n,i,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];"number"==typeof r[0]?(e=r[0],n=r[1],i=r[2]):(e=9999,n=r[0],i=r[1]);var s=this.getDispatcher(e);return"string"==typeof n?s.dispatchEvent(new t.Event(n,!1,!1,i)):s.dispatchEvent(n)},n.prototype.getDispatcher=function(e){if(e=e||9999,this.moduleDispatchers.has(e))return this.moduleDispatchers.get(e);var n=new t.EventDispatcher;return this.moduleDispatchers.set(e,n),n},n=__decorate([t.impl(t.IEventManager),__metadata("design:paramtypes",[])],n)}(t.Singleton);t.EventManager=e,__reflect(e.prototype,"xgame.EventManager",["xgame.IEventManager","xgame.IXObject"])}(xgame||(xgame={})),function(t){t.DisposableGroup.prototype.addEventListener=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=t.EventManager.Instance(),r=i.addEventListener.apply(i,e);this.register(r)},t.DisposableGroup.prototype.once=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=t.EventManager.Instance(),r=i.addEventListener.apply(i,e);this.register(r)}}(xgame||(xgame={})),function(t){t.event=function(e,n,i){return function(r,o,s){var a=r,h=s.value,u=s.value=function(){h.apply(this,arguments)};a.__eventview__||(a.__eventview__=!0,a.eventDisposableGroup=new t.DisposableGroup,a.eventObserves=[],a.addEventObserves=function(){if(this.eventObserves&&this.eventObserves.length)for(var t=0,e=this.eventObserves;t<e.length;t++){var n=e[t];this.eventDisposableGroup.addEventListener(n.moduleId,n.eventName,n.callback,this,!1,i)}},a.removeEventObserves=function(){this.eventObserves&&this.eventObserves.length&&(this.eventObserves.length=0),this.eventDisposableGroup&&this.eventDisposableGroup.dispose()});var c={eventName:e,moduleId:n,callback:u,priority:i};a.eventObserves.push(c)}}}(xgame||(xgame={})),function(t){t.inject=function(e,n){return function(i,r,o){if(null!=o){if("number"==typeof o){var s=new t.MethodParamAttribute(e,r,o,n);t.ServiceContainer.Instance().addAttributes(i,s)}}else s=new t.PropertyAttribute(e,r,n),t.ServiceContainer.Instance().addAttributes(i,s)}}}(xgame||(xgame={})),function(t){t.superConstructor=function(t,e){var n=function(){return t.apply(this,e)};return n.prototype=t.prototype,new n}}(xgame||(xgame={})),function(t){t.injectInstance=function(e){if(!e||"object"!=typeof e)throw new Error("对象依赖注入失败:"+e);var n=t.ServiceContainer.Instance().getAttributes(e,t.IPropertyAttribute);if(n&&n.length)for(var i=0,r=n;i<r.length;i++){var o=r[i];t.ServiceContainer.Instance().isMapping(o.identity)&&(e[o.key]=t.ServiceContainer.Instance().getService(o.identity,o.named))}return e}}(xgame||(xgame={})),function(t){t.injectable=function(){return function(e,n,i){if(n&&i){var r=i.value;i.value=function(){var i=arguments.length,o=0,s=t.ServiceContainer.Instance().getAttributes(e,t.IMethodParamAttribute);if(s&&s.length)for(var a=0,h=s=s.filter(function(t){return t.key==n},this);a<h.length;a++){var u=h[a];arguments[u.index]=t.ServiceContainer.Instance().getService(u.identity,u.named),o=u.index}return i<=o&&(arguments.length=o+1),r.apply(this,arguments)}}else{var o=new t.InjectableAttribute;t.ServiceContainer.Instance().addAttributes(e,o)}}}}(xgame||(xgame={})),function(t){var e=function(t){function e(e,n,i){var r=t.call(this)||this;return r.elapsedTimeInState=0,r.$states=new Map,r.$context=e,r.addState(n,i),r.$currentState=i,r.$currentState.onEnter(),r}return __extends(e,t),Object.defineProperty(e.prototype,"currentState",{get:function(){return this.$currentState},enumerable:!0,configurable:!0}),e.prototype.addState=function(t,e){e.setMachineAndContext(this,this.$context),this.$states.set(t,e)},e.prototype.update=function(t){this.elapsedTimeInState+=t,this.$currentState.onPrepare(),this.$currentState.onUpdate(t)},e.prototype.getState=function(t){return this.$states.has(t)?this.$states.get(t):(console.error("状态"+t+"不存在。你是不是在调用addState的时候忘记添加了?"),null)},e.prototype.changeState=function(t){return this.$currentState instanceof t?this.$currentState:(this.currentState&&this.$currentState.onExit(),this.$states.has(t)?(this.elapsedTimeInState=0,this.previousState=this.$currentState,this.$currentState=this.$states.get(t),this.$currentState.onEnter(),this.onStateChanged&&this.onStateChanged(),this.$currentState):void console.error("状态"+t+"不存在。你是不是在调用addState的时候忘记添加了?"))},e}(t.XObject);t.StateMachine=e,__reflect(e.prototype,"xgame.StateMachine")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setMachineAndContext=function(t,e){this.$machine=t,this.$context=e,this.onInitialize()},e.prototype.onInitialize=function(){},e.prototype.onEnter=function(){},e.prototype.onPrepare=function(){},e.prototype.onExit=function(){},e}(t.XObject);t.State=e,__reflect(e.prototype,"xgame.State")}(xgame||(xgame={})),function(t){var e=function(){function e(){}return e.range=function(e,n){for(var i=new t.List;n--;)i.add(e++);return i},e.repeat=function(e,n){for(var i=new t.List;n--;)i.add(e);return i},e}();t.Enumerable=e,__reflect(e.prototype,"xgame.Enumerable")}(xgame||(xgame={})),function(t){var e=function(t){function e(e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=t.call(this)||this;return i.x=e,i.y=n,i}return __extends(e,t),e.prototype.copy=function(){return new e(this.x,this.y)},e.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},e.prototype.copyFromPoint=function(t){this.x=t.x,this.y=t.y},e.prototype.setTo=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e},e.prototype.rotate=function(t){var e=t,n=Math.cos(e),i=Math.sin(e),r=this.x,o=this.y;this.x=r*n-o*i,this.y=r*i+o*n},e.prototype.scaleEquals=function(t){this.x*=t,this.y*=t},e.prototype.scale=function(t,n){return void 0===n&&(n=null),n?(n.x=this.x*t,n.y=this.y*t,n):new e(this.x*t,this.y*t)},e.prototype.normalize=function(){var t=length;this.x/=t,this.y/=t},e.prototype.plusEquals=function(t){this.x+=t.x,this.y+=t.y},e.prototype.plus=function(t,n){return void 0===n&&(n=null),n?(n.x=this.x+t.x,n.y=this.y+t.y,n):new e(this.x+t.x,this.y+t.y)},e.prototype.minusEquals=function(t){this.x-=t.x,this.y-=t.y},e.prototype.minus=function(t,n){return void 0===n&&(n=null),n?(n.x=this.x-t.x,n.y=this.y-t.y,n):new e(this.x-t.x,this.y-t.y)},e.prototype.dot=function(t){return this.x*t.x+this.y*t.y},Object.defineProperty(e.prototype,"angle",{get:function(){return Math.atan2(this.y,this.x)},set:function(t){var e=length,n=e*Math.cos(t),i=e*Math.sin(t);this.x=n,this.y=i},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},set:function(t){this.scaleEquals(t/length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"normal",{get:function(){return new e(-this.y,this.x)},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"["+this.x+", "+this.y+"]"},e}(t.XObject);t.MathVector=e,__reflect(e.prototype,"xgame.MathVector")}(xgame||(xgame={})),function(t){var e=Math.PI,n=2*e,i=e/180,r=function(r){function o(t,e,n,i,o,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===o&&(o=0),void 0===s&&(s=0);var a=r.call(this)||this;return a.a=t,a.b=e,a.c=n,a.d=i,a.tx=o,a.ty=s,a}return __extends(o,r),o.prototype.clone=function(){return new o(this.a,this.b,this.c,this.d,this.tx,this.ty)},o.prototype.concat=function(t){var e=this.a*t.a,n=0,i=0,r=this.d*t.d,o=this.tx*t.a+t.tx,s=this.ty*t.d+t.ty;0===this.b&&0===this.c&&0===t.b&&0===t.c||(e+=this.b*t.c,r+=this.c*t.b,n+=this.a*t.b+this.b*t.d,i+=this.c*t.a+this.d*t.c,o+=this.ty*t.c,s+=this.tx*t.b),this.a=e,this.b=n,this.c=i,this.d=r,this.tx=o,this.ty=s},o.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},o.prototype.identity=function(){this.a=this.d=1,this.b=this.c=this.tx=this.ty=0},o.prototype.invert=function(){this.$invertInto(this)},o.prototype.$invertInto=function(t){var e=this.a,n=this.b,i=this.c,r=this.d,o=this.tx,s=this.ty;if(0==n&&0==i)return t.b=t.c=0,void(0==e||0==r?t.a=t.d=t.tx=t.ty=0:(e=t.a=1/e,r=t.d=1/r,t.tx=-e*o,t.ty=-r*s));var a=e*r-n*i;if(0!=a){a=1/a;var h=t.a=r*a;n=t.b=-n*a,i=t.c=-i*a,r=t.d=e*a,t.tx=-(h*o+i*s),t.ty=-(n*o+r*s)}else t.identity()},o.prototype.rotate=function(t){if(0!==(t=+t)){t/=i;var e=Math.cos(t),n=Math.sin(t),r=this.a,o=this.b,s=this.c,a=this.d,h=this.tx,u=this.ty;this.a=r*e-o*n,this.b=r*n+o*e,this.c=s*e-a*n,this.d=s*n+a*e,this.tx=h*e-u*n,this.ty=h*n+u*e}},o.prototype.scale=function(t,e){1!==t&&(this.a*=t,this.c*=t,this.tx*=t),1!==e&&(this.b*=e,this.d*=e,this.ty*=e)},o.prototype.setTo=function(t,e,n,i,r,o){return this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=o,this},o.prototype.transformPoint=function(e,n,i){var r=this.a*e+this.c*n+this.tx,o=this.b*e+this.d*n+this.ty;return i?(i.setTo(r,o),i):new t.Point(r,o)},o.prototype.translate=function(t,e){this.tx+=t,this.ty+=e},o.prototype.equals=function(t){return this.a==t.a&&this.b==t.b&&this.c==t.c&&this.d==t.d&&this.tx==t.tx&&this.ty==t.ty},o.prototype.prepend=function(t,e,n,i,r,o){var s=this.tx;if(1!=t||0!=e||0!=n||1!=i){var a=this.a,h=this.c;this.a=a*t+this.b*n,this.b=a*e+this.b*i,this.c=h*t+this.d*n,this.d=h*e+this.d*i}return this.tx=s*t+this.ty*n+r,this.ty=s*e+this.ty*i+o,this},o.prototype.append=function(t,e,n,i,r,o){var s=this.a,a=this.b,h=this.c,u=this.d;return 1==t&&0==e&&0==n&&1==i||(this.a=t*s+e*h,this.b=t*a+e*u,this.c=n*s+i*h,this.d=n*a+i*u),this.tx=r*s+o*h+this.tx,this.ty=r*a+o*u+this.ty,this},o.prototype.deltaTransformPoint=function(e){var n=this.a*e.x+this.c*e.y,i=this.b*e.x+this.d*e.y;return new t.Point(n,i)},o.prototype.toString=function(){return"(a="+this.a+", b="+this.b+", c="+this.c+", d="+this.d+", tx="+this.tx+", ty="+this.ty+")"},o.prototype.createBox=function(t,e,n,r,o){void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=0);if(0!==n){n/=i;var s=Math.cos(n),a=Math.sin(n);this.a=s*t,this.b=a*e,this.c=-a*t,this.d=s*e}else this.a=t,this.b=0,this.c=0,this.d=e;this.tx=r,this.ty=o},o.prototype.createGradientBox=function(t,e,n,i,r){void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),this.createBox(t/1638.4,e/1638.4,n,i+t/2,r+e/2)},o.prototype.$transformBounds=function(t){var e=this.a,n=this.b,i=this.c,r=this.d,o=this.tx,s=this.ty,a=t.x,h=t.y,u=a+t.width,c=h+t.height,p=e*a+i*h+o,l=n*a+r*h+s,f=e*u+i*h+o,d=n*u+r*h+s,g=e*u+i*c+o,y=n*u+r*c+s,m=e*a+i*c+o,v=n*a+r*c+s,_=0;p>f&&(_=p,p=f,f=_),g>m&&(_=g,g=m,m=_),t.x=Math.floor(p<g?p:g),t.width=Math.ceil((f>m?f:m)-t.x),l>d&&(_=l,l=d,d=_),y>v&&(_=y,y=v,v=_),t.y=Math.floor(l<y?l:y),t.height=Math.ceil((d>v?d:v)-t.y)},o.prototype.getDeterminant=function(){return this.a*this.d-this.b*this.c},o.prototype.$getScaleX=function(){var t=this;if(0==t.b)return t.a;var e=Math.sqrt(t.a*t.a+t.b*t.b);return this.getDeterminant()<0?-e:e},o.prototype.$getScaleY=function(){var t=this;if(0==t.c)return t.d;var e=Math.sqrt(t.c*t.c+t.d*t.d);return this.getDeterminant()<0?-e:e},o.prototype.$getSkewX=function(){return this.d<0?Math.atan2(this.d,this.c)+e/2:Math.atan2(this.d,this.c)-e/2},o.prototype.$getSkewY=function(){return this.a<0?Math.atan2(this.b,this.a)-e:Math.atan2(this.b,this.a)},o.prototype.$updateScaleAndRotation=function(t,e,r,o){if(!(0!=r&&r!=n||0!=o&&o!=n))return this.a=t,this.b=this.c=0,void(this.d=e);r/=i,o/=i;var s=Math.cos(r),a=Math.sin(r);r==o?(this.a=s*t,this.b=a*t):(this.a=Math.cos(o)*t,this.b=Math.sin(o)*t),this.c=-a*e,this.d=s*e},o.prototype.$preMultiplyInto=function(t,e){var n=t.a*this.a,i=0,r=0,o=t.d*this.d,s=t.tx*this.a+this.tx,a=t.ty*this.d+this.ty;0===t.b&&0===t.c&&0===this.b&&0===this.c||(n+=t.b*this.c,o+=t.c*this.b,i+=t.a*this.b+t.b*this.d,r+=t.c*this.a+t.d*this.c,s+=t.ty*this.c,a+=t.tx*this.b),e.a=n,e.b=i,e.c=r,e.d=o,e.tx=s,e.ty=a},o}(t.XObject);t.Matrix=r,__reflect(r.prototype,"xgame.Matrix")}(xgame||(xgame={})),function(t){var e=Math.PI/180,n=function(t){function n(e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=t.call(this)||this;return i.x=e,i.y=n,i}return __extends(n,t),Object.defineProperty(n.prototype,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},enumerable:!0,configurable:!0}),n.prototype.setTo=function(t,e){return this.x=t,this.y=e,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},n.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},n.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.interpolate=function(t,e,i){var r=1-i;return new n(t.x*i+e.x*r,t.y*i+e.y*r)},n.prototype.normalize=function(t){if(0!=this.x||0!=this.y){var e=t/this.length;this.x*=e,this.y*=e}},n.prototype.offset=function(t,e){this.x+=t,this.y+=e},n.polar=function(t,i){return new n(t*Math.cos(i/e),t*Math.sin(i/e))},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.toString=function(){return"(x="+this.x+", y="+this.y+")"},n}(t.XObject);t.Point=n,__reflect(n.prototype,"xgame.Point")}(xgame||(xgame={})),function(t){var e=function(e){function n(t,n,i,r){void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0);var o=e.call(this)||this;return o.x=t,o.y=n,o.width=i,o.height=r,o}return __extends(n,e),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},set:function(t){this.width=t-this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){this.height=t-this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new t.Point(this.left,this.top)},set:function(t){this.top=t.y,this.left=t.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new t.Point(this.right,this.bottom)},set:function(t){this.bottom=t.y,this.right=t.x},enumerable:!0,configurable:!0}),n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},n.prototype.setTo=function(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this},n.prototype.contains=function(t,e){return this.x<=t&&this.x+this.width>=t&&this.y<=e&&this.y+this.height>=e},n.prototype.intersection=function(t){return this.clone().$intersectInPlace(t)},n.prototype.inflate=function(t,e){this.x-=t,this.width+=2*t,this.y-=e,this.height+=2*e},n.prototype.$intersectInPlace=function(t){var e=this.x,n=this.y,i=t.x,r=t.y,o=Math.max(e,i),s=Math.min(e+this.width,i+t.width);if(o<=s){var a=Math.max(n,r),h=Math.min(n+this.height,r+t.height);if(a<=h)return this.setTo(o,a,s-o,h-a),this}return this.setEmpty(),this},n.prototype.intersects=function(t){return Math.max(this.x,t.x)<=Math.min(this.right,t.right)&&Math.max(this.y,t.y)<=Math.min(this.bottom,t.bottom)},n.prototype.isEmpty=function(){return this.width<=0||this.height<=0},n.prototype.setEmpty=function(){this.x=0,this.y=0,this.width=0,this.height=0},n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.containsPoint=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},n.prototype.containsRect=function(t){var e=t.x+t.width,n=t.y+t.height,i=this.x+this.width,r=this.y+this.height;return t.x>=this.x&&t.x<i&&t.y>=this.y&&t.y<r&&e>this.x&&e<=i&&n>this.y&&n<=r},n.prototype.equals=function(t){return this===t||this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},n.prototype.inflatePoint=function(t){this.inflate(t.x,t.y)},n.prototype.offset=function(t,e){this.x+=t,this.y+=e},n.prototype.offsetPoint=function(t){this.offset(t.x,t.y)},n.prototype.toString=function(){return"(x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"},n.prototype.union=function(t){var e=this.clone();if(t.isEmpty())return e;if(e.isEmpty())return e.copyFrom(t),e;var n=Math.min(e.x,t.x),i=Math.min(e.y,t.y);return e.setTo(n,i,Math.max(e.right,t.right)-n,Math.max(e.bottom,t.bottom)-i),e},n.prototype.$getBaseWidth=function(t){var e=Math.abs(Math.cos(t)),n=Math.abs(Math.sin(t));return e*this.width+n*this.height},n.prototype.$getBaseHeight=function(t){var e=Math.abs(Math.cos(t));return Math.abs(Math.sin(t))*this.width+e*this.height},n}(t.XObject);t.Rectangle=e,__reflect(e.prototype,"xgame.Rectangle")}(xgame||(xgame={})),function(t){var e=function(e){function n(){var n=e.call(this)||this;return n._numListeners=0,n.sortEnable=!1,n.invalidateSort=!1,n.nodes=new Map,n.listenerNodePool=new t.ListenerNodePool,n}return __extends(n,e),Object.defineProperty(n.prototype,"numListeners",{get:function(){return this._numListeners},enumerable:!0,configurable:!0}),n.prototype.has=function(t){return this.nodes.has(t)},n.prototype.add=function(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=0),!this.nodes.has(t)){var i=this.listenerNodePool.get();i.listener=t,i.priority=n,i.thisObject=e,this.nodes.set(t,i),this.addNode(i)}},n.prototype.addOnce=function(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=0),!this.nodes.has(t)){var i=this.listenerNodePool.get();i.listener=t,i.priority=n,i.thisObject=e,i.once=!0,this.nodes.set(t,i),this.addNode(i)}},n.prototype.remove=function(t){var e=this.nodes.get(t);e&&(this.sortEnable&&(this.invalidateSort=!0),this.head===e&&(this.head=this.head.next),this.tail===e&&(this.tail=this.tail.previous),this.toAddHead===e&&(this.toAddHead=this.toAddHead.next),this.toAddTail===e&&(this.toAddTail=this.toAddTail.previous),e.previous&&(e.previous.next=e.next),e.next&&(e.next.previous=e.previous),this.nodes.delete(t),this.dispatching?this.listenerNodePool.cache(e):this.listenerNodePool.dispose(e),this._numListeners--),0==this.numListeners&&(this.sortEnable=!1,this.invalidateSort=!1)},n.prototype.removeAll=function(){for(;this.head;){var t=this.head;this.head=this.head.next,this.nodes.delete(t.listener),this.listenerNodePool.dispose(t)}this.tail=null,this.toAddHead=null,this.toAddTail=null,this._numListeners=0,this.invalidateSort=!1,this.sortEnable=!1},n.prototype.startDispatch=function(){this.dispatching=!0,this.sortEnable&&this.invalidateSort&&this.sorts(this.head)},n.prototype.endDispatch=function(){this.dispatching=!1,this.toAddHead&&(this.head?(this.tail.next=this.toAddHead,this.toAddHead.previous=this.tail,this.tail=this.toAddTail):(this.head=this.toAddHead,this.tail=this.toAddTail),this.toAddHead=null,this.toAddTail=null),this.listenerNodePool.releaseCache()},n.prototype.addNode=function(t){t.priority&&(this.sortEnable=!0),this.sortEnable&&(this.invalidateSort=!0),this.dispatching?this.toAddHead?(this.toAddTail.next=t,t.previous=this.toAddTail,this.toAddTail=t):this.toAddHead=this.toAddTail=t:this.head?(this.tail.next=t,t.previous=this.tail,this.tail=t):this.head=this.tail=t,this._numListeners++},n.prototype.sorts=function(t){var e,n;for(e=t;e;){for(n=e.next;null!=n;n=n.next)e.priority<n.priority&&(e.switchNode(n),this.nodes.set(e.listener,e),this.nodes.set(n.listener,n));e=e.next}},n}(t.XObject);t.SignalBase=e,__reflect(e.prototype,"xgame.SignalBase")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dispatch=function(t){var e;for(this.startDispatch(),e=this.head;e;e=e.next){var n=e.execute(t);if(e.once&&this.remove(e.listener),n)break}this.endDispatch()},e.prototype.add=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.add.call(this,e,n,i)},e.prototype.addOnce=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.addOnce.call(this,e,n,i)},e}(t.SignalBase);t.Signal1=e,__reflect(e.prototype,"xgame.Signal1")}(xgame||(xgame={})),function(t){t.IPlayableManager=Symbol.for("IPlayableManager")}(xgame||(xgame={})),function(t){t.IPlayableManagerInternal=Symbol.for("IPlayableManagerInternal")}(xgame||(xgame={})),function(t){var e=function(e){function n(){var n=e.call(this)||this;return n.playables=new t.Dictionary,n.isUpdating=!1,n}return __extends(n,e),n.prototype.initialize=function(){t.SchedulerManager.Instance().registerUpdate(this.advanceTime,this)},n.prototype.advanceTime=function(){var e=this;this.isUpdating||(this.isUpdating=!0,t.__lockobject__(this).simple(function(){var n=t.Time.Instance().deltaTime;e.playables.forValues(function(t){t.advanceTime(n)},e),e.isUpdating=!1},this))},Object.defineProperty(n.prototype,"count",{get:function(){return this.playables.length},enumerable:!0,configurable:!0}),n.prototype.addPlayable=function(e){var n=this;this.playables.containsKey(e.hashCode)||t.__lockobject__(this).simple(function(){e.onComplete.addOnce(n.onPlayComplete,n),n.playables.add(e.hashCode,e)},this)},n.prototype.onPlayComplete=function(t){this.removePlayable(t)},n.prototype.removePlayable=function(e){var n,i,r=this;"number"==typeof e?(n=e,i=this.playables.get(n)):i=e,i&&t.__lockobject__(this).simple(function(){i.onComplete.removeAll(),i.stop(),r.playables.remove(i.hashCode),i.dispose()},this)},n=__decorate([t.impl(t.IPlayableManager,t.IPlayableManagerInternal),__metadata("design:paramtypes",[])],n)}(t.Singleton);t.PlayableManager=e,__reflect(e.prototype,"xgame.PlayableManager",["xgame.IPlayableManager","xgame.IPlayableManagerInternal"])}(xgame||(xgame={})),function(t){t.IPoolable=Symbol.for("IPoolable")}(xgame||(xgame={})),function(t){t.IPoolManager=Symbol.for("IPoolManager")}(xgame||(xgame={})),function(t){var e=function(e){function n(n){var i=e.call(this)||this;return i.$pools=new t.Dictionary,i.$group=n,i}return __extends(n,e),Object.defineProperty(n.prototype,"group",{get:function(){return this.$group},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pools",{get:function(){return this.$pools},enumerable:!0,configurable:!0}),n.prototype.getPool=function(e,n,i){if(void 0===i&&(i=0),this.pools.containsKey(e))return this.pools.get(e);var r=new t.PoolObject(n,i);return r.group=this.group,r.key=e,this.pools.add(e,r),r},n.prototype.fetch=function(t,e,n,i){for(var r=[],o=4;o<arguments.length;o++)r[o-4]=arguments[o];var s=this.getPool(t,e);return s.fetch.apply(s,[n,i].concat(r))},n.prototype.recycle=function(t,e,n){this.getPool(t,e).recycle(n)},n.prototype.release=function(t,e,n,i){this.getPool(t,e).release(n,i)},n.prototype.releases=function(t,e){this.pools.forValues(function(n){n.release(t,e)},this)},n.prototype.forEach=function(t,e){this.pools.forValues(function(n){t.apply(e,[n])},this)},n}(t.XObject);t.PoolGroup=e,__reflect(e.prototype,"xgame.PoolGroup")}(xgame||(xgame={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.object_pools=new t.Dictionary,n.group_pools=new t.Dictionary,n}return __extends(n,e),n.prototype.debug=function(t){var e=this;this.object_pools.forValues(function(t){console.log(t.toString())},this),t&&this.group_pools.forValues(function(t){t.pools.forValues(function(t){console.log(t.toString())},e)},this)},n.prototype.getPool=function(e,n){if(void 0===n&&(n=0),this.object_pools.containsKey(e))return this.object_pools.get(e);var i=new t.PoolObject(e,n);return this.object_pools.add(e,i),i},n.prototype.fetch=function(t,e,n){for(var i=[],r=3;r<arguments.length;r++)i[r-3]=arguments[r];var o=this.getPool(t);return o.fetch.apply(o,[e,n].concat(i))},n.prototype.recycle=function(t,e){this.getPool(t).recycle(e)},n.prototype.release=function(t,e,n){this.getPool(t).release(e,n)},n.prototype.getPoolGroup=function(e){var n=this.group_pools.get(e);return null==n?(n=new t.PoolGroup(e),this.group_pools.add(e,n)):n=this.group_pools.get(e),n},n=__decorate([t.impl(t.IPoolManager)],n)}(t.Singleton);t.PoolManager=e,__reflect(e.prototype,"xgame.PoolManager",["xgame.IPoolManager"])}(xgame||(xgame={})),function(t){var e=function(e){function n(t,n){void 0===n&&(n=0);var i=e.call(this)||this;if(i.instances=[],i.$create=0,i.group="",i.key="",i.Clazz=t,n>0)for(var r=0;r<n;r++)i.instances.push(new t);return i}return __extends(n,e),Object.defineProperty(n.prototype,"create",{get:function(){return this.$create},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this.instances.length},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"expired",{get:function(){return!!this.fulled},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fulled",{get:function(){return this.create>0&&this.create==this.count},enumerable:!0,configurable:!0}),n.prototype.toString=function(){var e={create:this.create,count:this.count,group:this.group,key:this.key,ClassType:t.getQualifiedClassName(this.Clazz)};return JSON.stringify(e)},n.prototype.fetch=function(t,e){for(var n,i,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return this.count>0?this.instances.shift():((n=t?t.apply(e,r):new((i=this.Clazz).bind.apply(i,[void 0].concat(r)))).fromPoolHashCode=this.hashCode,this.$create++,n)},n.prototype.ping=function(t){t.fromPoolHashCode=this.hashCode,this.$create++},n.prototype.recycle=function(t){t.fromPoolHashCode==this.hashCode&&-1==this.instances.indexOf(t)&&(this.instances.push(t),t.dispose&&t.dispose())},n.prototype.release=function(t,e){for(;this.instances.length;){var n=this.instances.shift();t&&t.apply(e,[n]),n.release&&n.release()}this.$create=0},n.EXPIRE_TIME=60,n}(t.XObject);t.PoolObject=e,__reflect(e.prototype,"xgame.PoolObject")}(xgame||(xgame={})),function(t){t.DisposableGroup.prototype.registerPreUpdate=function(e,n,i){var r=t.SchedulerManager.Instance().registerPreUpdate(e,n,i);this.register(r)},t.DisposableGroup.prototype.registerUpdate=function(e,n,i){var r=t.SchedulerManager.Instance().registerUpdate(e,n,i);this.register(r)},t.DisposableGroup.prototype.registerPostUpdate=function(e,n,i){var r=t.SchedulerManager.Instance().registerPostUpdate(e,n,i);this.register(r)},t.DisposableGroup.prototype.registerTimer=function(e,n,i,r,o){var s=t.SchedulerManager.Instance().registerTimer(e,n,i,r,o);this.register(s)}}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.switchNode=function(t){var e=t.listener,n=t.thisObject,i=t.once,r=t.priority;t.listener=this.listener,t.thisObject=this.thisObject,t.once=this.once,t.priority=this.priority,this.listener=e,this.thisObject=n,this.once=i,this.priority=r},e.prototype.execute=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(null!=this.listener){var n=void 0,i=this.listener.length;for(n=t.length;n<i;++n)t[n]=null;switch(i){case 0:return this.listener.apply(this.thisObject);default:return this.listener.apply(this.thisObject,t.slice(0,i))}}},e}(t.XObject);t.ListenerNode=e,__reflect(e.prototype,"xgame.ListenerNode")}(xgame||(xgame={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prototype.get=function(){if(this.tail){var e=this.tail;return this.tail=this.tail.previous,e.previous=null,e}return new t.ListenerNode},n.prototype.dispose=function(t){t.listener=null,t.thisObject=null,t.once=!1,t.next=null,t.previous=this.tail,this.tail=t},n.prototype.cache=function(t){t.listener=null,t.thisObject=null,t.previous=this.cacheTail,this.cacheTail=t},n.prototype.releaseCache=function(){for(;this.cacheTail;){var t=this.cacheTail;this.cacheTail=t.previous,t.next=null,t.previous=this.tail,this.tail=t}},n}(t.XObject);t.ListenerNodePool=e,__reflect(e.prototype,"xgame.ListenerNodePool")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dispatch=function(){var t;for(this.startDispatch(),t=this.head;t;t=t.next){var e=t.execute();if(t.once&&this.remove(t.listener),e)break}this.endDispatch()},e.prototype.add=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.add.call(this,e,n,i)},e.prototype.addOnce=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.addOnce.call(this,e,n,i)},e}(t.SignalBase);t.Signal0=e,__reflect(e.prototype,"xgame.Signal0")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dispatch=function(t,e){var n;for(this.startDispatch(),n=this.head;n;n=n.next){var i=n.execute(t,e);if(n.once&&this.remove(n.listener),i)break}this.endDispatch()},e.prototype.add=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.add.call(this,e,n,i)},e.prototype.addOnce=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.addOnce.call(this,e,n,i)},e}(t.SignalBase);t.Signal2=e,__reflect(e.prototype,"xgame.Signal2")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dispatch=function(t,e,n){var i;for(this.startDispatch(),i=this.head;i;i=i.next){var r=i.execute(t,e,n);if(i.once&&this.remove(i.listener),r)break}this.endDispatch()},e.prototype.add=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.add.call(this,e,n,i)},e.prototype.addOnce=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.addOnce.call(this,e,n,i)},e}(t.SignalBase);t.Signal3=e,__reflect(e.prototype,"xgame.Signal3")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dispatch=function(t,e,n,i){var r;for(this.startDispatch(),r=this.head;r;r=r.next){var o=r.execute(t,e,n,i);if(r.once&&this.remove(r.listener),o)break}this.endDispatch()},e.prototype.add=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.add.call(this,e,n,i)},e.prototype.addOnce=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.addOnce.call(this,e,n,i)},e}(t.SignalBase);t.Signal4=e,__reflect(e.prototype,"xgame.Signal4")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dispatch=function(t,e,n,i,r){var o;for(this.startDispatch(),o=this.head;o;o=o.next){var s=o.execute(t,e,n,i,r);if(o.once&&this.remove(o.listener),s)break}this.endDispatch()},e.prototype.add=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.add.call(this,e,n,i)},e.prototype.addOnce=function(e,n,i){void 0===n&&(n=null),void 0===i&&(i=0),t.prototype.addOnce.call(this,e,n,i)},e}(t.SignalBase);t.Signal5=e,__reflect(e.prototype,"xgame.Signal5")}(xgame||(xgame={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.dispatch=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(this.startDispatch(),t=this.head;t;t=t.next){var i=t.execute.apply(t,e);if(t.once&&this.remove(t.listener),i)break}this.endDispatch()},e}(t.SignalBase);t.SignalAny=e,__reflect(e.prototype,"xgame.SignalAny")}(xgame||(xgame={})),function(t){var e="0123456789abcdefghijklmnopqrstuvwxyz",n=function(){function t(){}return t.range=function(t,e){var n=(new Date).getTime();return(t=t||0)+(n=(9301*n+49297)%233280)/233280*((e=e||1)-t)},t.chars=function(t){void 0===t&&(t=6);for(var n="",i=e.length,r=t;r>0;--r)n+=e[Math.floor(Math.random()*i)];return n},t}();t.Random=n,__reflect(n.prototype,"xgame.Random")}(xgame||(xgame={})),function(t){var e=function(){function e(){}return e.shuffle=function(e){for(var n=e.length-1;n>1;){n--;var i=t.Random.range(0,n+1),r=e[i];e[i]=e[n],e[n]=r}},e.peek=function(t){return t[0]},e.push=function(t,e){t.splice(0,0,e)},e.pop=function(t){return t.shift()},e}();t.ArrayUtils=e,__reflect(e.prototype,"xgame.ArrayUtils")}(xgame||(xgame={})),function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.$promise=new Promise(function(t,n){e.$resolve=t,e.$reject=n}),e}return __extends(e,t),e.prototype.resolve=function(t){this.$resolve(t)},e.prototype.reject=function(t){this.$reject(t)},Object.defineProperty(e.prototype,"promise",{get:function(){return this.$promise},enumerable:!0,configurable:!0}),e}(t.XObject);t.Deferred=e,__reflect(e.prototype,"xgame.Deferred")}(xgame||(xgame={})),function(t){var e;!function(t){t[t.Frame=1]="Frame",t[t.Milliseconds=2]="Milliseconds",t[t.Seconds=3]="Seconds",t[t.WaitUntil=4]="WaitUntil"}(e=t.AwaitType||(t.AwaitType={}));var n=function(n){function r(){var e=null!==n&&n.apply(this,arguments)||this;return e.timer=0,e.callback_complete=new t.Signal0,e.deferred=new t.Deferred,e}return __extends(r,n),r.prototype.onComplete=function(){return this.callback_complete.removeAll(),this.callback_complete},r.prototype.setAwaiter=function(t,n){if(void 0===n&&(n=e.Frame),this.type=n,e.WaitUntil==n)this.handler=t;else{n==e.Frame?this.timer=t*(1e3/r.FPS):n==e.Seconds?this.timer=1e3*t:this.timer=t}},r.prototype.await=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.deferred=new t.Deferred,this.scheduler=t.SchedulerManager.Instance().registerUpdate(this.advanceTime,this),[2,this.deferred.promise]})})},r.prototype.advanceTime=function(){this.type==e.WaitUntil?this.handler()&&(this.deferred&&this.deferred.resolve(),this.callback_complete.dispatch(),this.deferred=void 0,this.dispose()):(this.timer-=t.Time.Instance().deltaTime,this.timer<=0&&(this.deferred&&this.deferred.resolve(),this.callback_complete.dispatch(),this.deferred=void 0,this.dispose()))},r.prototype.dispose=function(){this.scheduler&&(t.SchedulerManager.Instance().removeUpdate(this.scheduler),this.scheduler=void 0),this.deferred=void 0,this.callback_complete.removeAll(),i.recycle(this)},r.FPS=60,r}(t.XObject);t.Awaiter=n,__reflect(n.prototype,"xgame.Awaiter",["xgame.IDisposable"]);var i=new t.PoolObject(n);t.waitEndFrames=function(t,r,o){return void 0===t&&(t=0),__awaiter(this,void 0,void 0,function(){var s;return __generator(this,function(a){return(s=i.fetch(function(){return new n},this)).setAwaiter(t,e.Frame),r&&r.apply(o,[s]),[2,s.await()]})})},t.waitMilliseconds=function(t,r,o){return __awaiter(this,void 0,void 0,function(){var s;return __generator(this,function(a){return s=i.fetch(function(){return new n},this),r&&r.apply(o,[s]),s.setAwaiter(t,e.Milliseconds),[2,s.await()]})})},t.waitSeconds=function(t,r,o){return __awaiter(this,void 0,void 0,function(){var s;return __generator(this,function(a){return(s=i.fetch(function(){return new n},this)).setAwaiter(t,e.Seconds),r&&r.apply(o,[s]),[2,s.await()]})})},t.waitUntil=function(t,r,o){return __awaiter(this,void 0,void 0,function(){var s;return __generator(this,function(a){return(s=i.fetch(function(){return new n},this)).setAwaiter(t,e.WaitUntil),r&&r.apply(o,[s]),[2,s.await()]})})}}(xgame||(xgame={})),function(t){t.createInstance=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var r=new(e.bind.apply(e,[void 0].concat(n)));return t.injectInstance(r)}}(xgame||(xgame={})),function(t){var e={};t.getDefinitionByName=function(t){if(!t)return null;var n=e[t];if(n)return n;var i=t.split("."),r=i.length;n=__global;for(var o=0;o<r;o++)if(!(n=n[i[o]]))return null;return e[t]=n,n}}(xgame||(xgame={}));var __global=this.__global||this;!function(t){t.getQualifiedClassChainNames=function(e){var n=[];n.push(t.getQualifiedClassName(e));for(var i=t.getPrototype(e);i;){var r=t.getQualifiedClassName(i);r&&-1==n.indexOf(r)&&n.push(r),i=t.getPrototype(i)}return n}}(xgame||(xgame={})),function(t){t.getQualifiedSuperclassName=function(e){if(!e||"object"!=typeof e&&!e.prototype)return null;var n=e.prototype?e.prototype:Object.getPrototypeOf(e),i=Object.getPrototypeOf(n);if(!i)return null;var r=t.getQualifiedClassName(i.constructor);return r||null}}(xgame||(xgame={})),function(t){var e=function(t){function e(e){var n=t.call(this)||this;return n.varnames=e,n.pos=0,n.tokenprio=0,n.tokenindex=0,n.tmpprio=0,n.funcs1=["sin","cos","tan","asin","acos","atan","sqrt","log","abs","ceil","floor","round","random","fac"],n._funcs1=[n._sin,n._cos,n._tan,n._asin,n._acos,n._atan,n._sqrt,n._log,n._abs,n._ceil,n._floor,n._round,n._random,n._fac],n.funcs2=["min","max","pyt"],n._funcs2=[n._min,n._max,n._pyt,n._add,n._sub,n._mult,n._div,n._mod,n._pow],n.consts=["E","PI"],n.constvalues=[Math.E,Math.PI],n.TNUMBER=0,n.TFUNC1=1,n.TFUNC2=2,n.TVAR=3,n}return __extends(e,t),e.prototype.parse=function(t){this.errormsg="",this.success=!0;var e=[],i=[];this.tmpprio=0;var r=[1,0,1,1,0,0,1],o=0;for(this.expression=t,this.pos=0;this.pos<this.expression.length;)if(this.isOperator())if(this.isSign()&&1==r[6]){var s=new n(this.TNUMBER,0,0,-1);i.push(s),this.tokenprio=4,this.tokenindex=5,o+=2,this.addfunc(i,e,this.TFUNC2),r=[1,0,1,1,0,0,1]}else if(this.isComment());else{if(0==r[1])return this.error_parsing(this.pos,"unexpected operator"),[];o+=2,this.addfunc(i,e,this.TFUNC2),r=[1,0,1,1,0,0,1]}else if(this.isNumber()){if(0==r[0])return this.error_parsing(this.pos,"unexpected number"),[];var a=new n(this.TNUMBER,0,0,this.tokennumber);i.push(a),r=[0,1,0,0,1,1,0]}else if(this.isLeftParenth()){if(0==r[3])return this.error_parsing(this.pos,'unexpected "("'),[];r=[1,0,1,1,0,0,1]}else if(this.isRightParenth()){if(0==r[4])return this.error_parsing(this.pos,'unexpected ")"'),[];r=[0,1,0,0,1,0,0]}else if(this.isComma()){if(0==r[5])return this.error_parsing(this.pos,'unexpected ","'),[];r=[1,0,0,0,0,0,1]}else if(this.isConst()){if(0==r[0])return this.error_parsing(this.pos,"unexpected constant"),[];var h=new n(this.TNUMBER,0,0,this.tokennumber);i.push(h),r=[0,1,0,0,1,1,0]}else if(this.isFunc1()){if(0==r[3])return this.error_parsing(this.pos,"unexpected function"),[];this.addfunc(i,e,this.TFUNC1),o++,r=[0,0,0,1,0,0,0]}else if(this.isFunc2()){if(0==r[3])return this.error_parsing(this.pos,"unexpected function"),[];this.addfunc(i,e,this.TFUNC2),o+=2,r=[0,0,0,1,0,0,0]}else if(this.isVar()){if(0==r[0])return this.error_parsing(this.pos,"unexpected variable"),[];var u=new n(this.TVAR,this.tokenindex,0,0);i.push(u),r=[0,1,0,0,1,1,0]}else if(!this.isWhite())return""==this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg),[];if(this.tmpprio<0||this.tmpprio>=10)return this.error_parsing(this.pos,'unmatched "()"'),[];for(;e.length>0;){var c=e.pop();i.push(c)}return o+1!=i.length?(this.error_parsing(this.pos,"parity"),[]):i},e.prototype.simplify=function(t){var e,i,r,o,s=[],a=[],h=t.length,u=0;for(u=0;u<h;u++){var c=(o=t[u]).type_;if(c==this.TNUMBER)s.push(o);else if(c==this.TFUNC2&&s.length>1)i=s.pop(),e=s.pop(),r=this._funcs2[o.index_],o=new n(this.TNUMBER,0,0,r(e.number_,i.number_)),s.push(o);else if(c==this.TFUNC1&&s.length>0)e=s.pop(),r=this._funcs1[o.index_],o=new n(this.TNUMBER,0,0,r(e.number_)),s.push(o);else{for(;s.length>0;)a.push(s.shift());a.push(o)}}for(;s.length>0;)a.push(s.shift());return a},e.prototype.eval=function(t,e){var n,i,r,o,s=[],a=t.length,h=0;for(h=0;h<a;h++){var u=(o=t[h]).type_;u==this.TNUMBER?s.push(o.number_):u==this.TFUNC2?(i=s.pop(),n=s.pop(),r=this._funcs2[o.index_],s.push(r(n,i))):u==this.TVAR?s.push(e[o.index_]):u==this.TFUNC1&&(n=s.pop(),r=this._funcs1[o.index_],s.push(r(n)))}return s[0]},e.prototype.addfunc=function(t,e,i){for(var r=new n(i,this.tokenindex,this.tokenprio+this.tmpprio,0);e.length>0&&r.prio_<=e[e.length-1].prio_;)t.push(e.pop());e.push(r)},e.prototype.error_parsing=function(t,e){this.success=!1,this.errormsg="parse error [column "+t+"]: "+e,console.log(this.errormsg)},e.prototype.isNumber=function(){for(var t=!1,e="";this.pos<this.expression.length;){var n=this.expression.charCodeAt(this.pos);if(!(n>=48&&n<=57||46==n))break;e+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(e),t=!0}return t},e.prototype.isConst=function(){for(var t,e=0;e<this.consts.length;e++)if(t=this.expression.substr(this.pos,this.consts[e].length),this.consts[e]==t)return this.tokennumber=this.constvalues[e],this.pos+=t.length,!0;return!1},e.prototype.isOperator=function(){var t=this.expression.charCodeAt(this.pos);if(43==t)this.tokenprio=0,this.tokenindex=3;else if(45==t)this.tokenprio=0,this.tokenindex=4;else if(42==t)this.tokenprio=1,this.tokenindex=5;else if(47==t)this.tokenprio=2,this.tokenindex=6;else if(37==t)this.tokenprio=2,this.tokenindex=7;else{if(94!=t)return!1;this.tokenprio=3,this.tokenindex=8}return this.pos++,!0},e.prototype.isSign=function(){return 45==this.expression.charCodeAt(this.pos-1)},e.prototype.isLeftParenth=function(){return 40==this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},e.prototype.isRightParenth=function(){return 41==this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},e.prototype.isComma=function(){return 44==this.expression.charCodeAt(this.pos)&&(this.pos++,!0)},e.prototype.isWhite=function(){return 32==this.expression.charCodeAt(this.pos)&&(this.pos++,!0)},e.prototype.isFunc1=function(){for(var t,e=0;e<this.funcs1.length;e++){var n=this.funcs1[e].length;if(t=this.expression.substr(this.pos,n),this.funcs1[e]==t)return this.tokenindex=e,this.tokenprio=5,this.pos+=n,!0}return!1},e.prototype.isFunc2=function(){for(var t,e=0;e<this.funcs2.length;e++){var n=this.funcs2[e].length;if(t=this.expression.substr(this.pos,n),this.funcs2[e]==t)return this.tokenindex=e,this.tokenprio=5,this.pos+=n,!0}return!1},e.prototype.isVar=function(){for(var t="",e=0;e<this.varnames.length;e++)if(t=this.expression.substr(this.pos,this.varnames[e].length),this.varnames[e]==t)return this.tokenindex=e,this.tokenprio=4,this.pos+=t.length,!0;return!1},e.prototype.isComment=function(){return 47==this.expression.charCodeAt(this.pos-1)&&42==this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1==this.pos&&(this.pos=this.expression.length),!0)},e.prototype._add=function(t,e){return t+e},e.prototype._sub=function(t,e){return t-e},e.prototype._mult=function(t,e){return t*e},e.prototype._div=function(t,e){return t/e},e.prototype._mod=function(t,e){return t%e},e.prototype._pow=function(t,e){return Math.pow(t,e)},e.prototype._sin=function(t){return Math.sin(t)},e.prototype._cos=function(t){return Math.cos(t)},e.prototype._tan=function(t){return Math.tan(t)},e.prototype._asin=function(t){return Math.asin(t)},e.prototype._acos=function(t){return Math.acos(t)},e.prototype._atan=function(t){return Math.atan(t)},e.prototype._sqrt=function(t){return Math.sqrt(t)},e.prototype._log=function(t){return Math.log(t)},e.prototype._abs=function(t){return Math.abs(t)},e.prototype._ceil=function(t){return Math.ceil(t)},e.prototype._floor=function(t){return Math.floor(t)},e.prototype._round=function(t){return Math.round(t)},e.prototype._random=function(t){return Math.random()*t},e.prototype._fac=function(t){for(var e=t=Math.floor(t);t>1;)e*=--t;return e},e.prototype._min=function(t,e){return Math.min(t,e)},e.prototype._max=function(t,e){return Math.max(t,e)},e.prototype._pyt=function(t,e){return Math.sqrt(t*t+e*e)},e}(t.XObject);t.MathParser=e,__reflect(e.prototype,"xgame.MathParser");var n=function(){return function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.type_=t,this.index_=e,this.prio_=n,this.number_=i}}();t.Token=n,__reflect(n.prototype,"xgame.Token")}(xgame||(xgame={})),function(t){var e=t.Point,n=t.Rectangle,i=function(){function t(){}return t.distanceBetweenTwoPoints=function(t,e,n,i){var r=t-e,o=n-i;return Math.sqrt(r*r+o*o)},t.rotatePoint=function(t,n,i,r){void 0===r&&(r=null);var o=Math.cos(i),s=Math.sin(i);return r?(r.setTo(t*o+n*s,-t*s+n*o),null):new e(t*o+n*s,-t*s+n*o)},t.lineEquation=function(t,e){var n=(e.y-t.y)/(e.x-t.x);return{m:n,b:t.y-n*t.x}},t.lerp=function(t,e,n){return t+(e-t)*n},t.inverseLerp=function(t,e,n){if(t>e)return(n-e)/(t-e);if(t<e)return(n-t)/(e-t);throw new Error("a argument must be different from b argument.")},t.map=function(e,n,i,r,o){return void 0===r&&(r=0),void 0===o&&(o=1),t.clamp01(t.inverseLerp(n,i,e))*(o-r)+r},t.createAABB=function(t,e,i,r,o){void 0===o&&(o=0);var s=new n(t,e,i,r);if(0==o)return s;var a,h,u=Math.cos(o),c=Math.sin(o);return c<0?(c=-c,h=!1):h=!0,u<0?(u=-u,a=!1):a=!0,s.width=r*c+i*u,s.height=r*u+i*c,a?h?s.x-=r*c:s.y-=i*c:h?(s.x-=i*u+r*c,s.y-=r*u):(s.x-=i*u,s.y-=i*c+r*u),s},t.createAABBData=function(t,e,i,r,o,s){void 0===o&&(o=0),void 0===s&&(s=null),null==s&&(s={offsetX:0,offsetY:0,rect:new n}),s.rect.setTo(t,e,i,r);var a=0,h=0;if(0==o)return s.offsetX=0,s.offsetY=0,s;var u,c,p=Math.cos(o),l=Math.sin(o);return l<0?(l=-l,c=!1):c=!0,p<0?(p=-p,u=!1):u=!0,s.rect.width=r*l+i*p,s.rect.height=r*p+i*l,u?c?a-=r*l:h-=i*l:c?(a-=i*p+r*l,h-=r*p):(a-=i*p,h-=i*l+r*p),s.rect.x+=s.offsetX=a,s.rect.y+=s.offsetY=h,s},t.angleBetween=function(t,e,n){var i=2*Math.PI;return t=(i+t%i)%i,(e=(100*i+e)%i)<(n=(100*i+n)%i)?e<=t&&t<=n:e<=t||t<=n},t.linesIntersection=function(n,i,r,o,s,a,h,u,c){var p,l,f,d,g,y,m;void 0===c&&(c=!0),y=r*i-n*o,m=h*a-s*u;var v=(l=o-i)*(g=s-h)-(f=u-a)*(d=n-r);if(0==v)return null;if((p=new e).x=(d*m-g*y)/v,p.y=(f*y-l*m)/v,c){if(t.pow2(p.x-r)+t.pow2(p.y-o)>t.pow2(n-r)+t.pow2(i-o))return null;if(t.pow2(p.x-n)+t.pow2(p.y-i)>t.pow2(n-r)+t.pow2(i-o))return null;if(t.pow2(p.x-h)+t.pow2(p.y-u)>t.pow2(s-h)+t.pow2(a-u))return null;if(t.pow2(p.x-s)+t.pow2(p.y-a)>t.pow2(s-h)+t.pow2(a-u))return null}return p},t.pow2=function(t){return t*t},t.clamp01=function(t){return t<0?0:t>1?1:t},t.clamp=function(t,e,n){return Math.max(e,Math.min(n,t))},t.random=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=1),t+(e-t)*Math.random()},t.randomInt=function(t,e){return Math.floor(Math.random()*(1+e-t))+t},t.getBestFitRatio=function(t,e){return e.height/e.width>t.height/t.width?e.width/t.width:e.height/t.height},t.getFillRatio=function(t,e){return e.height/e.width>t.height/t.width?e.height/t.height:e.width/t.width},t.getArrayRandomItem=function(e){return e[t.randomInt(0,e.length-1)]},t.getNextInArray=function(t,e){var n=e.lastIndexOf(t)+1;return n>=e.length&&(n=0),e[n]},t.getPreviousInArray=function(t,e){var n=e.lastIndexOf(t)-1;return n<0&&(n=e.length-1),e[n]},t.getRandomColor=function(e,n,i,r){void 0===e&&(e=0),void 0===n&&(n=255),void 0===i&&(i=!1),void 0===r&&(r=!1),n=n>255?255:n,e=e>255?255:e;var o=t.randomInt(e,n),s=t.randomInt(e,n),a=t.randomInt(e,n);return i?(r?t.randomInt(0,255):255)<<24|o<<16|s<<8|a:o<<16|s<<8|a},t.colorLerp=function(t,e,n){var i=1-n;return(t>>24&255)*i+(e>>24&255)*n<<24|(t>>16&255)*i+(e>>16&255)*n<<16|(t>>8&255)*i+(e>>8&255)*n<<8|(255&t)*i+(255&e)*n},t.abs=function(t){return t<0?-t:t},t.sign=function(t){return t<0?-1:1},t.Repeat=function(t,e){for(var n=t;n<0;)n+=e;return n%e},t.logx=function(t,e){return void 0===e&&(e=10),Math.log(t)/Math.log(e)},t.evaluateQuadraticCurve=function(t,e,n,i){return void 0===i&&(i=0),(1-i)*(1-i)*t+2*(1-i)*i*e+i*i*n},t.evaluateCubicCurve=function(t,e,n,i,r){return void 0===r&&(r=0),t+(3*-t+r*(3*t-t*r))*r+(3*e+r*(-6*e+3*e*r))*r+(3*n-3*n*r)*r*r+i*r*r*r},t.easeInQuad=function(t,e,n,i){return n*(t/=i)*t+e},t.easeOutQuad=function(t,e,n,i){return-n*(t/=i)*(t-2)+e},t.easeInCubic=function(t,e,n,i){return n*(t/=i)*t*t+e},t.easeOutCubic=function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},t.easeInQuart=function(t,e,n,i){return n*(t/=i)*t*t*t+e},t.easeOutQuart=function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},t}();t.MathUtils=i,__reflect(i.prototype,"xgame.MathUtils")}(xgame||(xgame={})),function(t){var e=["__meta__","__class__","__types__","__xgame_attributes__","__ns__","__implements__","__xlisteners__","__xbindables__"];function n(t,e){if("function"!=typeof t[e])return!1;var n=t[e].toString(),i=n.indexOf("{"),r=n.lastIndexOf("}");return""==(n=n.substring(i+1,r)).trim()}function i(t,i){for(var r in i)"prototype"!=r&&i.hasOwnProperty(r)&&(t[r]=i[r]);for(var o=t.prototype,s=i.prototype,a=Object.keys(s),h=a.length,u=0;u<h;u++){var c=a[u];if(!(e.indexOf(c)>=0)&&(!o.hasOwnProperty(c)||n(o,c))){var p=Object.getOwnPropertyDescriptor(s,c);Object.defineProperty(o,c,p)}}}t.mixin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){for(var n=0,r=t;n<r.length;n++)i(e,r[n])}},t.__mixin__=i}(xgame||(xgame={})),function(t){var e=function(){function t(){}return t.html2Escape=function(t){var e={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"};return t.replace(/[<>&"]/g,function(t){return e[t]})},t.escape2Html=function(t){var e={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return t.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(t){return e[t]})},t.nbsp2Space=function(t){var e={nbsp:" "};return t.replace(/&(nbsp);/gi,function(t){return e[t]})},t.format=function(e){for(var n,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];for(var o=i.length,s=0;s<o;s++)t.reg_caches[s]?n=t.reg_caches[s]:(n=new RegExp("\\{"+s+"\\}","gm"),t.reg_caches[s]=n),e=e.replace(n,i[s]);return e},t.beginWiths=function(t,e){return 0==t.indexOf(e)},t.endWiths=function(t,e){return t.slice(t.length-e.length)==e},t.trim=function(t,e){return t=t.replace(/^\s\s*/,"").replace(/\s\s*$/,""),e&&(t=t.replace(/\s+/g,"")),t},t.eraseHtml=function(t){return t.replace(/<\/?.+?>/g,"")},t.reg_caches=[],t}();t.StringUtils=e,__reflect(e.prototype,"xgame.StringUtils"),String.prototype.beginWiths=function(t){return e.beginWiths(this,t)},String.prototype.endWiths=function(t){return e.endWiths(this,t)},String.prototype.trim=function(t){return e.trim(this,t)},String.prototype.eraseHtml=function(){return e.eraseHtml(this)},String.prototype.html2Escape=function(){return e.html2Escape(this)},String.prototype.escape2Html=function(){return e.escape2Html(this)},String.prototype.nbsp2Space=function(){return e.nbsp2Space(this)},String.prototype.format=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.format.apply(e,[this].concat(t))},String.prototype.padLeft=function(t,e){null==e&&(e=" ");var n=this+"";return n.length<t?new Array(t-n.length+1).join(e)+n:n},String.prototype.padRight=function(t,e){null==e&&(e=" ");var n=this+"";return n.length<t?n+new Array(t-n.length+1).join(e):n}}(xgame||(xgame={})),function(t){var e;!function(t){t[t.And=0]="And",t[t.Or=1]="Or"}(e=t.FlagsCheckType||(t.FlagsCheckType={}));var n=function(n){function i(){var e=null!==n&&n.apply(this,arguments)||this;return e.flags=new t.Dictionary,e}return __extends(i,n),i.prototype.checkFlags=function(t,n){void 0===n&&(n=e.And);for(var i=0,r=0,o=t;r<o.length;r++){var s=o[r];if(this.flags.containsKey(s)&&(i++,n==e.Or))break}return i>0},i.prototype.addFlags=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,i=t;n<i.length;n++){var r=i[n];this.flags.containsKey(r)||this.flags.add(r,!0)}},i.prototype.removeFlags=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.flags.removeKeys(t)},i}(t.XObject);t.VectorFlags=n,__reflect(n.prototype,"xgame.VectorFlags")}(xgame||(xgame={})),function(t){t.IXTaskManager=Symbol.for("IXTaskManager")}(xgame||(xgame={})),function(t){t.IXTaskManagerInternal=Symbol.for("IXTaskManagerInternal")}(xgame||(xgame={})),function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.isRunning=!0,t}return __extends(n,e),n.prototype.initialize=function(){this.mainTask=new t.MainTask,t.SchedulerManager.Instance().registerUpdate(this.onUpdate,this)},n.prototype.onUpdate=function(){this.isRunning&&this.mainTask.mainLoop()},n.prototype.addTask=function(t,e,n){void 0===n&&(n=0);var i=this.mainTask.addTask(e,n);return i.onMainRunning=t,i},n.prototype.removeTask=function(t){this.mainTask.removeTask(t)},n.prototype.pause=function(){this.isRunning=!1},n.prototype.resume=function(){this.isRunning=!0},n=__decorate([t.impl(t.IXTaskManager),__metadata("design:paramtypes",[])],n)}(t.Singleton);t.XTaskManager=e,__reflect(e.prototype,"xgame.XTaskManager",["xgame.IXTaskManager","xgame.IXObject","xgame.IXTaskManagerInternal"])}(xgame||(xgame={})),function(t){!function(t){t[t.Invalidate=0]="Invalidate",t[t.Success=1]="Success",t[t.Failure=2]="Failure"}(t.XTaskResult||(t.XTaskResult={}))}(xgame||(xgame={})),function(t){!function(t){t[t.Parallel=1]="Parallel",t[t.Selector=2]="Selector",t[t.Sequence=3]="Sequence",t[t.RacingSequence=4]="RacingSequence"}(t.XTaskMode||(t.XTaskMode={}))}(xgame||(xgame={})),function(t){!function(t){t[t.UnInitialize=1]="UnInitialize",t[t.Initialized=2]="Initialized",t[t.Validated=3]="Validated",t[t.Executing=4]="Executing",t[t.SelfCompleted=5]="SelfCompleted",t[t.Failured=6]="Failured",t[t.Completed=7]="Completed"}(t.XTaskState||(t.XTaskState={}))}(xgame||(xgame={})),function(t){!function(t){t[t.Infinite=1]="Infinite",t[t.Limit=2]="Limit"}(t.XTaskLifeMode||(t.XTaskLifeMode={}))}(xgame||(xgame={})),function(t){t.IXTask=Symbol.for("IXTask")}(xgame||(xgame={})),function(t){var e=t.Dictionary,n=function(n){function i(i,r){void 0===i&&(i=t.XTaskMode.Parallel),void 0===r&&(r=0);var o=n.call(this)||this;return o.isMain=!1,o.isRoot=!1,o.children=new e,o.countCompleted=0,o.walkIndex=0,o.currentChildComplete=0,o.currentComplete=0,o.$forRemoves=[],o.$forResets=[],o.setTaskState(t.XTaskState.UnInitialize),o.mode=i,o.lifeCount=r,o.result=t.XTaskResult.Invalidate,o.lifeMode=r>0?t.XTaskLifeMode.Limit:t.XTaskLifeMode.Infinite,o}return __extends(i,n),Object.defineProperty(i.prototype,"root",{get:function(){for(var t=this;t;){if(t&&t.isRoot)return t;t=t.parent}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childCount",{get:function(){return this.children.length},enumerable:!0,configurable:!0}),i.prototype.setDelegate=function(t){this.$delegate=t},i.prototype.addTask=function(e,n,i){var r=this;void 0===n&&(n=t.XTaskMode.Parallel),void 0===i&&(i=0),this.simple(function(){var t=e;"function"==typeof e&&(t=new e(n,i)),t.parent=r,r.isMain&&(t.isRoot=!0),r.children.add(t.hashCode,t)},this)},i.prototype.removeTask=function(t){var e=this;this.simple(function(){var n=t;("number"!=typeof t&&(n=t.hashCode),e.children.containsKey(n))&&(e.children.remove(n).parent=void 0)},this)},i.prototype.mainLoop=function(){if(this.checkRemoves(),this.checkResets(),this.state==t.XTaskState.SelfCompleted&&this.childCount>0){this.currentChildComplete=0,this.currentComplete=this.childCount,this.mode==t.XTaskMode.Selector&&(this.currentComplete=1);for(var e=this.walkIndex;e<this.childCount;e++){var n=this.children.indexValue(e);if(this.walkTask(n),this.mode==t.XTaskMode.Sequence||this.mode==t.XTaskMode.RacingSequence){if(this.mode==t.XTaskMode.Sequence&&n.state!=t.XTaskState.Completed)break;if(n.state==t.XTaskState.Executing){this.walkIndex=e;break}if(n.state==t.XTaskState.Completed){this.walkIndex<this.childCount-1&&this.walkIndex++;break}}else if(this.mode==t.XTaskMode.Selector){if(n.state==t.XTaskState.Validated||n.state==t.XTaskState.Executing){this.walkIndex=e;break}if(n.state==t.XTaskState.SelfCompleted||n.state==t.XTaskState.Completed)break}}this.CheckComplete()}},i.prototype.initialize=function(){this.setTaskState(t.XTaskState.Initialized),this.walkIndex=0,this.currentChildComplete=0,this.currentComplete=0,this.$delegate&&this.$delegate.initialize&&this.$delegate.initialize(this)},i.prototype.validate=function(){return!this.$delegate||!this.$delegate.validate||this.$delegate.validate(this)},i.prototype.execute=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},i.prototype.update=function(){this.$delegate&&this.$delegate.update&&this.$delegate.update(this)},i.prototype.selfComplete=function(e){void 0===e&&(e=t.XTaskResult.Success),this.setTaskState(t.XTaskState.SelfCompleted),this.result=e,this.$delegate&&this.$delegate.selfComplete&&this.$delegate.selfComplete(this)},i.prototype.complete=function(){this.setTaskState(t.XTaskState.Completed),this.countCompleted++;var e=this.parent;e&&e.isMain&&this.onMainRunning&&t.XTaskManager.Instance().mainTask.unlock(this),this.$delegate&&this.$delegate.complete&&this.$delegate.complete(this)},i.prototype.failure=function(){this.setTaskState(t.XTaskState.Failured);var e=this.parent;e&&e.isMain&&this.onMainRunning&&t.XTaskManager.Instance().mainTask.unlock(this),this.$delegate&&this.$delegate.failure&&this.$delegate.failure(this)},i.prototype.reset=function(){this.result=t.XTaskResult.Invalidate,this.setTaskState(t.XTaskState.Initialized),this.walkIndex=0,this.currentChildComplete=0,this.currentComplete=0,this.children.forValues(function(t){t.reset()}),this.$delegate&&this.$delegate.reset&&this.$delegate.reset(this)},i.prototype.setTaskState=function(t){var e=this;this.simple(function(){e.state=t},this)},i.prototype.internalExecute=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.setTaskState(t.XTaskState.Executing),this.parent.isMain&&this.onMainRunning&&t.XTaskManager.Instance().mainTask.lock(this),[4,this.execute()];case 1:return e.sent(),this.$delegate&&this.$delegate.execute?[4,this.$delegate.execute(this)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})},i.prototype.walkTask=function(e){var n=this.isMain&&t.XTaskManager.Instance().mainTask.isLockTask(e);switch(e.state){case t.XTaskState.UnInitialize:e.initialize();break;case t.XTaskState.Initialized:n||e.validate()&&(e.state=t.XTaskState.Validated);break;case t.XTaskState.Validated:n||e.internalExecute();break;case t.XTaskState.Executing:n||e.update();break;case t.XTaskState.SelfCompleted:0==e.childCount&&(e.result==t.XTaskResult.Success?e.complete():e.failure());break;case t.XTaskState.Completed:this.currentChildComplete++;var i=!1;e.result==t.XTaskResult.Success&&e.lifeMode==t.XTaskLifeMode.Limit&&(e.lifeCount--,e.lifeCount<=0&&(i=!0)),i?this.$forRemoves.push(e.hashCode):this.isMain&&this.$forResets.push(e.hashCode);break;case t.XTaskState.Failured:}e.mainLoop()},Object.defineProperty(i.prototype,"isSelfCompleteSucceed",{get:function(){return this.state==t.XTaskState.SelfCompleted&&this.result==t.XTaskResult.Success},enumerable:!0,configurable:!0}),i.prototype.CheckComplete=function(){this.isSelfCompleteSucceed&&this.childCount>0&&(this.mode==t.XTaskMode.Sequence||this.mode==t.XTaskMode.RacingSequence?this.children.last().value.state==t.XTaskState.Completed&&this.complete():this.currentChildComplete>=this.currentComplete&&this.complete())},i.prototype.checkResets=function(){for(;this.$forResets.length;){var t=this.$forResets.shift();if(this.children.containsKey(t))this.children.get(t).reset()}},i.prototype.checkRemoves=function(){for(;this.$forRemoves.length;){var t=this.$forRemoves.shift();this.removeTask(t)}},i=__decorate([t.impl(t.IXTask),__metadata("design:paramtypes",[Number,Number])],i)}(t.Locker);t.XTask=n,__reflect(n.prototype,"xgame.XTask",["xgame.IXTask","xgame.IXObject"])}(xgame||(xgame={})),function(t){var e=function(e){function n(){var n=e.call(this,t.XTaskMode.Parallel,0)||this;return n.isLocked=!1,n.$idWithLocked=0,n.name="MainTask",n.isMain=!0,n}return __extends(n,e),n.prototype.isLockTask=function(t){return t.onMainRunning&&t.parent==this&&this.isLocked&&this.$idWithLocked!=t.hashCode},n.prototype.lock=function(t){var e=this;this.simple(function(){e.isLocked=!0,e.$idWithLocked=t.hashCode},this)},n.prototype.unlock=function(t){var e=this;this.simple(function(){e.isLocked=!1,e.$idWithLocked=0},this)},n.prototype.initialize=function(){this.setTaskState(t.XTaskState.SelfCompleted)},n.prototype.validate=function(){return!0},n.prototype.reset=function(){},n.prototype.complete=function(){},n=__decorate([t.impl(t.IXTask),__metadata("design:paramtypes",[])],n)}(t.XTask);t.MainTask=e,__reflect(e.prototype,"xgame.MainTask")}(xgame||(xgame={})),function(t){t.IXTaskDelegate=Symbol.for("IXTaskDelegate")}(xgame||(xgame={}));