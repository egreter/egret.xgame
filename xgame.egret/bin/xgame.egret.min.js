window.egretx={};var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i};window.__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(a,s)}c((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,n,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,n&&(r=n[2&o[0]?"return":o[0]?"throw":"next"])&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[0,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},__decorate=this&&this.__decorate||function(e,t,i,n){var r,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,i,a):r(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){var t;xgame.XGame.prototype.useEgret=function(t){this.registerServiceProvider(new e.EgretProvider(t))},function(e){e[e.INVALID=0]="INVALID",e[e.H_HEAD=1]="H_HEAD",e[e.H_MID=2]="H_MID",e[e.H_TAIL=4]="H_TAIL",e[e.V_HEAD=8]="V_HEAD",e[e.V_MID=16]="V_MID",e[e.V_TAIL=32]="V_TAIL"}(t=e.SBState||(e.SBState={})),eui.Group.prototype.onResizeChanged=function(){var e=this.__callback_onResize__;return e||(e=new xgame.Signal0,this.__callback_onResize__=e),e};var i=eui.Group.prototype.setContentSize;eui.Group.prototype.setContentSize=function(e,t){i.call(this,e,t);this.__callback_onResize__&&this.__callback_onResize__.dispatch()},eui.Group.prototype.__onHScrollChanged__=function(){var e=this.scrollV,i=this.contentHeight-this.height;i>0?e<5?this.__callback_onHS__.dispatch(t.H_HEAD):e>=5&&e<=i-5?this.__callback_onHS__.dispatch(t.H_MID):e>i-5&&this.__callback_onHS__.dispatch(t.H_TAIL):this.__callback_onHS__.dispatch(t.INVALID)},eui.Group.prototype.onHS=function(){return this.__callback_onHS__||(this.__callback_onHS__=new xgame.Signal1,this.__h_1_wacther__=eui.Binding.bindHandler(this,["contentWidth"],this.__onHScrollChanged__,this),this.__h_2_wacther__=eui.Binding.bindHandler(this,["scrollH"],this.__onHScrollChanged__,this)),this.__callback_onHS__},eui.Group.prototype.__onVScrollChanged__=function(){var e=this.scrollV,i=this.contentHeight-this.height;i>0?e<5?this.__callback_onVS__.dispatch(t.V_HEAD):e>=5&&e<=i-5?this.__callback_onVS__.dispatch(t.V_MID):e>i-5&&this.__callback_onVS__.dispatch(t.V_TAIL):this.__callback_onVS__.dispatch(t.INVALID)},eui.Group.prototype.onVS=function(){return this.__callback_onVS__||(this.__callback_onVS__=new xgame.Signal1,this.__v_1_wacther__=eui.Binding.bindHandler(this,["contentHeight"],this.__onVScrollChanged__,this),this.__v_2_wacther__=eui.Binding.bindHandler(this,["scrollV"],this.__onVScrollChanged__,this)),this.__callback_onVS__};var n=eui.Group.prototype.$onRemoveFromStage;eui.Group.prototype.$onRemoveFromStage=function(){n.apply(this);this.__callback_onResize__&&this.__callback_onResize__.removeAll(),this.__callback_onHS__&&(this.__callback_onHS__.removeAll(),this.__h_1_wacther__.unwatch(),this.__h_2_wacther__.unwatch(),this.__callback_onHS__=void 0,this.__h_1_wacther__=void 0,this.__h_2_wacther__=void 0),this.__callback_onVS__&&(this.__callback_onVS__.removeAll(),this.__v_1_wacther__.unwatch(),this.__v_2_wacther__.unwatch(),this.__callback_onVS__=void 0,this.__v_1_wacther__=void 0,this.__v_2_wacther__=void 0)},eui.DataGroup.prototype.getScroller=function(){if(this.parent&&egret.is(this.parent,"eui.Scroller"))return this.parent},eui.DataGroup.prototype.setItemWidth=function(e){this.__itemWidth__=e},eui.DataGroup.prototype.setItemHeight=function(e){this.__itemHeight__=e},eui.DataGroup.prototype.scrollToIndex=function(e){var t=this.getScroller();if(t){var i=0,n=0,r=0;egret.is(this.layout,"eui.LinearLayoutBase")&&(n=this.layout.gap),this.__itemWidth__?((r=this.contentWidth-t.width)<0&&(r=0),i=this.__itemWidth__,i+=n,(i*=e)>r&&(i=r),this.scrollH=i):this.__itemHeight__&&((r=this.contentHeight-t.height)<0&&(r=0),i=this.__itemHeight__,i+=n,(i*=e)>r&&(i=r),this.scrollV=i)}},eui.DataGroup.prototype.replaceAll=function(e,t){var i=this,n=0;"number"==typeof t&&(n=t,i.onResizeChanged().addOnce(function(){i.scrollToIndex(n)},this));var r=i.__dataSource__;null==r||"boolean"==typeof t&&t?(r=new eui.ArrayCollection(e),i.__dataSource__=r,i.dataProvider=r):r.replaceAll(e)}}(egretx||(egretx={})),function(e){e.IUIManager=Symbol.for("IUIManager")}(egretx||(egretx={})),function(e){e.IUIManagerInternal=Symbol.for("IUIManagerInternal")}(egretx||(egretx={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.main=e,i.priority=100,i}return __extends(i,t),i.prototype.onInit=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,!0]})})},i.prototype.onStart=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.getService(e.IDragonBonesManagerInternal).initialize(),t.getService(e.IAnimationManagerInternal).initialize(),t.getService(e.ITimelineManagerInternal).initialize(),t.getService(e.IAudioManagerInternal).initialize(),t.getService(e.IResourceManagerInternal).initialize(),t.getService(e.IHttpManagerInternal).initialize(),t.getService(e.ISocketManagerInternal).initialize(),t.getService(e.IUIManagerInternal).initialize(),t.getService(e.ITouchManagerInternal).initialize(),[2,!0]})})},i.prototype.onServiceRegister=function(t){t.singleton(e.IDragonBonesManager,e.DragonBonesManager).withInstance(e.DragonBonesManager.Instance()).setAlias(e.IDragonBonesManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.DragonBonesManager))),t.singleton(e.IAnimationManager,e.AnimationManager).withInstance(e.AnimationManager.Instance()).setAlias(e.IAnimationManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.AnimationManager))),t.singleton(e.ITimelineManager,e.TimelineManager).withInstance(e.TimelineManager.Instance()).setAlias(e.ITimelineManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.TimelineManager))),t.singleton(e.IAudioManager,e.AudioManager).withInstance(e.AudioManager.Instance()).setAlias(e.IAudioManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.AudioManager))),t.singleton(e.IResourceManager,e.ResourceManager).withInstance(e.ResourceManager.Instance()).setAlias(e.IResourceManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.ResourceManager))),t.singleton(e.IHttpManager,e.HttpManager).withInstance(e.HttpManager.Instance()).setAlias(e.IHttpManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.HttpManager))),t.singleton(e.ISocketManager,e.SocketManager).withInstance(e.SocketManager.Instance()).setAlias(e.ISocketManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.SocketManager))),t.singleton(e.IUIManager,e.UIManager).withInstance(new e.UIManager(this.main)).setAlias(e.IUIManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.UIManager))),t.singleton(e.ITouchManager,e.TouchManager).withInstance(new e.TouchManager(this.main)).setAlias(e.ITouchManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.TouchManager)))},i}(xgame.XObject);e.EgretProvider=t,__reflect(t.prototype,"egretx.EgretProvider",["xgame.IServiceProvider"])}(egretx||(egretx={})),function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.playingClips=new xgame.Dictionary,e.pools=new xgame.PoolGroup("AnimationClip"),e.factories=new xgame.Dictionary,e}return __extends(i,t),i.prototype.initialize=function(){},i.prototype.fetch=function(t,i){var n="{0}:{1}".format(t,i=i||t),r=this.pools.fetch(n,e.AnimationClip,function(){return new e.AnimationClip(t,i)},this);return this.playingClips.add(r.hashCode,r),r},i.prototype.recycle=function(t){this.playingClips.remove(t.hashCode);var i="{0}:{1}".format(t.key,t.movieClipname);this.pools.recycle(i,e.AnimationClip,t)},i.prototype.release=function(e){var t=this;this.pools.pools.forKeys(function(i){i.split(":")[0]==e&&t._release(i)},this,!0)},i.prototype._release=function(t){if(this.pools.getPool(t,e.AnimationClip).expired){this.pools.release(t,e.AnimationClip);var i=t.split(":")[0];this.factories.containsKey(i)&&(this.factories.remove(i),console.log("AnimationManager.clearMovieClipDataFactory({0})".format(i))),e.ResourceManager.Instance().getOrCreateGroup(e.ResourceType.MovieClip).release(i)}},i.prototype.releases=function(){var e=this;this.pools.pools.forKeys(function(t){e._release(t)},this,!0)},i.prototype.getRes=function(e){var t={};return t.json=e+"_json",t.texture=e+"_png",t},i.prototype.generateMovieClipData=function(e,t){t=t||e;var i=this.getRes(e);if(!RES.hasRes(i.json)||!RES.hasRes(i.texture))return console.warn("动画{0}的资源没有加载".format(e)),null;var n=this.factories.get(e);return n||(n=new egret.MovieClipDataFactory(RES.getRes(i.json),RES.getRes(i.texture)),this.factories.add(e,n)),t=t||e,n.generateMovieClipData(t)},i}(xgame.Singleton);e.AnimationManager=t,__reflect(t.prototype,"egretx.AnimationManager",["egretx.IAnimationManager","xgame.IXObject","egretx.IAnimationManagerInternal"])}(egretx||(egretx={})),function(e){var t=function(t){function i(i,n,r){void 0===r&&(r="mc");var o=t.call(this)||this;return o.frameActions=[],o.$timeline=e.Timeline.MAIN,o.fromPoolHashCode=0,o.$timeScale=1,o.$scale=1,o.$mc_scaleX=1,o.$mc_scaleY=1,o.callback_preload=new xgame.Signal0,o.$playTimes=0,n=n||i,o.name="{0}:{1}".format(i,n),o.key=i,o.movieClipname=n,o.actionName=r,o.touchChildren=!1,o.touchEnabled=!1,o}return __extends(i,t),Object.defineProperty(i.prototype,"mc",{get:function(){return this.$mc},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeline",{get:function(){return this.$timeline},enumerable:!0,configurable:!0}),i.prototype.setTimeline=function(e){this.$timeline=e},i.prototype.release=function(){this.dispose(),this.data=void 0,this.$mc=void 0,this.frameActions.length=0},i.prototype.dispose=function(){this.removeSelf()},Object.defineProperty(i.prototype,"frameRate",{get:function(){return this.$frameRate},set:function(e){this.$frameRate=e,this.mc&&(this.mc.frameRate=this.frameRate)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"timeScale",{get:function(){return this.$timeScale},set:function(e){this.$timeScale=e,this.$mc&&(this.$mc.timeScale=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this.$scale},set:function(e){this.$scale=e,this.mc_scaleX=e,this.mc_scaleY=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mc_scaleX",{get:function(){return this.$mc_scaleX},set:function(e){this.$mc_scaleX=e,this.$mc&&(this.$mc.scaleX=this.$mc_scaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mc_scaleY",{get:function(){return this.$mc_scaleY},set:function(e){this.$mc_scaleY=e,this.$mc&&(this.$mc.scaleY=this.$mc_scaleY)},enumerable:!0,configurable:!0}),i.prototype.addFrameAction=function(t,i,n){this.$mc?((isNaN(n)||0==n)&&(n=this.data.numFrames),this.$mc.addFrameAction(n,t,i)):this.frameActions.push(new e.FrameActionItem(t,i,n))},i.prototype.removeFrameActions=function(e){this.$mc&&((isNaN(e)||0==e)&&(e=this.data.numFrames),this.$mc.removeFrameActions(e))},i.prototype.preload=function(){var e=this;return this.$mc?this.callback_preload.dispatch():this.loadMC(!0).then(function(){e.callback_preload.dispatch()}),this.callback_preload},i.prototype.playWithAutoRemove=function(t){var i=this;this.addFrameAction(function(){e.AnimationManager.Instance().recycle(i)},this),this.play(1,t)},i.prototype.play=function(e,t){null!=t&&(this.actionName=t),isNaN(e)?this.$playTimes=0:this.$playTimes=e,this.mc?this._play():this.data?this.initMC(this.data):this.loadMC()},i.prototype.loadMC=function(t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return e.ResourceManager.Instance().getOrCreateGroup(e.ResourceType.MovieClip).load(this.key),i=e.AnimationManager.Instance().getRes(this.key),[4,e.ResourceManager.Instance().loadResAsync(i.json)];case 1:return n.sent(),[4,e.ResourceManager.Instance().loadResAsync(i.texture)];case 2:return n.sent(),this.data=e.AnimationManager.Instance().generateMovieClipData(this.key,this.movieClipname),this.initMC(this.data,t),[2]}})})},i.prototype.onFrameLabelEvent=function(e){this.dispatchEvent(e)},i.prototype.onLoopCompleteEvent=function(e){this.dispatchEvent(e)},i.prototype.onCompleteEvent=function(e){this.dispatchEvent(e)},i.prototype.initMC=function(t,i){var n=e.AnimationManager.Instance().getRes(this.key);if(RES.getRes(n.json)){for(var r=0,o=this.frameActions;r<o.length;r++){var a=o[r];-1==a.frame&&(a.frame=t.numFrames)}this.$mc=new e.MovieClip(t,this.frameActions),this.mc.timeScale=this.timeScale,this.mc.setTimeline(this.timeline),this.mc.scaleX=this.mc_scaleX,this.mc.scaleY=this.mc_scaleY,e.MovieClip.DISPATCH_ENABLE&&(this.mc.addEventListener(egret.MovieClipEvent.FRAME_LABEL,this.onFrameLabelEvent,this),this.mc.addEventListener(egret.MovieClipEvent.LOOP_COMPLETE,this.onLoopCompleteEvent,this),this.mc.addEventListener(egret.MovieClipEvent.COMPLETE,this.onCompleteEvent,this)),!isNaN(this.frameRate)&&this.frameRate>0&&(this.mc.frameRate=this.frameRate),this.frameActions.length=0,this.addChild(this.$mc),i||this._play()}},i.prototype._play=function(){this.mc&&(this.actionName?this.mc.gotoAndPlay(this.actionName,this.$playTimes):this.mc.play(this.$playTimes))},i.prototype.stop=function(){this.mc&&this.mc.stop()},i.prototype.reset=function(){this.mc&&this.mc.removeFrameActions()},i.prototype.removeSelf=function(){this.stop(),this.mc&&(this.mc.removeEventListener(egret.MovieClipEvent.FRAME_LABEL,this.onFrameLabelEvent,this),this.mc.removeEventListener(egret.MovieClipEvent.LOOP_COMPLETE,this.onLoopCompleteEvent,this),this.mc.removeEventListener(egret.MovieClipEvent.COMPLETE,this.onCompleteEvent,this)),this.parent&&this.parent.removeChild(this)},i}(eui.Component);e.AnimationClip=t,__reflect(t.prototype,"egretx.AnimationClip",["xgame.IPoolable","xgame.IDisposable","xgame.IXObject"])}(egretx||(egretx={})),function(e){var t=function(){function t(e){this.name="FrameAction",this.frame=e}return Object.defineProperty(t.prototype,"frame",{get:function(){return this.$frame},set:function(e){isNaN(e)?this.$frame=-1:this.$frame=e},enumerable:!0,configurable:!0}),t.prototype.hasAction=function(e,t){if(null==this.$items)return-1;for(var i=0;i<this.$items.length;i++){var n=this.$items[i];if(n.action==e&&n.thisObject==t)return i}return-1},t.prototype.addAction=function(t,i){null==this.$items&&(this.$items=[]),-1==this.hasAction(t,i)&&(this.$items[this.$items.length]=new e.FrameActionItem(t,i,this.frame))},t.prototype.removeAction=function(e,t){if(this.$items){var i=this.hasAction(e,t);i>=0&&this.$items.splice(i,1)}},t.prototype.removeActions=function(){this.$items&&(this.$items.length=0)},t.prototype.executeActions=function(e,t){if(this.$items)for(var i=this.$items.slice(),n=0,r=i.length;n<r;++n){var o=i[n],a=o.action,s=a.length;0==s?a.call(o.thisObject):1==s?a.call(o.thisObject,e):2==s&&a.call(o.thisObject,e,t)}},Object.defineProperty(t.prototype,"numActions",{get:function(){return this.$items?this.$items.length:0},enumerable:!0,configurable:!0}),t}();e.FrameAction=t,__reflect(t.prototype,"egretx.FrameAction")}(egretx||(egretx={})),function(e){var t=function(){return function(e,t,i){this.action=e,this.thisObject=t,isNaN(i)||0==i?this.frame=-1:this.frame=i}}();e.FrameActionItem=t,__reflect(t.prototype,"egretx.FrameActionItem")}(egretx||(egretx={})),function(e){var t=function(t){function i(i,n){var r=t.call(this)||this;return r.$actions=new xgame.Dictionary,r.$timeline=e.Timeline.MAIN,r.$texture=null,r.offsetPoint=new egret.Point(0,0),r.$movieClipData=null,r.frames=null,r.$totalFrames=0,r.frameLabels=null,r.$frameLabelStart=0,r.$frameLabelEnd=0,r.frameEvents=null,r.frameIntervalTime=0,r.$eventPool=null,r.$isPlaying=!1,r.isStopped=!0,r.playTimes=0,r.$currentFrameNum=0,r.$nextFrameNum=1,r.displayedKeyFrameNum=0,r.passedTime=0,r.$frameRate=NaN,r.$timeScale=1,r.lastTime=0,r.invokeActions=n,r.$smoothing=egret.Bitmap.defaultSmoothing,r.setMovieClipData(i),egret.nativeRender||(r.$renderNode=new egret.sys.NormalBitmapNode),r}return __extends(i,t),Object.defineProperty(i.prototype,"timeline",{get:function(){return this.$timeline},enumerable:!0,configurable:!0}),i.prototype.setTimeline=function(e){this.$timeline=e},i.prototype.setData=function(e,t){this.setInvokeActions(t),this.setMovieClipData(e,!0)},i.prototype.setInvokeActions=function(e){this.invokeActions=e},Object.defineProperty(i.prototype,"timeScale",{get:function(){return this.$timeScale},set:function(e){this.$timeScale=e},enumerable:!0,configurable:!0}),i.prototype.createNativeDisplayObject=function(){this.$nativeDisplayObject=new egret_native.NativeDisplayObject(11)},Object.defineProperty(i.prototype,"smoothing",{get:function(){return this.$smoothing},set:function(e){e!=this.$smoothing&&(this.$smoothing=e)},enumerable:!0,configurable:!0}),i.prototype.$init=function(){this.$reset();var e=this.$movieClipData;e&&e.$isDataValid()&&(this.frames=e.frames,this.$totalFrames=e.numFrames,this.frameLabels=e.labels,this.frameEvents=e.events,this.$frameRate=e.frameRate,this.frameIntervalTime=1e3/this.$frameRate,this.fillMovieFrames(),this._initFrame())},i.prototype.fillMovieFrames=function(){var t=this.movieClipData.frames.length;if(this.$actions.add(t,new e.FrameAction(t)),this.invokeActions&&this.invokeActions.length>0)for(var i=0,n=this.invokeActions;i<n.length;i++){var r=n[i];-1==r.frame&&(r.frame=this.movieClipData.numFrames);var o=this.getActionAt(r.frame);o&&o.addAction(r.action,r.thisObject)}},i.prototype.$reset=function(){this.frames=null,this.playTimes=0,this.$isPlaying=!1,this.setIsStopped(!0),this.$currentFrameNum=0,this.$nextFrameNum=1,this.displayedKeyFrameNum=0,this.passedTime=0,this.$eventPool=[],this.$actions.clear()},i.prototype._initFrame=function(){this.$movieClipData.$isTextureValid()&&(this.advanceFrame(),this.constructFrame())},i.prototype.$updateRenderNode=function(){var e=this.$texture;if(e){var t=Math.round(this.offsetPoint.x),i=Math.round(this.offsetPoint.y),n=e.$bitmapWidth,r=e.$bitmapHeight,o=e.$getTextureWidth(),a=e.$getTextureHeight(),s=Math.round(e.$getScaleBitmapWidth()),c=Math.round(e.$getScaleBitmapHeight()),h=e.$sourceWidth,l=e.$sourceHeight;egret.sys.BitmapNode.$updateTextureData(this.$renderNode,e.$bitmapData,e.$bitmapX,e.$bitmapY,n,r,t,i,o,a,s,c,h,l,egret.BitmapFillMode.SCALE,this.$smoothing)}},i.prototype.$measureContentBounds=function(e){var t=this.$texture;if(t){var i=this.offsetPoint.x,n=this.offsetPoint.y,r=t.$getTextureWidth(),o=t.$getTextureHeight();e.setTo(i,n,r,o)}else e.setEmpty()},i.prototype.$onAddToStage=function(e,i){t.prototype.$onAddToStage.call(this,e,i),this.$isPlaying&&this.$totalFrames>1&&this.setIsStopped(!1)},i.prototype.$onRemoveFromStage=function(){this.setIsStopped(!0),t.prototype.$onRemoveFromStage.call(this)},i.prototype.getFrameLabelByName=function(e,t){void 0===t&&(t=!1),t&&(e=e.toLowerCase());var i=this.frameLabels;if(i)for(var n=null,r=0;r<i.length;r++)if(n=i[r],t?n.name.toLowerCase()==e:n.name==e)return n;return null},i.prototype.getFrameStartEnd=function(e){var t=this.frameLabels;if(t)for(var i=null,n=0;n<t.length;n++)if(e==(i=t[n]).name){this.$frameLabelStart=i.frame,this.$frameLabelEnd=i.end;break}},i.prototype.getFrameLabelByFrame=function(e){var t=this.frameLabels;if(t)for(var i=null,n=0;n<t.length;n++)if((i=t[n]).frame==e)return i;return null},i.prototype.getFrameLabelForFrame=function(e){var t=null,i=null,n=this.frameLabels;if(n)for(var r=0;r<n.length;r++){if((i=n[r]).frame>e)return t;t=i}return t},i.prototype.play=function(e){void 0===e&&(e=0),this.lastTime=egret.getTimer(),this.passedTime=0,this.$isPlaying=!0,this.setPlayTimes(e),this.$totalFrames>1&&this.$stage&&this.setIsStopped(!1)},i.prototype.stop=function(){this.$isPlaying=!1,this.setIsStopped(!0)},i.prototype.prevFrame=function(){this.gotoAndStop(this.$currentFrameNum-1)},i.prototype.nextFrame=function(){this.gotoAndStop(this.$currentFrameNum+1)},i.prototype.gotoAndPlay=function(e,t){void 0===t&&(t=0),(0==arguments.length||arguments.length>2)&&egret.$error(1022,"MovieClip.gotoAndPlay()"),"string"==typeof e?this.getFrameStartEnd(e):(this.$frameLabelStart=0,this.$frameLabelEnd=0),this.play(t),this.gotoFrame(e)},i.prototype.gotoAndStop=function(e){1!=arguments.length&&egret.$error(1022,"MovieClip.gotoAndStop()"),this.stop(),this.gotoFrame(e)},i.prototype.gotoFrame=function(e){var t;if("string"==typeof e){var i=this.getFrameLabelByName(e);if(!i)return;t=i.frame}else(t=parseInt(e+"",10))!=e&&egret.$error(1022,"Frame Label Not Found");t<1?t=1:t>this.$totalFrames&&(t=this.$totalFrames),this.$nextFrameNum=t,this.advanceFrame(),this.constructFrame(),this.handlePendingEvent()},i.prototype.advanceTime=function(e){var t=e*this.timeScale,i=this.frameIntervalTime,n=this.passedTime+t;this.passedTime=n%i;var r=n/i;if(!(r<1)){for(;r>=1;){if(r--,this.$nextFrameNum++,this.$nextFrameNum>this.$totalFrames||this.$frameLabelStart>0&&this.$nextFrameNum>this.$frameLabelEnd)if(-1==this.playTimes)this.$eventPool.push(egret.Event.LOOP_COMPLETE),this.$nextFrameNum=1;else{if(this.playTimes--,!(this.playTimes>0)){this.$nextFrameNum=this.$totalFrames,this.$eventPool.push(egret.Event.COMPLETE),this.stop();break}this.$eventPool.push(egret.Event.LOOP_COMPLETE),this.$nextFrameNum=1}this.$currentFrameNum==this.$frameLabelEnd&&(this.$nextFrameNum=this.$frameLabelStart),this.advanceFrame()}this.constructFrame(),this.handlePendingEvent()}},i.prototype.advanceFrame=function(){this.$currentFrameNum=this.$nextFrameNum;var e=this.frameEvents[this.$nextFrameNum];e&&""!=e&&i.DISPATCH_ENABLE&&egret.MovieClipEvent.dispatchMovieClipEvent(this,egret.MovieClipEvent.FRAME_LABEL,e)},i.prototype.constructFrame=function(){var e=this.$currentFrameNum;if(this.displayedKeyFrameNum!=e){var t=this.$movieClipData.getTextureByFrame(e);if(this.$texture=t,this.$movieClipData.$getOffsetByFrame(e,this.offsetPoint),this.displayedKeyFrameNum=e,this.$renderDirty=!0,egret.nativeRender)this.$nativeDisplayObject.setDataToBitmapNode(this.$nativeDisplayObject.id,t,[t.$bitmapX,t.$bitmapY,t.$bitmapWidth,t.$bitmapHeight,this.offsetPoint.x,this.offsetPoint.y,t.$getScaleBitmapWidth(),t.$getScaleBitmapHeight(),t.$sourceWidth,t.$sourceHeight]),this.$nativeDisplayObject.setWidth(t.$getTextureWidth()+this.offsetPoint.x),this.$nativeDisplayObject.setHeight(t.$getTextureHeight()+this.offsetPoint.y);else{var i=this.$parent;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp());var n=this.$maskedObject;n&&!n.$cacheDirty&&(n.$cacheDirty=!0,n.$cacheDirtyUp())}if(this.$actions.containsKey(this.currentFrame)){var r=this.$actions.get(this.currentFrame);r&&r.numActions>0&&r.executeActions(this,e)}}},i.prototype.$renderFrame=function(){this.$texture=this.$movieClipData.getTextureByFrame(this.$currentFrameNum),this.$renderDirty=!0;var e=this.$parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());var t=this.$maskedObject;t&&!t.$cacheDirty&&(t.$cacheDirty=!0,t.$cacheDirtyUp())},i.prototype.handlePendingEvent=function(){if(0!=this.$eventPool.length){this.$eventPool.reverse();for(var e=this.$eventPool,t=e.length,n=!1,r=!1,o=0;o<t;o++){var a=e.pop();a==egret.Event.LOOP_COMPLETE?r=!0:a==egret.Event.COMPLETE?n=!0:i.DISPATCH_ENABLE&&this.dispatchEventWith(a)}r&&i.DISPATCH_ENABLE&&this.dispatchEventWith(egret.Event.LOOP_COMPLETE),n&&i.DISPATCH_ENABLE&&this.dispatchEventWith(egret.Event.COMPLETE)}},Object.defineProperty(i.prototype,"totalFrames",{get:function(){return this.$totalFrames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentFrame",{get:function(){return this.$currentFrameNum},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentFrameLabel",{get:function(){var e=this.getFrameLabelByFrame(this.$currentFrameNum);return e&&e.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentLabel",{get:function(){var e=this.getFrameLabelForFrame(this.$currentFrameNum);return e?e.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameRate",{get:function(){return this.$frameRate},set:function(e){e!=this.$frameRate&&(this.$frameRate=e,this.frameIntervalTime=1e3/this.$frameRate)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this.$isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"movieClipData",{get:function(){return this.$movieClipData},set:function(e){this.setMovieClipData(e)},enumerable:!0,configurable:!0}),i.prototype.setMovieClipData=function(e,t){(this.$movieClipData!=e||t)&&(this.$movieClipData=e,this.$init())},i.prototype.setPlayTimes=function(e){(e<0||e>=1)&&(this.playTimes=e<0?-1:Math.floor(e))},i.prototype.setIsStopped=function(t){this.isStopped!=t&&(this.isStopped=t,t?e.TimelineManager.Instance().getOrCreateTimeline(this.timeline).remove(this):(this.playTimes=0==this.playTimes?1:this.playTimes,this.lastTime=egret.getTimer(),e.TimelineManager.Instance().getOrCreateTimeline(this.timeline).add(this)))},i.prototype.getActionAt=function(t){return t<1||t>this.totalFrames?null:(this.$actions.containsKey(t)||this.$actions.add(t,new e.FrameAction(t)),this.$actions.get(t))},i.prototype.addFrameAction=function(e,t,i){this.getActionAt(e).addAction(t,i)},i.prototype.removeFrameAction=function(e,t,i){this.getActionAt(e).removeAction(t,i)},i.prototype.removeFrameActions=function(e){isNaN(e)?this.$actions.forValues(function(e){e.removeActions()},this):this.getActionAt(e).removeActions()},i.DISPATCH_ENABLE=!1,i}(egret.DisplayObject);e.MovieClip=t,__reflect(t.prototype,"egretx.MovieClip",["egretx.IAnimatable","xgame.IXObject"])}(egretx||(egretx={})),function(e){e.IAnimationManager=Symbol.for("IAnimationManager")}(egretx||(egretx={})),function(e){e.IAnimationManagerInternal=Symbol.for("IAnimationManagerInternal")}(egretx||(egretx={})),function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.initialize=function(){this.background=new e.MusicAudioChannel,this.ui=new e.MusicAudioChannel,this.effect=new e.EffectAudioChannel},i}(xgame.Singleton);e.AudioManager=t,__reflect(t.prototype,"egretx.AudioManager",["egretx.IAudioManager","xgame.IXObject","egretx.IAudioManagerInternal"])}(egretx||(egretx={})),function(e){var t;!function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(t=e.AudioToggleState||(e.AudioToggleState={}));var i=function(e){function i(i){var n=e.call(this)||this;return n.channelType=i,n.callback_onPlayCompleted=new xgame.Signal1,n.$toggleState=t.ON,n.$volume=.5,n.playTimes=1,n}return __extends(i,e),i.prototype.onPlayCompleted=function(){return this.callback_onPlayCompleted},Object.defineProperty(i.prototype,"toggleState",{get:function(){return this.$toggleState},enumerable:!0,configurable:!0}),i.prototype.toggleOn=function(){this.toggleState!=t.ON&&(this.$toggleState=t.ON,this.resume())},i.prototype.toggleOff=function(){this.toggleState!=t.OFF&&(this.$toggleState=t.OFF,this.stop())},Object.defineProperty(i.prototype,"volume",{get:function(){return this.$volume},enumerable:!0,configurable:!0}),i.prototype.setVolume=function(e){this.$volume=e},i.prototype.play=function(e,t){void 0===t&&(t=1)},i.prototype.pause=function(){},i.prototype.resume=function(){},i.prototype.stop=function(){},i}(xgame.XObject);e.AudioChannel=i,__reflect(i.prototype,"egretx.AudioChannel")}(egretx||(egretx={})),function(e){var t=function(t){function i(){var n=t.call(this,e.AudioChannelType.EFFECT)||this;n.freeAudioes=[],n.playAudioes=[];for(var r=0;r<i.instanceMax;r++)e.AudioManager.Instance().createAudioInstance?n.freeAudioes.push(e.AudioManager.Instance().createAudioInstance("effect")):n.freeAudioes.push(new e.WebAudio("effect"));return n}return __extends(i,t),i.prototype.play=function(e,t){var i=this;if(this.freeAudioes.length){var n=this.freeAudioes.shift();this.playAudioes.push(n),n.play(e,0,t).then(function(){i.releaseAudio(n)})}else console.log("没有可用的播放器了，放弃播放音效:"+e)},i.prototype.pause=function(){for(var e=this.playAudioes.length-1;e>=0;e--){this.playAudioes[e].pause()}},i.prototype.resume=function(){for(var e=this.playAudioes.length-1;e>=0;e--){this.playAudioes[e].resume()}},i.prototype.stop=function(){for(;this.playAudioes.length;){var e=this.playAudioes.pop();e.stop(),this.freeAudioes.unshift(e)}},i.prototype.releaseAudio=function(e){var t=this.playAudioes.indexOf(e);t>=0&&this.playAudioes.splice(t,1),-1==this.freeAudioes.indexOf(e)&&this.freeAudioes.unshift(e)},i.instanceMax=3,i}(e.AudioChannel);e.EffectAudioChannel=t,__reflect(t.prototype,"egretx.EffectAudioChannel")}(egretx||(egretx={})),function(e){var t=function(t){function i(){var i=t.call(this,e.AudioChannelType.BACKGORUND)||this;return e.AudioManager.Instance().createAudioInstance?i.main=e.AudioManager.Instance().createAudioInstance("music"):i.main=new e.WebAudio("music"),i}return __extends(i,t),i.prototype.play=function(e,t){this.key=e,this.playTimes=t,this.main.play(e,0,t)},i.prototype.pause=function(){this.main.pause()},i.prototype.resume=function(){this.main.resume()},i.prototype.stop=function(){this.main.stop()},i}(e.AudioChannel);e.MusicAudioChannel=t,__reflect(t.prototype,"egretx.MusicAudioChannel")}(egretx||(egretx={})),function(e){var t=function(e){function t(t){void 0===t&&(t="EFFECT");var i=e.call(this)||this;return i.type=t,i.$volume=.5,i}return __extends(t,e),Object.defineProperty(t.prototype,"info",{get:function(){return this.key&&RES.getResourceInfo(this.key)},enumerable:!0,configurable:!0}),t.prototype.load=function(){return null},t.prototype.play=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=0),null},t.prototype.pause=function(){},t.prototype.resume=function(){},t.prototype.stop=function(){},Object.defineProperty(t.prototype,"volume",{get:function(){return this.$volume},enumerable:!0,configurable:!0}),t.prototype.setVolume=function(e){this.$volume=e},t.prototype.destroy=function(){},t}(xgame.XObject);e.Audio=t,__reflect(t.prototype,"egretx.Audio")}(egretx||(egretx={})),function(e){!function(e){e[e.BACKGORUND=0]="BACKGORUND",e[e.EFFECT=1]="EFFECT"}(e.AudioChannelType||(e.AudioChannelType={}))}(egretx||(egretx={})),function(e){var t=function(t){function i(e){var i=t.call(this,e)||this;return i.position=0,i.$isPaused=!1,i}return __extends(i,t),i.prototype.load=function(){this.sound=new egret.Sound,this.sound.type=this.type,this.sound.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),this.sound.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOError,this),this.loadDeferred=new xgame.Deferred;var t=this.info.root+this.info.url;return e.AudioManager.Instance().redirectURL&&(t=e.AudioManager.Instance().redirectURL(t)),this.sound.load(t),this.loadDeferred.promise},i.prototype.onIOError=function(e){console.warn("WebAudio=>onIOError",e),this.sound.removeEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),this.sound.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOError,this),this.loadDeferred.resolve(!1)},i.prototype.onLoadComplete=function(e){this.sound.removeEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),this.sound.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOError,this),this.loadDeferred.resolve(!0)},i.prototype.play=function(e,t,i){var n=this;return void 0===t&&(t=0),void 0===i&&(i=0),this.stop(),this.key=e,this.playTimes=i,this.playDeferred=new xgame.Deferred,this.load().then(function(e){e?n._play(t):n.playDeferred.resolve()}),this.playDeferred.promise},i.prototype._play=function(e){this.$isPaused=!1,this.soundChannel=this.sound.play(e,this.playTimes),this.soundChannel.volume=this.volume,this.soundChannel.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this)},i.prototype.onSoundComplete=function(){this.playTimes>0&&(this.playTimes--,this.playTimes<=0&&(this.playDeferred&&this.playDeferred.resolve(),this.stop()))},Object.defineProperty(i.prototype,"isPaused",{get:function(){return this.$isPaused},enumerable:!0,configurable:!0}),i.prototype.pause=function(){!this.isPaused&&this.soundChannel&&(this.$isPaused=!0,this.position=this.soundChannel.position,this.clearChannel())},i.prototype.resume=function(){this.isPaused&&(this.$isPaused=!1,this._play(this.position))},i.prototype.clearChannel=function(){this.soundChannel&&(this.soundChannel.stop(),this.soundChannel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this),this.soundChannel=null)},i.prototype.stop=function(){if(this.playDeferred=void 0,this.$isPaused=!1,this.position=0,this.clearChannel(),this.sound){this.sound.removeEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),this.sound.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOError,this);try{this.sound.close()}catch(e){}}},i}(e.Audio);e.WebAudio=t,__reflect(t.prototype,"egretx.WebAudio")}(egretx||(egretx={})),function(e){e.IAudioManager=Symbol.for("IAudioManager")}(egretx||(egretx={})),function(e){e.IAudioManagerInternal=Symbol.for("IAudioManagerInternal")}(egretx||(egretx={})),function(e){e.event=xgame.event}(egretx||(egretx={})),function(e){e.impl=xgame.impl}(egretx||(egretx={})),function(e){e.inject=xgame.inject}(egretx||(egretx={})),function(e){e.injectable=xgame.injectable}(egretx||(egretx={})),function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.pools=new xgame.PoolGroup("Armature"),e}return __extends(i,t),i.prototype.advanceTime=function(e){this.factory&&this.factory.clock.advanceTime(e/1e3)},i.prototype.initialize=function(){e.TimelineManager.Instance().getOrCreateTimeline().add(this)},i.prototype.fetch=function(t,i,n){var r="{0}:{1}".format(t,i);return n&&(r="{0}:{1}".format(t,n)),this.pools.fetch(r,e.Armature,function(){return new e.Armature(t,i,n)},this)},i.prototype.recycle=function(t){this.pools.recycle(t.id,e.Armature,t)},i.prototype.release=function(e){var t=this;this.pools.pools.forKeys(function(i){i.split(":")[0]==e&&t._release(i)},this,!0)},i.prototype._release=function(t){if(this.pools.getPool(t,e.Armature).expired){this.pools.release(t,e.Armature);var i=t.split(":"),n=i[0],r=i[2]||n;this.clearDragonBones(n,r),e.ResourceManager.Instance().getOrCreateGroup(e.ResourceType.DragonBones).release(n)}},i.prototype.releases=function(){var e=this;this.pools.pools.forKeys(function(t){e._release(t)},this,!0)},i.prototype.addClock=function(e){e.armature&&this.factory.clock.add(e.armature)},i.prototype.removeClock=function(e){e.armature&&this.factory.clock.remove(e.armature)},i.prototype.parseDragonBones=function(e,t){t=t||e,this.factory||(this.factory=new dragonBones.EgretFactory);var i=this.getRes(e,t);this.factory.getDragonBonesData(e)||this.factory.parseDragonBonesData(RES.getRes(i.skeleton),e),this.factory.getTextureAtlasData(t)||this.factory.parseTextureAtlasData(RES.getRes(i.json),RES.getRes(i.texture),t)},i.prototype.clearDragonBones=function(e,t){t=t||e;this.getRes(e,t);this.factory.getDragonBonesData(e)&&(this.factory.removeDragonBonesData(e),console.log("DragonBonesManager.removeDragonBonesData({0})".format(e))),this.factory.getTextureAtlasData(t)&&(this.factory.removeTextureAtlasData(t),console.log("DragonBonesManager.removeTextureAtlasData({0})".format(t)))},i.prototype.buildArmature=function(e,t){return this.factory.buildArmature(t,e)},i.prototype.getRes=function(e,t){var i={};return i.skeleton="{0}_ske_json".format(e),t?(i.json="{0}_tex_json".format(t),i.texture="{0}_tex_png".format(t)):(i.json="{0}_tex_json".format(e),i.texture="{0}_tex_png".format(e)),i},i}(xgame.Singleton);e.DragonBonesManager=t,__reflect(t.prototype,"egretx.DragonBonesManager",["egretx.IDragonBonesManager","xgame.IXObject","egretx.IDragonBonesManagerInternal","egretx.IAnimatable"])}(egretx||(egretx={})),function(e){var t=function(t){function i(e,i,n){var r=t.call(this)||this;return r.key=e,r.armatureName=i,r.texture=n,r}return __extends(i,t),Object.defineProperty(i.prototype,"id",{get:function(){var e=this.key+":"+this.armatureName;return this.texture&&(e=this.key+":"+this.texture),e},enumerable:!0,configurable:!0}),i.prototype.setParent=function(e){this.armature&&this.armature.display&&e.addChild(this.armature.display)},i.prototype.removeSelf=function(){this.armature.display&&this.armature.display.parent&&this.armature.display.parent.removeChild(this.armature.display)},i.prototype.release=function(){this.dispose(),this.armature&&this.armature.dispose(),this.$armature=void 0},i.prototype.dispose=function(){this.armature&&(this.armature.animation.stop(),e.DragonBonesManager.Instance().removeClock(this)),this.removeSelf()},Object.defineProperty(i.prototype,"armature",{get:function(){return this.$armature},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this.armature&&this.armature.display},enumerable:!0,configurable:!0}),i.prototype.createArmature=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.armature?[3,2]:[4,e.ResourceManager.Instance().getOrCreateGroup(e.ResourceType.DragonBones).load(this.key,this.texture)];case 1:t.sent(),e.DragonBonesManager.Instance().parseDragonBones(this.key,this.texture),this.$armature=e.DragonBonesManager.Instance().buildArmature(this.key,this.armatureName),t.label=2;case 2:return this.armature&&e.DragonBonesManager.Instance().addClock(this),[2]}})})},i}(xgame.XObject);e.Armature=t,__reflect(t.prototype,"egretx.Armature",["xgame.IPoolable","xgame.IDisposable","xgame.IXObject"])}(egretx||(egretx={})),function(e){e.IDragonBonesManager=Symbol.for("IDragonBonesManager")}(egretx||(egretx={})),function(e){e.IDragonBonesManagerInternal=Symbol.for("IDragonBonesManagerInternal")}(egretx||(egretx={})),function(e){e.IHttpManager=Symbol.for("IHttpManager"),e.IHttpManagerInternal=Symbol.for("IHttpManagerInternal")}(egretx||(egretx={})),function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.pools=new xgame.PoolObject(e.HttpRequest),i}return __extends(i,t),i.prototype.initialize=function(){},i.prototype.sendRequest=function(t,i,n,r){return __awaiter(this,void 0,void 0,function(){var o,a,s,c;return __generator(this,function(h){switch(h.label){case 0:if(o="string"==typeof t?{uri:t,method:i,values:n,isJSON:r}:t,a=this.pools.fetch(function(){return new e.HttpRequest(o.uri,o.method)},this),o.headers)for(s=0;s<o.headers.length;s++)a.setHeader(o.headers[s][0],o.headers[s][1]);if(o.values)for(s=0;s<o.values.length;s++)a.setValue(o.values[s][0],o.values[s][1]);return[4,a.send(o.isJSON)];case 1:return c=h.sent(),this.pools.recycle(a),[2,c]}})})},i=__decorate([e.impl(e.IHttpManager),__metadata("design:paramtypes",[])],i)}(xgame.Singleton);e.HttpManager=t,__reflect(t.prototype,"egretx.HttpManager",["egretx.IHttpManager","xgame.IXObject","egretx.IHttpManagerInternal"])}(egretx||(egretx={})),function(e){e.ISocketManager=Symbol.for("ISocketManager"),e.ISocketManagerInternal=Symbol.for("ISocketManagerInternal")}(egretx||(egretx={})),function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.defaultInstanceName="main",e.retryMaxTiems=3,e.retryDelayTime=5e3,e.sendTimeout=1e4,e.heartBeatCheckTimeout=1e4,e.instances=new xgame.Dictionary,e}return __extends(i,t),i.prototype.initialize=function(){},i.prototype.getOrCreateInstance=function(t,i){if(t=t||this.defaultInstanceName,!this.instances.containsKey(t)){var n=new e.SocketInstance(this,t,i||this.defaultSocketHelper);this.instances.push(t,n)}return this.instances.get(t)},i=__decorate([e.impl(e.ISocketManager),__metadata("design:paramtypes",[])],i)}(xgame.Singleton);e.SocketManager=t,__reflect(t.prototype,"egretx.SocketManager",["egretx.ISocketManager","xgame.IXObject","egretx.ISocketManagerInternal"])}(egretx||(egretx={})),function(e){var t=function(e){function t(t,i){var n=e.call(this)||this;return n.uri=t,n.method=i,n.reconnectTimes=5,n.headers=new xgame.Dictionary,n.values=new xgame.Dictionary,n}return __extends(t,e),t.prototype.release=function(){},t.prototype.dispose=function(){this.headers.clear(),this.values.clear(),this.uri=void 0,this.method=void 0},t.prototype.setUri=function(e){this.uri=e},t.prototype.setMethod=function(e){void 0===e&&(e=egret.HttpMethod.GET),this.method=e},t.prototype.setHeader=function(e,t){this.headers.set(e,t)},t.prototype.setValue=function(e,t){this.values.set(e,t)},t.prototype.send=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(n){switch(n.label){case 0:i=this.reconnectTimes,n.label=1;case 1:return i?[4,this.request()]:[3,6];case 2:return"boolean"!=typeof(t=n.sent())?[3,4]:(i--,[4,xgame.waitMilliseconds(500)]);case 3:return n.sent(),[3,5];case 4:return[3,6];case 5:return[3,1];case 6:if("boolean"==typeof t)return[2,void 0];if(!e)return[2,t];try{return[2,JSON.parse(t)]}catch(e){}return[2,void 0]}})})},t.prototype.request=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return this.method=this.method||egret.HttpMethod.GET,[2,new Promise(function(t,i){var n=new egret.HttpRequest;if(n.open(e.uri,e.method),e.method==egret.HttpMethod.GET||0==e.values.length)n.send();else{n.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var r="";e.headers.forKeys(function(t){n.setRequestHeader(t,e.headers.get(t))},e),e.values.forKeys(function(t){r+=t+"="+e.values.get(t)+"&"},e),n.send(r)}n.addEventListener(egret.Event.COMPLETE,function(){t(n.response)},e),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){t(!1)},e)})]})})},t}(xgame.XObject);e.HttpRequest=t,__reflect(t.prototype,"egretx.HttpRequest",["xgame.IPoolable","xgame.IDisposable","xgame.IXObject"])}(egretx||(egretx={})),function(e){var t,i;!function(e){e[e.Closed=0]="Closed",e[e.Connecting=1]="Connecting",e[e.Connected=2]="Connected"}(t=e.SocketState||(e.SocketState={})),function(e){e[e.Close=0]="Close",e[e.IOError=1]="IOError",e[e.Failed=2]="Failed"}(i=e.SocketCloseCode||(e.SocketCloseCode={}));var n=function(e){function n(t,i,n){var r=e.call(this)||this;return r.manager=t,r.name=i,r.socketHelper=n,r.guidCount=0,r.isInited=!1,r.happendConnected=!1,r.isReconnect=!1,r.disposableGroup=new xgame.DisposableGroup,r.recvQueues=[],r.sendTimeoutStamp=0,r.lastestRecvStamp=0,r.checkHeartBeat=!1,r.sendQueues=[],r.callback_onConnected=new xgame.Signal0,r.callback_onKickOut=new xgame.Signal0,r.callback_onClosed=new xgame.Signal1,r.reconnectTimerID=0,r.callback_onConnecting=new xgame.Signal1,r.retryCount=0,r.callback_onShutdown=new xgame.Signal0,r}return __extends(n,e),n.prototype.generateGUID=function(){return++this.guidCount},Object.defineProperty(n.prototype,"state",{get:function(){return this.$state},enumerable:!0,configurable:!0}),n.prototype.onAdvanceTime=function(){for(;this.recvQueues.length;){var e=this.recvQueues.shift();e.guid&&this.current&&this.current.guid==e.guid&&(this.socketHelper.needSendLoginPacket()&&this.socketHelper.isLoginRespPacket(e)&&this.socketHelper.isLoginSuccess(e)&&(this.isReconnect=!0),this.current=null,this.sendQueues.shift()),this.socketHelper.receivePacket(e)}this.state==t.Connected&&(!this.current&&this.sendQueues.length&&(this.current=this.sendQueues[0],this._sendPacket(this.current),this.sendTimeoutStamp=xgame.Time.Instance().passedTime+this.manager.sendTimeout),this.current&&this.sendTimeoutStamp<xgame.Time.Instance().passedTime&&(this._close(),this.connect()),this.socketHelper.enableHeartBeatCheck()&&!this.checkHeartBeat&&xgame.Time.Instance().getTimeStamp()-this.lastestRecvStamp>this.manager.heartBeatCheckTimeout&&(this.checkHeartBeat=!0,this.socketHelper.sendHeartBeatPacket()))},n.prototype._sendPacket=function(e){this.socketHelper.showAnimation();var t=this.socketHelper.encodePacket(e);t&&t.length&&this.socket.writeBytes(t)},n.prototype.sendPacket=function(e){if(e.guid=this.generateGUID(),e.first){for(var t=this.sendQueues.length-1;t>=0;t++)this.socketHelper.isLoginRespPacket(this.sendQueues[t])&&this.sendQueues.splice(t,1);this.sendQueues.unshift(e)}else this.sendQueues.push(e)},n.prototype.setURI=function(e,t,i){this.uri=t?i?"wss://":"ws://"+e+":"+t:e},n.prototype.init=function(){this.isInited||(this.isInited=!0,this.guidCount=Math.floor(xgame.Time.Instance().getTimeStamp()/1e3),this.cleanQueues(),this.disposableGroup.registerUpdate(this.onAdvanceTime,this),this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_BINARY,this.socket.addEventListener(egret.Event.CONNECT,this.onConnectHandler,this),this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveHandler,this),this.socket.addEventListener(egret.Event.CLOSE,this.onCloseHandler,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOErrorHandler,this),this.$state=t.Closed)},n.prototype.onConnected=function(){return this.callback_onConnected},n.prototype.onConnectHandler=function(e){this.$state=t.Connected,this.socketHelper.hideAnimation(),this.callback_onConnected.dispatch(),this.happendConnected=!0,this.socketHelper.needSendLoginPacket()&&this.sendLoginPacket()},n.prototype.sendLoginPacket=function(){var e=this.socketHelper.generateLoginPacket(this.isReconnect);e&&(e.first=!0,this.sendPacket(e))},n.prototype.onKickOut=function(){return this.callback_onKickOut},n.prototype.onReceiveHandler=function(e){var t=this;this.socketHelper.hideAnimation(),this.lastestRecvStamp=xgame.Time.Instance().getTimeStamp();var i=new egret.ByteArray;this.socket.readBytes(i);var n=this.socketHelper.decodePackets(i);if(n&&n.length){var r=n[0];if(this.socketHelper.isDataLocked(r)?egret.setTimeout(function(){t.current=null},this,100):this.socketHelper.isKickOutPacket(r)?this.callback_onKickOut.dispatch():(this.recvQueues.push(r),this.socketHelper.isHeartBeatPacket(r)&&(this.checkHeartBeat=!1)),n.length>1)for(var o=1;o<n.length;o++)this.recvQueues.push(n[o])}},n.prototype.onClosed=function(){return this.callback_onClosed},n.prototype.onCloseHandler=function(e){var n=this;this.callback_onClosed.dispatch(i.Close),this.state==t.Connecting?this.reconnectTimerID=egret.setTimeout(function(){n._connect()},this,this.manager.retryDelayTime):this.state==t.Connected&&(this.$state=t.Closed,this.connect())},n.prototype.onIOErrorHandler=function(e){this.socketHelper.hideAnimation(),this.cleanQueues(!0),this.$state=t.Closed,this.callback_onClosed.dispatch(i.IOError)},n.prototype.onConnecting=function(){return this.callback_onConnecting},n.prototype.connect=function(){if(!this.socketHelper)throw new Error("没有实现网络助手ISocketHelper");this.isInited||this.init(),this.state==t.Closed&&(this.socketHelper.showAnimation(),this.retryCount=0,this.$state=t.Connecting,this._connect())},n.prototype._connect=function(){this.state==t.Connecting&&(this.retryCount<this.manager.retryMaxTiems?(this.happendConnected&&this.callback_onConnecting.dispatch(this.retryCount+1),this.socket.connectByUrl(this.uri),this.retryCount++):(this.cleanQueues(),this.$state=t.Closed,this.socketHelper.hideAnimation(),this.callback_onClosed.dispatch(i.Failed)))},n.prototype.cleanQueues=function(e){for(;this.sendQueues.length>0;){this.sendQueues.pop().abort()}e&&(this.recvQueues.length=0)},n.prototype.close=function(){this.state!=t.Closed&&this._close()},n.prototype._close=function(){this.state!=t.Closed&&(this.$state=t.Closed,this.socket&&this.socket.close()),this.reconnectTimerID&&(egret.clearTimeout(this.reconnectTimerID),this.reconnectTimerID=0)},n.prototype.onShutdown=function(){return this.callback_onShutdown},n.prototype.shutdown=function(){this.guidCount=Math.floor(xgame.Time.Instance().getTimeStamp()/1e3),this.socket&&(this.socket.removeEventListener(egret.Event.CONNECT,this.onConnectHandler,this),this.socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveHandler,this),this.socket.removeEventListener(egret.Event.CLOSE,this.onCloseHandler,this),this.socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOErrorHandler,this)),this.close(),this.cleanQueues(!0),this.isInited=!1,this.happendConnected=!1,this.isReconnect=!1,this.socket=null,this.$state=t.Closed,this.callback_onShutdown.dispatch()},n}(xgame.XObject);e.SocketInstance=n,__reflect(n.prototype,"egretx.SocketInstance")}(egretx||(egretx={})),function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.groups=new xgame.Dictionary,e.loadQueues=new xgame.Dictionary,e}return __extends(i,t),i.prototype.initialize=function(){this.groups.add(e.ResourceType.MovieClip,new e.MovieClipResourceGroup(this)),this.groups.add(e.ResourceType.DragonBones,new e.DragonBonesResourceGroup(this))},i.prototype.getOrCreateGroup=function(e,t){var i=this.groups.get(e);return!i&&t&&(i=t(),this.groups.add(e,i)),i},i.prototype.loadResAsync=function(e){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(n){if(!RES.hasRes(e))throw new Error("资源配置:{0}找不到".format(e));return RES.getRes(e)?[2,RES.getRes(e)]:(this.loadQueues.containsKey(e)?t=this.loadQueues.get(e):(t={key:e,deferred:new xgame.Deferred},this.loadQueues.add(e,t),RES.getResAsync(e).then(function(){(t=i.loadQueues.remove(e)).deferred.resolve(RES.getRes(e))})),[2,t.deferred.promise])})})},i.prototype.destroyRes=function(e){return!!RES.getRes(e)&&(i.DEBUG&&console.log("ResourceManager.destroyRes({0})".format(e)),RES.destroyRes(e,!0))},i.DEBUG=!0,i}(xgame.Singleton);e.ResourceManager=t,__reflect(t.prototype,"egretx.ResourceManager",["egretx.IResourceManager","xgame.IXObject","egretx.IResourceManagerInternal"])}(egretx||(egretx={})),function(e){var t=function(t){function i(e,i){var n=t.call(this)||this;return n.manager=e,n.resourceType=i,n.keys=new xgame.Dictionary,n.statistics={},n.$memory=0,n}return __extends(i,t),i.prototype.createInstance=function(e){return null},i.prototype.load=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},i.prototype.release=function(t){if(this.keys.containsKey(t))for(var i=0,n=this.keys.get(t);i<n.length;i++){var r=n[i];e.ResourceManager.Instance().destroyRes(r)}},Object.defineProperty(i.prototype,"memory",{get:function(){return this.$memory},enumerable:!0,configurable:!0}),i.prototype.addMemory=function(e,t,i){if(null==this.statistics[e]){var n=t*i*4;this.statistics[e]=n,this.$memory+=n}},i.prototype.removeMemory=function(e){if(null!=this.statistics[e]){var t=this.statistics[e];this.$memory-=t,delete this.statistics[e]}},i}(xgame.XObject);e.ResourceGroup=t,__reflect(t.prototype,"egretx.ResourceGroup")}(egretx||(egretx={})),function(e){var t=function(t){function i(i){return t.call(this,i,e.ResourceType.DragonBones)||this}return __extends(i,t),i.prototype.load=function(t,i){return __awaiter(this,void 0,void 0,function(){var n,r,o;return __generator(this,function(a){switch(a.label){case 0:return n=e.DragonBonesManager.Instance().getRes(t,i),RES.hasRes(n.json)&&RES.hasRes(n.texture)&&RES.hasRes(n.skeleton)?[4,e.ResourceManager.Instance().loadResAsync(n.skeleton)]:[2];case 1:return a.sent(),[4,e.ResourceManager.Instance().loadResAsync(n.json)];case 2:return a.sent(),[4,e.ResourceManager.Instance().loadResAsync(n.texture)];case 3:return(r=a.sent())&&this.addMemory(t,r.$bitmapWidth,r.$bitmapHeight),this.keys.containsKey(t)?(-1==(o=this.keys.get(t)).indexOf(n.json)&&o.push(n.json),-1==o.indexOf(n.texture)&&o.push(n.texture),-1==o.indexOf(n.skeleton)&&o.push(n.skeleton)):(o=[n.json,n.texture,n.skeleton],this.keys.add(t,o)),[2]}})})},i}(e.ResourceGroup);e.DragonBonesResourceGroup=t,__reflect(t.prototype,"egretx.DragonBonesResourceGroup")}(egretx||(egretx={})),function(e){var t=function(t){function i(i){return t.call(this,i,e.ResourceType.MovieClip)||this}return __extends(i,t),i.prototype.load=function(t){return __awaiter(this,void 0,void 0,function(){var i,n,r;return __generator(this,function(o){switch(o.label){case 0:return i=e.AnimationManager.Instance().getRes(t),RES.hasRes(i.json)&&RES.hasRes(i.texture)?[4,e.ResourceManager.Instance().loadResAsync(i.json)]:[2];case 1:return o.sent(),[4,e.ResourceManager.Instance().loadResAsync(i.texture)];case 2:return(n=o.sent())&&this.addMemory(t,n.$bitmapWidth,n.$bitmapHeight),this.keys.containsKey(t)?(-1==(r=this.keys.get(t)).indexOf(i.json)&&r.push(i.json),-1==r.indexOf(i.texture)&&r.push(i.texture)):(r=[i.json,i.texture],this.keys.add(t,r)),[2]}})})},i}(e.ResourceGroup);e.MovieClipResourceGroup=t,__reflect(t.prototype,"egretx.MovieClipResourceGroup")}(egretx||(egretx={})),function(e){!function(e){e.UI="UI",e.MovieClip="MovieClip",e.DragonBones="DragonBones"}(e.ResourceType||(e.ResourceType={}))}(egretx||(egretx={})),function(e){e.IResourceManager=Symbol.for("IResourceManager")}(egretx||(egretx={})),function(e){e.IResourceManagerInternal=Symbol.for("IResourceManagerInternal")}(egretx||(egretx={})),function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.timelines=new xgame.Dictionary,e}return __extends(i,t),i.prototype.initialize=function(){xgame.SchedulerManager.Instance().registerUpdate(this.advanceTime,this)},i.prototype.advanceTime=function(){var e=xgame.Time.Instance().deltaTime;this.timelines.forValues(function(t){t.advanceTime(e)},this)},i.prototype.getOrCreateTimeline=function(t){return void 0===t&&(t=e.Timeline.MAIN),this.timelines.containsKey(t)||this.timelines.add(t,new e.Timeline(t)),this.timelines.get(t)},i}(xgame.Singleton);e.TimelineManager=t,__reflect(t.prototype,"egretx.TimelineManager",["egretx.ITimelineManager","egretx.ITimelineManagerInternal"])}(egretx||(egretx={})),function(e){var t=function(e){function t(t){var i=e.call(this)||this;return i.name=t,i.animatables=new xgame.Dictionary,i.$timeScale=1,i.$passedTime=0,i.$isPaused=!1,i}return __extends(t,e),Object.defineProperty(t.prototype,"timeScale",{get:function(){return this.$timeScale},set:function(e){this.$timeScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"passedTime",{get:function(){return this.$passedTime},enumerable:!0,configurable:!0}),t.prototype.advanceTime=function(e){var t=this,i=this.timeScale*e;this.$passedTime+=i,this.isPaused||this.simple(function(){t.animatables.forValues(function(e){e.advanceTime(i)},t)},this)},t.prototype.add=function(e){var t=this;this.simple(function(){t.animatables.add(e.hashCode,e)},this)},t.prototype.remove=function(e){var t=this;this.simple(function(){t.animatables.remove(e.hashCode)},this)},Object.defineProperty(t.prototype,"isPaused",{get:function(){return this.$isPaused},enumerable:!0,configurable:!0}),t.prototype.pause=function(){this.isPaused||(this.$isPaused=!0)},t.prototype.resume=function(){this.isPaused&&(this.$isPaused=!1)},t.MAIN="MAIN",t}(xgame.Locker);e.Timeline=t,__reflect(t.prototype,"egretx.Timeline")}(egretx||(egretx={})),function(e){e.ITimelineManager=Symbol.for("ITimelineManager")}(egretx||(egretx={})),function(e){e.ITimelineManagerInternal=Symbol.for("ITimelineManagerInternal")}(egretx||(egretx={})),function(e){e.ITouchManager=Symbol.for("ITouchManager")}(egretx||(egretx={})),function(e){e.ITouchManagerInternal=Symbol.for("ITouchManagerInternal")}(egretx||(egretx={})),function(e){e.TOUCH_TAP_BETWEEN_TIME=300,e.TOUCH_LONG_PRESS_TIME=300,e.TOUCH_SCALE_RADIO=.96,e.touchClickLastTime=0;var t=function(t){function i(e){var i=t.call(this)||this;return i.main=e,i.delegates=new xgame.Dictionary,i.stage=e.stage,i}return __extends(i,t),i.prototype.dispose=function(){this.delegates.clear(function(e){e.dispose()}),e.touchClickLastTime=0},i.prototype.initialize=function(){this.stage.addEventListener(egret.TouchEvent.LEAVE_STAGE,this.onLeaveStage,this)},i.prototype.onLeaveStage=function(e){this.delegates.forValues(function(t){t.onLeaveStage(e)},this)},i.prototype.removeTouchEvents=function(e){var t=0;(t="number"==typeof e?e:e.hashCode,this.delegates.containsKey(t))&&this.delegates.remove(t).dispose()},i.prototype.addTouchBegin=function(t,i,n,r){var o=t.hashCode;this.delegates.allocf(o,function(){return new e.TouchDelegate(t,r)}).addTouchBegin(i,n)},i.prototype.removeTouchBegin=function(t,i,n){var r=t.hashCode;this.delegates.containsKey(r)&&this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).removeTouchBegin(i,n)},i.prototype.addTouchMove=function(t,i,n){var r=t.hashCode;this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).addTouchMove(i,n)},i.prototype.removeTouchMove=function(t,i,n){var r=t.hashCode;this.delegates.containsKey(r)&&this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).removeTouchMove(i,n)},i.prototype.addTouchEnd=function(t,i,n){var r=t.hashCode;this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).addTouchEnd(i,n)},i.prototype.removeTouchEnd=function(t,i,n){var r=t.hashCode;this.delegates.containsKey(r)&&this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).removeTouchEnd(i,n)},i.prototype.addReleaseOutSide=function(t,i,n){var r=t.hashCode;this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).addReleaseOutSide(i,n)},i.prototype.removeReleaseOutSide=function(t,i,n){var r=t.hashCode;this.delegates.containsKey(r)&&this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).removeReleaseOutSide(i,n)},i.prototype.addClick=function(t,i,n,r){var o=t.hashCode;this.delegates.allocf(o,function(){return new e.TouchDelegate(t,r)}).addClick(i,n)},i.prototype.removeClick=function(t,i,n){var r=t.hashCode;this.delegates.containsKey(r)&&this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).removeClick(i,n)},i.prototype.addLongPress=function(t,i,n,r,o){var a=t.hashCode;this.delegates.allocf(a,function(){return new e.TouchDelegate(t,o)}).addLongPress(i,n,r)},i.prototype.removeLongPress=function(t,i,n){var r=t.hashCode;this.delegates.containsKey(r)&&this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).removeLongPress(i,n)},i.prototype.addRepeatPress=function(t,i,n,r,o){var a=t.hashCode;this.delegates.allocf(a,function(){return new e.TouchDelegate(t,o)}).addRepeatPress(i,n,r)},i.prototype.removeRepeatPress=function(t,i,n){var r=t.hashCode;this.delegates.containsKey(r)&&this.delegates.allocf(r,function(){return new e.TouchDelegate(t)}).removeRepeatPress(i,n)},i=__decorate([xgame.impl(xgame.IDisposable,e.ITouchManager,e.ITouchManagerInternal),__metadata("design:paramtypes",[egret.DisplayObjectContainer])],i)}(xgame.XObject);e.TouchManager=t,__reflect(t.prototype,"egretx.TouchManager",["xgame.IDisposable","xgame.IXObject","egretx.ITouchManager","egretx.ITouchManagerInternal"])}(egretx||(egretx={})),function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.top=NaN,t.bottom=NaN,t.left=NaN,t.right=NaN,t.horizontalCenter=NaN,t.verticalCenter=NaN,t.percentWidth=NaN,t.percentHeight=NaN,t.anchorOffsetX=NaN,t.anchorOffsetY=NaN,t.x=0,t.y=0,t.width=0,t.height=0,t.scaleX=1,t.scaleY=1,t}return __extends(t,e),t.prototype.reset=function(){this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.horizontalCenter=NaN,this.verticalCenter=NaN,this.percentWidth=NaN,this.percentHeight=NaN,this.anchorOffsetX=NaN,this.anchorOffsetY=NaN,this.x=0,this.y=0,this.width=0,this.height=0,this.scaleX=1,this.scaleY=1},t}(xgame.XObject);e.LayoutCache=t,__reflect(t.prototype,"egretx.LayoutCache")}(egretx||(egretx={})),function(e){var t=function(){function t(){}return t.prototype.setTouchManager=function(t){this.disposableGroup||(this.disposableGroup=new e.TouchDisposableGroup(t))},t.prototype.addTouchBegin=function(e,t,i,n){this.disposableGroup.addTouchBegin(e,t,i,n)},t.prototype.removeTouchBegin=function(e,t,i){this.disposableGroup.removeTouchBegin(e,t,i)},t.prototype.addTouchMove=function(e,t,i){this.disposableGroup.addTouchMove(e,t,i)},t.prototype.removeTouchMove=function(e,t,i){this.disposableGroup.removeTouchMove(e,t,i)},t.prototype.addTouchEnd=function(e,t,i){this.disposableGroup.addTouchEnd(e,t,i)},t.prototype.removeTouchEnd=function(e,t,i){this.disposableGroup.removeTouchEnd(e,t,i)},t.prototype.addReleaseOutSide=function(e,t,i){this.disposableGroup.addReleaseOutSide(e,t,i)},t.prototype.removeReleaseOutSide=function(e,t,i){this.disposableGroup.removeReleaseOutSide(e,t,i)},t.prototype.addClick=function(e,t,i,n){this.disposableGroup.addClick(e,t,i,n)},t.prototype.removeClick=function(e,t,i){this.disposableGroup.removeClick(e,t,i)},t.prototype.addLongPress=function(e,t,i,n,r){this.disposableGroup.addLongPress(e,t,i,n,r)},t.prototype.removeLongPress=function(e,t,i){this.disposableGroup.removeLongPress(e,t,i)},t.prototype.addRepeatPress=function(e,t,i,n,r){this.disposableGroup.addRepeatPress(e,t,i,n,r)},t.prototype.removeRepeatPress=function(e,t,i){this.disposableGroup.removeRepeatPress(e,t,i)},t}();e.TouchBehaviours=t,__reflect(t.prototype,"egretx.TouchBehaviours")}(egretx||(egretx={})),function(e){var t=function(t){function i(i,n){void 0===n&&(n=!1);var r=t.call(this)||this;return r.clickScaleEnable=!1,r.longPressTimeDelta=e.TOUCH_LONG_PRESS_TIME,r.repeatPressTimeDelta=e.TOUCH_LONG_PRESS_TIME,r.repeat_timer_id=0,r.target=i,r.clickScaleEnable=n,r.initTouchEvents(),r}return __extends(i,t),i.prototype.onLeaveStage=function(e){this.onTouchEnd(e)},i.prototype.addTouchBegin=function(e,t){this.beginHandler.listeners.add(e,t)},i.prototype.removeTouchBegin=function(e,t){this.beginHandler.listeners.remove(e)},i.prototype.addTouchMove=function(e,t){this.moveHandler.listeners.add(e,t)},i.prototype.removeTouchMove=function(e,t){this.moveHandler.listeners.remove(e)},i.prototype.addTouchEnd=function(e,t){this.endHandler.listeners.add(e,t)},i.prototype.removeTouchEnd=function(e,t){this.endHandler.listeners.remove(e)},i.prototype.addReleaseOutSide=function(e,t){this.releaseOutsideHandler.listeners.add(e,t)},i.prototype.removeReleaseOutSide=function(e,t){this.releaseOutsideHandler.listeners.remove(e)},i.prototype.addClick=function(e,t){this.clickHandler.listeners.add(e,t)},i.prototype.removeClick=function(e,t){this.clickHandler.listeners.remove(e)},i.prototype.addLongPress=function(e,t,i){void 0===i&&(i=300),this.longPressTimeDelta=i,this.longPressHandler.listeners.add(e,t)},i.prototype.removeLongPress=function(e,t){this.longPressHandler.listeners.remove(e)},i.prototype.addRepeatPress=function(e,t,i){void 0===i&&(i=300),this.repeatPressTimeDelta=i,this.repeatPressHandler.listeners.add(e,t)},i.prototype.removeRepeatPress=function(e,t){this.repeatPressHandler.listeners.remove(e)},i.prototype.initTouchEvents=function(){this.inited=!0,this.clickHandler={listeners:new xgame.Signal1,happend:!1},this.longPressHandler={listeners:new xgame.Signal1,happend:!1},this.repeatPressHandler={listeners:new xgame.Signal1,happend:!1},this.releaseOutsideHandler={listeners:new xgame.Signal1,happend:!1},this.beginHandler={listeners:new xgame.Signal1,happend:!1},this.moveHandler={listeners:new xgame.Signal1,happend:!1},this.endHandler={listeners:new xgame.Signal1,happend:!1},this.target.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.target.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.target.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.target.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},i.prototype.setRepeatTimer=function(){var e=this;this.clearRepeatTimer(),this.repeat_timer_id=egret.setInterval(function(){e.repeatPressHandler.happend=!0,e.repeatPressHandler.listeners.dispatch(null)},this,this.repeatPressTimeDelta)},i.prototype.clearRepeatTimer=function(){this.repeat_timer_id&&egret.clearInterval(this.repeat_timer_id),this.repeat_timer_id=0},i.prototype.onTouchBegin=function(e){this.clickScaleEnable&&(this.cacheLayout(),this.updateLayout()),this.beginHandler.happend=!0,this.beginHandler.time=egret.getTimer(),this.beginHandler.identifier=e.touchPointID,this.beginHandler.listeners.dispatch(e),this.repeatPressHandler.listeners.numListeners&&this.setRepeatTimer()},i.prototype.cacheLayout=function(){this.cache||(this.cache=new e.LayoutCache),this.cache.x=this.target.x,this.cache.y=this.target.y,this.cache.width=this.target.width,this.cache.height=this.target.height,this.cache.scaleX=this.target.scaleX,this.cache.scaleY=this.target.scaleY,this.cache.anchorOffsetX=this.target.anchorOffsetX,this.cache.anchorOffsetY=this.target.anchorOffsetY,this.target instanceof eui.Component&&(this.cache.top=this.target.top,this.cache.bottom=this.target.bottom,this.cache.left=this.target.left,this.cache.right=this.target.right,this.cache.horizontalCenter=this.target.horizontalCenter,this.cache.verticalCenter=this.target.verticalCenter,this.cache.percentWidth=this.target.percentWidth,this.cache.percentHeight=this.target.percentHeight)},i.prototype.updateLayout=function(t){this.cache&&(t?(this.target.x=this.cache.x,this.target.y=this.cache.y,this.target.width=this.cache.width,this.target.height=this.cache.height,this.target.scaleX=this.cache.scaleX,this.target.scaleY=this.cache.scaleY,this.target.anchorOffsetX=this.cache.anchorOffsetX,this.target.anchorOffsetY=this.cache.anchorOffsetY,this.target instanceof eui.Component&&(this.target.top=this.cache.top,this.target.bottom=this.cache.bottom,this.target.left=this.cache.left,this.target.right=this.cache.right,this.target.horizontalCenter=this.cache.horizontalCenter,this.target.verticalCenter=this.cache.verticalCenter,this.target.percentWidth=this.cache.percentWidth,this.target.percentHeight=this.cache.percentHeight)):(this.target.width=this.cache.width,this.target.height=this.cache.height,this.target.anchorOffsetX=this.cache.width/2,this.target.anchorOffsetY=this.cache.height/2,this.target.x+=this.cache.width*this.cache.scaleX/2,this.target.y+=this.cache.height*this.cache.scaleY/2,this.target.scaleX=this.cache.scaleX*e.TOUCH_SCALE_RADIO,this.target.scaleY=this.cache.scaleY*e.TOUCH_SCALE_RADIO,this.target instanceof eui.Component&&(this.target.top=NaN,this.target.bottom=NaN,this.target.left=NaN,this.target.right=NaN,this.target.horizontalCenter=NaN,this.target.verticalCenter=NaN,this.target.percentWidth=NaN,this.target.percentHeight=NaN)))},i.prototype.onTouchMove=function(e){this.beginHandler.happend&&this.moveHandler.listeners.dispatch(e)},i.prototype.onTouchEnd=function(t){if(this.beginHandler.happend){if(this.clickScaleEnable&&this.updateLayout(!0),t.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE)this.releaseOutsideHandler.listeners.dispatch(t);else{this.endHandler.listeners.dispatch(t);var i=egret.getTimer();!this.repeatPressHandler.happend&&this.longPressHandler.listeners.numListeners&&i-this.beginHandler.time>=this.longPressTimeDelta&&(this.longPressHandler.happend=!0,this.longPressHandler.listeners.dispatch(t)),this.longPressHandler.happend||this.repeatPressHandler.happend||i-e.touchClickLastTime>e.TOUCH_TAP_BETWEEN_TIME&&(e.touchClickLastTime=i,this.clickHandler.listeners.dispatch(t))}this.clearRepeatTimer(),this.beginHandler.happend=!1,this.endHandler.happend=!1,this.moveHandler.happend=!1,this.releaseOutsideHandler.happend=!1,this.longPressHandler.happend=!1,this.repeatPressHandler.happend=!1}},i.prototype.dispose=function(){this.cache=void 0,this.target&&(this.target.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.target.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.target.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)),this.clickHandler.listeners.removeAll(),this.clickHandler.happend=!1,this.longPressHandler.listeners.removeAll(),this.longPressHandler.happend=!1,this.repeatPressHandler.listeners.removeAll(),this.repeatPressHandler.happend=!1,this.releaseOutsideHandler.listeners.removeAll(),this.releaseOutsideHandler.happend=!1,this.beginHandler.listeners.removeAll(),this.beginHandler.happend=!1,this.moveHandler.listeners.removeAll(),this.moveHandler.happend=!1,this.endHandler.listeners.removeAll(),this.endHandler.happend=!1,this.target=void 0,this.inited=!1},i}(xgame.XObject);e.TouchDelegate=t,__reflect(t.prototype,"egretx.TouchDelegate",["xgame.IDisposable","xgame.IXObject"])}(egretx||(egretx={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.displayObject=e,i.touches=new xgame.List,xgame.injectInstance(i),i.displayObject&&i.displayObject.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemovedFromStage,i),i}return __extends(i,t),i.prototype.onRemovedFromStage=function(){this.dispose()},i.prototype.dispose=function(){var e=this;this.touches.forEach(function(t){e.manager.removeTouchEvents(t)}),this.touches.clear(),this.displayObject&&this.displayObject.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),this.manager=void 0,this.displayObject=void 0},i.prototype.addTouchBegin=function(e,t,i,n){this.manager.addTouchBegin(e,t,i,n),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeTouchBegin=function(e,t,i){this.manager.removeTouchBegin(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addTouchMove=function(e,t,i){this.manager.addTouchMove(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeTouchMove=function(e,t,i){this.manager.removeTouchMove(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addTouchEnd=function(e,t,i){this.manager.addTouchEnd(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeTouchEnd=function(e,t,i){this.manager.removeTouchEnd(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addReleaseOutSide=function(e,t,i){this.manager.addReleaseOutSide(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeReleaseOutSide=function(e,t,i){this.manager.removeReleaseOutSide(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addClick=function(e,t,i,n){this.manager.addClick(e,t,i,n),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeClick=function(e,t,i){this.manager.removeClick(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addLongPress=function(e,t,i,n,r){this.manager.addLongPress(e,t,i,n,r),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeLongPress=function(e,t,i){this.manager.removeLongPress(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addRepeatPress=function(e,t,i,n,r){this.manager.addRepeatPress(e,t,i,n,r),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeRepeatPress=function(e,t,i){this.manager.removeRepeatPress(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},__decorate([xgame.inject(e.ITouchManager),__metadata("design:type",e.TouchManager)],i.prototype,"manager",void 0),i}(xgame.XObject);e.TouchDisposableGroup=t,__reflect(t.prototype,"egretx.TouchDisposableGroup",["xgame.IDisposable","xgame.IXObject"])}(egretx||(egretx={})),function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.main=i,n.pipelines=[],n.uiMap=new xgame.Dictionary,n.uiLayers=new xgame.Dictionary,n.root=new eui.UILayer,n.onSceneChanged=new xgame.Signal2,n.onUIOpened=new xgame.Signal1,n.onUIClosed=new xgame.Signal1,n.RES=new e.UIResManager,n.stage=i.stage,n}return __extends(i,t),i.prototype.initialize=function(){this.entityManager=new e.UIEntityManager(this),this.pipelines.push(this.checkIsOpened.bind(this)),this.pipelines.push(this.createUIPage.bind(this)),this.pipelines.push(this.openUIPage.bind(this)),this.root.name="UIRoot",this.main.addChild(this.root);for(var t=e.UILayerID.Layer_0_Bottom;t<=e.UILayerID.Layer_15_Top;t++){var i=new e.UILayerManager(this,t);this.root.addChildAt(i,t),this.uiLayers.add(t,i)}this.register(e.Alert.NAME,e.Alert),this.register(e.PopupMenu.NAME,e.PopupMenu),e.TipsManager.Instance().initialize()},Object.defineProperty(i.prototype,"sceneTransition",{get:function(){return this.$sceneTransition},enumerable:!0,configurable:!0}),i.prototype.setSceneTransition=function(e){this.$sceneTransition=e},i.prototype.getLayerManager=function(e){return this.uiLayers.get(e)},i.prototype.register=function(e,t){this.uiMap.add(e,t)},i.prototype.popUI=function(){return!1},i.prototype.clearScene=function(){this.currentScene&&(this._closeUI(this.$currentScene),this.$currentScene=void 0)},i.prototype.closeUI=function(e){if("string"==typeof e){var t=e,i=[];if(this.entityManager.tryGetEntities(t,i))for(var n=0,r=i;n<r.length;n++){var o=r[n];this._closeUI(o)}}else this._closeUI(e)},i.prototype._closeUI=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return e.isClosed?[2]:(this.uiLayers.get(e.uiPage.layerID).removeEntity(e),this.entityManager.removeEntity(e),[4,(t=e.uiPage).doFadeOut()]);case 1:return i.sent(),t.parent&&e.uiPage.parent.removeChild(e.uiPage),e.mask&&e.mask.parent&&e.mask.parent.removeChild(e.mask),this.onUIClosed.dispatch(e),this.entityManager.checkEntities(),e.onClose(),e.dispose(),e=void 0,[2]}})})},Object.defineProperty(i.prototype,"currentScene",{get:function(){return this.$currentScene},enumerable:!0,configurable:!0}),i.prototype.replaceScene=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,r,o;return __generator(this,function(a){switch(a.label){case 0:if(o=new e.UIOptions,"string"==typeof t){if(n=t,!this.uiMap.containsKey(n))throw new Error("此UI没有注册:{0}".format(n));r=this.uiMap.get(n)}else r=t;return o.uiClass=r,o.openArgs=i,o.name=xgame.getQualifiedClassName(r),this.currentScene&&this.$currentScene.onSceneChanging(),[4,this.startPipelines(o)];case 1:return[2,a.sent()]}})})},i.prototype.openUI=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,r,o;return __generator(this,function(a){switch(a.label){case 0:if(o=new e.UIOptions,"string"==typeof t){if(n=t,!this.uiMap.containsKey(n))throw new Error("此UI没有注册:{0}".format(n));r=this.uiMap.get(n)}else r=t;return o.uiClass=r,o.openArgs=i,o.name=xgame.getQualifiedClassName(r),[4,this.startPipelines(o)];case 1:return[2,a.sent()]}})})},i.prototype.openUIWithLayer=function(t,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,o,a;return __generator(this,function(s){switch(s.label){case 0:if(a=new e.UIOptions,"string"==typeof t){if(r=t,!this.uiMap.containsKey(r))throw new Error("此UI没有注册:{0}".format(r));o=this.uiMap.get(r)}else o=t;return a.uiClass=o,a.layerID=i,a.openArgs=n,a.name=xgame.getQualifiedClassName(o),[4,this.startPipelines(a)];case 1:return[2,s.sent()]}})})},i.prototype.openUIWithRoot=function(t,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,o,a;return __generator(this,function(s){switch(s.label){case 0:if(a=new e.UIOptions,"string"==typeof t){if(r=t,!this.uiMap.containsKey(r))throw new Error("此UI没有注册:{0}".format(r));o=this.uiMap.get(r)}else o=t;return a.uiClass=o,a.uiRoot=i,a.openArgs=n,a.name=xgame.getQualifiedClassName(o),[4,this.startPipelines(a)];case 1:return[2,s.sent()]}})})},i.prototype.openPopup=function(t,i){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return __awaiter(this,void 0,void 0,function(){var r,o,a;return __generator(this,function(s){switch(s.label){case 0:if(a=new e.UIOptions,"string"==typeof t){if(r=t,!this.uiMap.containsKey(r))throw new Error("此UI没有注册:{0}".format(r));o=this.uiMap.get(r)}else o=t;return a.uiClass=o,a.hud=i,a.openArgs=n,a.name=xgame.getQualifiedClassName(o),[4,this.startPipelines(a)];case 1:return[2,s.sent()]}})})},i.prototype.startPipelines=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(n){switch(n.label){case 0:t=0,i=this.pipelines,n.label=1;case 1:return t<i.length?[4,(0,i[t])(e)]:[3,4];case 2:if(!n.sent())return e.errorMessage&&console.error(e.errorMessage),[2,null];n.label=3;case 3:return t++,[3,1];case 4:return[2,e.entity]}})})},i.prototype.checkIsOpened=function(t){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(r){return i=[],this.entityManager.tryGetEntities(t.uiClass,i)&&((n=i[0]).uiPage.flags&e.UIFlags.allowMultiple||(t.entity=n)),[2,!0]})})},i.prototype.createUIPage=function(t){return __awaiter(this,void 0,void 0,function(){var i,n,r,o,a,s=this;return __generator(this,function(c){switch(c.label){case 0:return(i=t.entity)?[3,3]:((i=new e.UIEntity).uiManager=this,i.name=t.name,t.entity=i,n=new((a=t.uiClass).bind.apply(a,[void 0].concat(t.openArgs))),xgame.injectInstance(n),n.entity=i,i.uiPage=n,this.entityManager.addEntity(i),n.onInit(),n.visible=!1,t.hud&&n.renderWatcher.onChanged().add(function(){egret.callLater(function(){e.TipsHelper.placeTipsWithHUD(n,t.hud,t.gap)},s)},this),t.uiRoot?t.uiRoot.addChild(n):(t.layerID&&n.setLayerID(t.layerID),o=this.uiLayers.get(n.layerID),n.flags&e.UIFlags.useMask&&(i.createMask(n.maskColor,n.maskAlpha,n.flags&e.UIFlags.closeByMask),o.addChild(i.mask)),t.hud||n.flags&e.UIFlags.isPlugin||(n.left=n.right=n.top=n.bottom=0),o.addEntity(i),o.addChild(n)),[4,n.load()]);case 1:return c.sent(),n.onOpen(),[4,xgame.waitEndFrames()];case 2:return c.sent(),t.hud||(n.visible=!0),[3,4];case 3:r=i.uiPage,null!=t.layerID&&t.layerID!=r.layerID?((o=this.uiLayers.get(r.layerID)).removeEntity(i),i.mask&&i.mask.parent&&i.mask.parent.removeChild(i.mask),i.uiPage&&i.uiPage.parent&&i.uiPage.parent.removeChild(i.uiPage),(o=this.uiLayers.get(t.layerID)).addEntity(i),i.mask&&o.addChild(i.mask),i.uiPage&&(i.uiPage.setLayerID(t.layerID),o.addChild(i.uiPage))):(o=this.uiLayers.get(r.layerID)).orderToFront(i),c.label=4;case 4:return this.entityManager.checkEntities(),[2,!0]}})})},i.prototype.openUIPage=function(t){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(r){switch(r.label){case 0:return(i=t.entity)?(n=i.uiPage).isLoaded?n.flags&e.UIFlags.Scene?this.currentScene?this.sceneTransition?[4,this.sceneTransition.start(this.currentScene.uiPage)]:[3,2]:[3,4]:[3,5]:(t.errorMessage="UIPage:{0}还没有加载完成".format(t.name),[2,!1]):(t.errorMessage="UIEntity:{0}不能为空".format(t.name),[2,!1]);case 1:r.sent(),r.label=2;case 2:return this.onSceneChanged.dispatch(i,this.currentScene),[4,this._closeUI(this.$currentScene)];case 3:r.sent(),r.label=4;case 4:this.$currentScene=i,r.label=5;case 5:return[4,n.doFadeIn()];case 6:return r.sent(),this.onUIOpened.dispatch(i),[2,!0]}})})},i=__decorate([xgame.impl(e.IUIManager,e.IUIManagerInternal),__metadata("design:paramtypes",[egret.DisplayObjectContainer])],i)}(xgame.XObject);e.UIManager=t,__reflect(t.prototype,"egretx.UIManager",["egretx.IUIManager","xgame.IXObject","egretx.IUIManagerInternal"])}(egretx||(egretx={})),function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setTouchManager(this)},i=__decorate([xgame.mixin(e.TouchBehaviours),__metadata("design:paramtypes",[])],i)}(eui.Group);e.Group=t,__reflect(t.prototype,"egretx.Group",["xgame.IXObject"])}(egretx||(egretx={})),function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setTouchManager(this)},i=__decorate([xgame.mixin(e.TouchBehaviours),__metadata("design:paramtypes",[])],i)}(eui.ItemRenderer);e.ItemRenderer=t,__reflect(t.prototype,"egretx.ItemRenderer")}(egretx||(egretx={})),function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setTouchManager(this)},i=__decorate([xgame.mixin(e.TouchBehaviours),__metadata("design:paramtypes",[])],i)}(eui.Component);e.UIComponent=t,__reflect(t.prototype,"egretx.UIComponent",["xgame.IXObject","eui.UIComponent","egret.DisplayObject"])}(egretx||(egretx={})),function(e){!function(e){e[e.CENTER=0]="CENTER",e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT"}(e.UIAlign||(e.UIAlign={}))}(egretx||(egretx={})),function(e){!function(e){e[e.ANY=0]="ANY",e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT"}(e.UIDirection||(e.UIDirection={}))}(egretx||(egretx={})),function(e){var t=function(t){function i(i){void 0===i&&(i=null);var n=t.call(this)||this;return n.skinPath=i,n.flags=e.UIFlags.isStack|e.UIFlags.isFullScreen,n.onComplete=new xgame.Signal0,n.$isLoaded=!1,n.$isLoading=!1,n.deferred=new xgame.Deferred,n.$maskAlpha=.5,n.$maskColor=0,n.$layerID=e.UILayerID.Layer_5_UI,n}return __extends(i,t),Object.defineProperty(i.prototype,"isLoaded",{get:function(){return this.$isLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isLoading",{get:function(){return this.$isLoading},enumerable:!0,configurable:!0}),i.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return this.$isLoading=!0,this.skinPath&&!this.isLoaded?(this.once(egret.Event.COMPLETE,function(){e.doComplete()},this),this.skinName=this.skinPath):this.doComplete(),[2,this.deferred.promise]})})},i.prototype.doComplete=function(){var e=this;egret.callLater(function(){e.$isLoaded=!0,e.onComplete.dispatch(),e.deferred.resolve()},this)},Object.defineProperty(i.prototype,"maskAlpha",{get:function(){return this.$maskAlpha},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maskColor",{get:function(){return this.$maskColor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerID",{get:function(){return this.$layerID},enumerable:!0,configurable:!0}),i.prototype.setLayerID=function(e){this.$layerID=e},i.prototype.onInit=function(){this.addEventObserves&&this.addEventObserves()},i.prototype.onOpen=function(){},i.prototype.onSceneChanging=function(){},i.prototype.onClose=function(){this.removeEventObserves&&this.removeEventObserves(),this.entity=void 0},i.prototype.onShow=function(){},i.prototype.onHide=function(){},i.prototype.close=function(){this.entity&&this.entity.closePage()},i.prototype.doFadeIn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},i.prototype.doFadeOut=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},i}(e.UIComponent);e.UIPage=t,__reflect(t.prototype,"egretx.UIPage")}(egretx||(egretx={})),function(e){!function(e){e[e.None=0]="None",e[e.useMask=1]="useMask",e[e.isStack=2]="isStack",e[e.isFullScreen=4]="isFullScreen",e[e.allowMultiple=8]="allowMultiple",e[e.closeByMask=16]="closeByMask",e[e.isPopupMenu=32]="isPopupMenu",e[e.isPlugin=64]="isPlugin",e[e.Scene=128]="Scene"}(e.UIFlags||(e.UIFlags={}))}(egretx||(egretx={})),function(e){var t=function(t){function i(i){var n=t.call(this,i)||this;return n.flags=e.UIFlags.isPlugin,n}return __extends(i,t),i}(e.UIPage);e.PluginPage=t,__reflect(t.prototype,"egretx.PluginPage")}(egretx||(egretx={})),function(e){var t=function(t){function i(i){var n=t.call(this,i)||this;return n.flags=e.UIFlags.isStack|e.UIFlags.useMask|e.UIFlags.closeByMask,n.setLayerID(e.UILayerID.Layer_8_Window),n}return __extends(i,t),i}(e.UIPage);e.Window=t,__reflect(t.prototype,"egretx.Window")}(egretx||(egretx={})),function(e){!function(e){e[e.Layer_0_Bottom=0]="Layer_0_Bottom",e[e.Layer_1=1]="Layer_1",e[e.Layer_2_Scene=2]="Layer_2_Scene",e[e.Layer_3_SceneMask=3]="Layer_3_SceneMask",e[e.Layer_4_SceneFrame=4]="Layer_4_SceneFrame",e[e.Layer_5_UI=5]="Layer_5_UI",e[e.Layer_6_UIMask=6]="Layer_6_UIMask",e[e.Layer_7_UIFrame=7]="Layer_7_UIFrame",e[e.Layer_8_Window=8]="Layer_8_Window",e[e.Layer_9=9]="Layer_9",e[e.Layer_10_Tips=10]="Layer_10_Tips",e[e.Layer_11_Toast=11]="Layer_11_Toast",e[e.Layer_12_Loading=12]="Layer_12_Loading",e[e.Layer_13=13]="Layer_13",e[e.Layer_14=14]="Layer_14",e[e.Layer_15_Top=15]="Layer_15_Top"}(e.UILayerID||(e.UILayerID={}))}(egretx||(egretx={})),function(e){var t=["x","y","width","height","visible","scaleX","scaleY"],i=function(e){function i(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=e.call(this)||this;n.views=[],n.watchers=[],n.dict=new xgame.Dictionary,n.callback_onChanged=new xgame.Signal0,n.isDispatching=!1;for(var r=0,o=t;r<o.length;r++){var a=o[r];n.addWatcher(a)}return n}return __extends(i,e),i.prototype.addWatcher=function(e){if(!(this.views.indexOf(e)>=0)){this.views.push(e);var i=this.dict.get(e.hashCode);i||(i=[],this.dict.add(e.hashCode,i));for(var n=0,r=t;n<r.length;n++){var o=r[n],a=eui.Binding.bindHandler(e,[o],this.onWatcher,this);this.watchers.push(a),i.push(a)}}},i.prototype.removeWatcher=function(e){if(this.dict.containsKey(e.hashCode)){for(var t=this.dict.get(e.hashCode),i=(this.watchers.length,0),n=t;i<n.length;i++){var r=n[i],o=this.watchers.indexOf(r);o>-1&&this.watchers.splice(o,1),r.unwatch()}t.length=0,this.dict.remove(e.hashCode)}},i.prototype.onWatcher=function(e){this.lateDispatch()},i.prototype.lateDispatch=function(){var e=this;this.isDispatching||(this.isDispatching=!0,egret.callLater(function(){e.callback_onChanged.dispatch(),e.isDispatching=!1},this))},i.prototype.onChanged=function(){return this.callback_onChanged},i.prototype.dispose=function(){for(this.callback_onChanged.removeAll();this.watchers.length;){this.watchers.shift().unwatch()}this.views&&(this.views.length=0),this.dict.clear()},i}(xgame.XObject);e.RenderWatcher=i,__reflect(i.prototype,"egretx.RenderWatcher");var n=function(t){function n(n){var r=t.call(this,n)||this;return r.renderWatcher=new i,r.offset=new egret.Point,r.$uiDirection=e.UIDirection.ANY,r.$uiAlign=e.UIAlign.CENTER,r.flags=e.UIFlags.isStack|e.UIFlags.isPopupMenu|e.UIFlags.useMask|e.UIFlags.closeByMask|e.UIFlags.allowMultiple,r.setLayerID(e.UILayerID.Layer_10_Tips),r.$maskAlpha=0,r.renderWatcher.addWatcher(r),r}return __extends(n,t),Object.defineProperty(n.prototype,"uiDirection",{get:function(){return this.$uiDirection},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"uiAlign",{get:function(){return this.$uiAlign},enumerable:!0,configurable:!0}),n.prototype.allowUIDirection=function(e){return!this.allowDirections||!this.allowDirections.length||this.allowDirections.indexOf(e)>=0},n.prototype.fixedUIDirection=function(e){},n.prototype.onClose=function(){this.renderWatcher&&this.renderWatcher.dispose(),t.prototype.onClose.call(this)},n}(e.UIPage);e.Popup=n,__reflect(n.prototype,"egretx.Popup")}(egretx||(egretx={})),function(e){var t=function(t){function i(i){var n=t.call(this,i)||this;return n.flags=e.UIFlags.Scene|e.UIFlags.isFullScreen,n.setLayerID(e.UILayerID.Layer_2_Scene),n}return __extends(i,t),i}(e.UIPage);e.Scene=t,__reflect(t.prototype,"egretx.Scene")}(egretx||(egretx={})),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"isClosed",{get:function(){return this.$isClosed},enumerable:!0,configurable:!0}),t.prototype.createMask=function(e,t,i){this.mask||(this.mask=new eui.Rect(100,100,e),this.mask.alpha=t,this.mask.left=this.mask.right=this.mask.top=this.mask.bottom=0,i&&this.mask.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onMaskClose,this))},t.prototype.onMaskClose=function(){this.mask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMaskClose,this),this.closePage()},t.prototype.onSceneChanging=function(){this.uiPage&&this.uiPage.onSceneChanging()},t.prototype.onClose=function(){this.$isClosed=!0,this.uiPage&&this.uiPage.onClose()},t.prototype.closePage=function(){this.uiManager&&this.uiManager.closeUI(this)},t.prototype.showPage=function(){this.uiPage&&(this.uiPage.visible=!0)},t.prototype.hidePage=function(){this.uiPage&&(this.uiPage.visible=!1)},t.prototype.dispose=function(){this.mask&&this.mask.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onMaskClose,this),this.uiPage=void 0,this.mask=void 0},t}(xgame.XObject);e.UIEntity=t,__reflect(t.prototype,"egretx.UIEntity",["egretx.IUIEntity","xgame.IDisposable","xgame.IXObject"])}(egretx||(egretx={})),function(e){var t=function(){function t(){}return t.isFullScreenUI=function(t){var i=t.uiPage.flags;return!!(i&e.UIFlags.isStack)&&!!(i&e.UIFlags.isFullScreen)},t.isWindowUI=function(i){var n=i.uiPage.flags;return!!(n&e.UIFlags.isStack)&&(!(n&e.UIFlags.isFullScreen)&&!t.isPopupMenuUI(i))},t.isPopupMenuUI=function(t){var i=t.uiPage.flags;return!!(i&e.UIFlags.isStack)&&(!(i&e.UIFlags.isFullScreen)&&!!(i&e.UIFlags.isPopupMenu))},t.isPluginUI=function(t){return!!(t.uiPage.flags&e.UIFlags.isPlugin)},t.isSceneUI=function(t){return!!(t.uiPage.flags&e.UIFlags.Scene)},t}();e.UIHelper=t,__reflect(t.prototype,"egretx.UIHelper")}(egretx||(egretx={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.manager=e,i.entityMap=new xgame.Dictionary,i.stackList=new xgame.List,i}return __extends(i,t),i.prototype.addEntity=function(t){var i=this.entityMap.get(t.name);i||(i=[],this.entityMap.add(t.name,i)),-1==i.indexOf(t)&&(i.push(t),t.uiPage.flags&e.UIFlags.isStack&&this.stackList.add(t))},Object.defineProperty(i.prototype,"stackCount",{get:function(){return this.stackList.count()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"topUI",{get:function(){if(this.stackCount>0)return this.stackList.last()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"topFullScreenUI",{get:function(){for(var t=this.stackCount-1;t>=0;){var i=this.stackList.elementAt(t);if(i.uiPage.flags&e.UIFlags.isFullScreen)return i;t--}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasPopUp",{get:function(){for(var t=this.stackCount-1;t>=0;){var i=this.stackList.elementAt(t);if(e.UIHelper.isWindowUI(i))return!0;t--}return!1},enumerable:!0,configurable:!0}),i.prototype.checkEntities=function(){for(var t=!0,i=!1,n=this.stackCount-1;n>=0;){var r=this.stackList.elementAt(n);t?r.showPage():r.hidePage(),r.uiPage.flags&e.UIFlags.isFullScreen&&(i=!0,t=!1),n--}i?this.hideUIUnderLayers():this.showUIUnderLayers()},i.prototype.hideUIUnderLayers=function(){var t=this;this.manager.uiLayers.forKeys(function(i){if(i>=e.UILayerID.Layer_5_UI)return!0;t.manager.uiLayers.get(i).visible=!1},this)},i.prototype.showUIUnderLayers=function(){var t=this;this.manager.uiLayers.forKeys(function(i){if(i>=e.UILayerID.Layer_5_UI)return!0;t.manager.uiLayers.get(i).visible=!0},this)},i.prototype.removeEntity=function(t){if(this.entityMap.containsKey(t.name)){var i=this.entityMap.get(t.name),n=i.indexOf(t);n>=0&&(i.splice(n,1),t.uiPage.flags&e.UIFlags.isStack&&this.stackList.remove(t))}},i.prototype.tryGetEntities=function(e,t){var i,n,r;if("string"==typeof e){if(i=e,!this.manager.uiMap.containsKey(i))throw new Error("此UI没有注册:{0}".format(i));n=this.manager.uiMap.get(i)}else n=e;if(r=xgame.getQualifiedClassName(n),this.entityMap.containsKey(r)){var o=this.entityMap.get(r);if(o&&o.length)return t&&(t.length=0,t.push.apply(t,o)),!0}return!1},i}(xgame.XObject);e.UIEntityManager=t,__reflect(t.prototype,"egretx.UIEntityManager")}(egretx||(egretx={})),function(e){var t=function(t){function i(i,n){var r=t.call(this)||this;return r.manager=i,r.id=n,r.entities=new xgame.List,r.name=""+e.UILayerID[n],r.touchEnabled=!1,r}return __extends(i,t),Object.defineProperty(i.prototype,"count",{get:function(){return this.entities.count()},enumerable:!0,configurable:!0}),i.prototype.addEntity=function(e){this.entities.contains(e)||this.entities.add(e)},i.prototype.removeEntity=function(e){this.entities.contains(e)&&this.entities.remove(e)},i.prototype.orderToFront=function(e){if(this.entities.contains(e)){this.entities.remove(e);var t=this.numChildren-1;t<0&&(t=0),this.setChildIndex(e.uiPage,t),e.mask&&((t=this.numChildren-2)<0&&(t=0),this.setChildIndex(e.mask,t)),this.entities.add(e)}},i}(eui.UILayer);e.UILayerManager=t,__reflect(t.prototype,"egretx.UILayerManager")}(egretx||(egretx={}));var onDisplayListChanged=new xgame.Signal1,onDisplayListDisposed=new xgame.Signal1,egret_BitmapData_displayList=egret.BitmapData._displayList,egret_BitmapData_addDisplayObject=egret.BitmapData.$addDisplayObject,egret_BitmapData_removeDisplayObject=egret.BitmapData.$removeDisplayObject,egret_BitmapData_dispose=egret.BitmapData.$dispose;function get_timestamp(){return Math.floor((new Date).valueOf()/1e3)}egret.BitmapData.$addDisplayObject=function(e,t){if(t){var i=t.hashCode;i&&(egret_BitmapData_addDisplayObject(e,t),onDisplayListChanged.dispatch(i))}},egret.BitmapData.$removeDisplayObject=function(e,t){if(t){var i=t.hashCode;i&&egret_BitmapData_displayList[i]&&(egret_BitmapData_removeDisplayObject(e,t),onDisplayListChanged.dispatch(i))}},egret.BitmapData.$dispose=function(e){if(e){var t=e.hashCode;t&&(egret_BitmapData_dispose(e),egret_BitmapData_displayList[t]||onDisplayListDisposed.dispatch(t))}},function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.textures=new xgame.Dictionary,onDisplayListChanged.add(t.onDisplayListChanged,t),onDisplayListDisposed.add(t.onDisplayListDisposed,t),t}return __extends(t,e),t.prototype.gc=function(e){var t=this,i=get_timestamp();this.textures.forValues(function(n){n.reference<=0&&(e||i-n.timestamp>=60)&&(t.destroyRes(n.key),t.textures.remove(n.hashCode))},this,!0)},t.prototype.destroyRes=function(e){RES.hasRes(e)&&RES.getRes(e)&&(RES.destroyRes(e),console.log("UIResManager:destroyRes({0})".format(e)))},t.prototype.onDisplayListChanged=function(e){if(this.textures.containsKey(e)||this.textures.add(e,{hashCode:e,reference:0,timestamp:get_timestamp(),key:""}),egret_BitmapData_displayList[e]){var t=this.textures.get(e),i=egret_BitmapData_displayList[e];t.reference=i.length,t.timestamp=get_timestamp()}},t.prototype.onDisplayListDisposed=function(e){this.textures.containsKey(e)&&this.textures.remove(e)},t.prototype.register=function(e,t){if(t){var i=t.bitmapData;if(i){var n=i.hashCode;n&&(this.textures.containsKey(n)?this.textures.get(n).key=e:this.textures.add(n,{hashCode:n,reference:0,timestamp:get_timestamp(),key:e}))}}},t}(xgame.XObject);e.UIResManager=t,__reflect(t.prototype,"egretx.UIResManager")}(egretx||(egretx={})),function(e){e.alert=function(i,n,r,o){var a;return void 0===o&&(o=!0),"string"==typeof i?(a={message:i,title:n,showCloseButton:!0,closeByMask:!0},null!=r&&(Array.isArray(r)?(a.buttons=r,a.closeByMask=o):"number"==typeof r?(a.numButton=r,a.closeByMask=o):"boolean"==typeof r&&(a.closeByMask=r))):a=i,a.callback=new xgame.Signal1,xgame.that.getService(e.IUIManager).openUI(t,a),a.callback};var t=function(t){function i(n){var r=t.call(this,n.skinName||i.defaultSkinName)||this;return r.options=n,r.clickButtonIndex=void 0,r.options.closeByMask||(r.flags&=~e.UIFlags.closeByMask),r.options.width&&(r.width=r.options.width),r.options.height&&(r.height=r.options.height),r}return __extends(i,t),i.prototype.close=function(){this.options.callback&&this.options.callback.dispatch(this.clickButtonIndex),t.prototype.close.call(this)},i.prototype.onClose=function(){this.options.callback&&this.options.callback.removeAll(),this.options.callback=void 0,this.options.buttons=void 0,t.prototype.onClose.call(this)},i.prototype.getButton=function(e){return this["btn_{0}".format(e)]},i.prototype.onOpen=function(){var e=this;t.prototype.onOpen.call(this),this.addClick(this.btn_close,function(){e.close()},this),this.options.showCloseButton||(this.btn_close.visible=!1),this.options.title&&(this.lab_title.textFlow=(new egret.HtmlTextParser).parse(this.options.title)),this.lab_content.textFlow=(new egret.HtmlTextParser).parse(this.options.message);for(var i=[],n=0;;){var r=this.getButton(n);if(!r)break;i.push(r),n++}for(var o=0;o<i.length;o++)i[o].visible=!1,i[o].name=o.toString(),i[o].includeInLayout=!1,this.addClick(i[o],this.onButtonClick,this);if(this.options.buttons&&this.options.buttons.length)for(o=0;o<this.options.buttons.length;o++)i[o].label=this.options.buttons[o],i[o].visible=!0,i[o].includeInLayout=!0;else{var a=this.options.numButton||2;for(o=0;o<a;o++)i[o].visible=!0,i[o].includeInLayout=!0}},i.prototype.onButtonClick=function(e){var t=e.target;this.clickButtonIndex=parseInt(t.name),this.close()},i.defaultSkinName="",i.NAME="Alert",__decorate([e.inject(e.IUIManager),__metadata("design:type",Object)],i.prototype,"uiManager",void 0),i}(e.Window);e.Alert=t,__reflect(t.prototype,"egretx.Alert")}(egretx||(egretx={})),function(e){var t=egret.sys;function i(e,i){return t.measureText(e,i.fontFamily,i.size,i.bold,i.italic)}e.get_measure_width=i;var n,r=1;!function(e){e[e.Any=1]="Any",e[e.Source=1<<r++]="Source",e[e.TextColor=1<<r++]="TextColor",e[e.Align=1<<r++]="Align",e[e.Value=1<<r++]="Value",e[e.Dispatch=1<<r++]="Dispatch",e[e.ItemRenderSkinName=1<<r++]="ItemRenderSkinName"}(n||(n={}));var o=function(t){function r(){var e=t.call(this)||this;return e.invalidateFlags=n.Any,e.callback_onSelectChanged=new xgame.Signal3,e.$isOpened=!1,e.$textColor=6319521,e.$popupItemHeight=46,e.$popupTextAlign=egret.HorizontalAlign.CENTER,e.$textAlign=egret.HorizontalAlign.CENTER,e.$selectedIndex=-1,e.$itemRenderGap=0,e.isLate=!1,e}return __extends(r,t),r.toSource=function(e){for(var t=[],i=0,n=e;i<n.length;i++){var r=n[i];t.push({label:r})}return t},r.itemToLabel=function(e){return e.label?e.label:e.toString()},r.prototype.onSelectChanged=function(){return this.callback_onSelectChanged},r.prototype.$onRemoveFromStage=function(){this.callback_onSelectChanged.removeAll(),t.prototype.$onRemoveFromStage.call(this)},r.prototype.dispose=function(){this.callback_onSelectChanged.removeAll()},r.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.touchChildren=!1,this.lab_title.multiline=!1,this.lab_title.wordWrap=!1,this.addClick(this,function(){e.source&&0!=e.source.length&&e.openPopup()},this)},Object.defineProperty(r.prototype,"isOpened",{get:function(){return this.$isOpened},enumerable:!0,configurable:!0}),r.prototype.openPopup=function(){var t=this;if(!this.isOpened){this.$isOpened=!0;for(var i=[],n=0;n<this.source.length;n++)i.push(this.getMenuItem(n));this.options={enableClick:!0,items:i,itemGap:this.itemRenderGap?this.itemRenderGap:2,itemHeight:this.popupItemHeight,selected:this.selectedIndex,allowDirections:[e.UIDirection.BOTTOM,e.UIDirection.TOP],uiDirection:e.UIDirection.ANY,minWidth:this.width,textAlign:this.popupTextAlign,itemRender:this.popupItemRender,itemRenderSkinName:this.popupItemRenderSkinName||r.defaultItemRenderSkinName,arrowPadding:this.popupArrowPadding,offset:this.popupOffset},this.img_icon.scaleY=-1,e.showPopupMenu(this,this.options).addOnce(function(e){e&&t.setSelectedIndex(e.index,!0),t.img_icon.scaleY=1,t.$isOpened=!1,t.options.instance=void 0,t.options=void 0},this)}},r.prototype.closePopup=function(){this.isOpened&&(this.img_icon.scaleY=1,this.$isOpened=!1,this.options&&this.options.instance&&(this.options.instance.close(),this.options.instance=void 0),this.options=void 0)},Object.defineProperty(r.prototype,"textColor",{get:function(){return this.$textColor},set:function(e){this.$textColor=e,this.invalidateFlags|=n.TextColor,this.lateUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"popupItemHeight",{get:function(){return this.$popupItemHeight},set:function(e){this.$popupItemHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"popupTextAlign",{get:function(){return this.$popupTextAlign},set:function(e){this.$popupTextAlign=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textAlign",{get:function(){return this.$textAlign},set:function(e){this.$textAlign=e,this.invalidateFlags|=n.Align,this.lateUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"selectedIndex",{get:function(){return this.$selectedIndex},set:function(e){e<0||e==this.selectedIndex||this.setSelectedIndex(e)},enumerable:!0,configurable:!0}),r.prototype.setSelectedIndex=function(e,t){this.$selectedIndex=e,this.invalidateFlags|=n.Value,t&&this.callback_onSelectChanged.dispatch(e,this.source[e],this),this.lateUpdate()},Object.defineProperty(r.prototype,"selectedItem",{get:function(){if(this.selectedIndex>=0&&this.source.length)return this.source[this.selectedIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"source",{get:function(){return this.$source},set:function(e){this.$source=e,this.invalidateFlags|=n.Source,this.minWidth=0;for(var t=0,r=e;t<r.length;t++){var o=r[t],a=i(this.getTitle(o),this.lab_title)+75;this.minWidth<a&&(this.minWidth=a)}this.lateUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"itemRenderGap",{get:function(){return this.$itemRenderGap},set:function(e){this.$itemRenderGap=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"popupItemRenderSkinName",{get:function(){return this.$popupItemRenderSkinName},set:function(e){this.$popupItemRenderSkinName=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"popupItemRender",{get:function(){return this.$popupItemRender},set:function(e){this.$popupItemRender=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"popupArrowPadding",{get:function(){return this.$popupArrowPadding},set:function(e){this.$popupArrowPadding=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"popupOffset",{get:function(){return this.$popupOffset},set:function(e){this.$popupOffset=e},enumerable:!0,configurable:!0}),r.prototype.lateUpdate=function(){var e=this;this.isLate||(this.isLate=!0,egret.callLater(function(){e.onDrawComponent(),e.isLate=!1},this))},r.prototype.getMenuItem=function(e){var t={index:e},i=this.source[e];return t.title=this.getTitle(i),t},r.prototype.getTitle=function(e){return this.itemToLabel?this.itemToLabel(e):r.itemToLabel(e)},r.prototype.onDrawComponent=function(){-1==this.selectedIndex&&(this.selectedIndex=0);var e=this.source&&this.source.length?this.source[this.selectedIndex]:void 0;(this.invalidateFlags==n.Any||this.invalidateFlags&n.Source)&&(this.invalidateFlags|=n.Value),(this.invalidateFlags==n.Any||this.invalidateFlags&n.Value)&&e&&(this.lab_title.text=this.getTitle(e)),(this.invalidateFlags==n.Any||this.invalidateFlags&n.TextColor)&&(this.lab_title.textColor=this.textColor),(this.invalidateFlags==n.Any||this.invalidateFlags&n.Align)&&(this.lab_title.textAlign=this.textAlign),this.invalidateFlags=0},r.defaultItemRenderSkinName="",r}(e.UIComponent);e.DropdownList=o,__reflect(o.prototype,"egretx.DropdownList",["xgame.IPoolable","xgame.IDisposable"])}(egretx||(egretx={})),function(e){var t,i=1;!function(e){e[e.Any=1]="Any",e[e.Source=1<<i++]="Source",e[e.TextColor=1<<i++]="TextColor",e[e.Align=1<<i++]="Align",e[e.Value=1<<i++]="Value",e[e.SelectedIndex=1<<i++]="SelectedIndex",e[e.ItemSkinName=1<<i++]="ItemSkinName"}(t||(t={}));var n=function(i){function n(){var n=i.call(this)||this;return n.invalidateFlags=t.Any,n.callback_onSelectChanged=new xgame.Signal3,n.$textColor=6319521,n.$popupItemHeight=0,n.$popupTextAlign=egret.HorizontalAlign.CENTER,n.$textAlign=egret.HorizontalAlign.CENTER,n.isLate=!1,n.selectedIndexes=[],n.items=[],n.pools=new xgame.PoolObject(e.DropdownList),n}return __extends(n,i),n.prototype.destroy=function(){this.pools.release()},n.prototype.onSelectChanged=function(){return this.callback_onSelectChanged},Object.defineProperty(n.prototype,"dropdownSkinName",{get:function(){return this.$dropdownSkinName},set:function(e){this.$dropdownSkinName=e,this.invalidateFlags|=t.ItemSkinName,this.lateUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"popupItemRenderSkinName",{get:function(){return this.$popupItemRenderSkinName},set:function(e){this.$popupItemRenderSkinName=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textColor",{get:function(){return this.$textColor},set:function(e){this.$textColor=e,this.invalidateFlags|=t.TextColor,this.lateUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"popupItemHeight",{get:function(){return this.$popupItemHeight},set:function(e){this.$popupItemHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"popupTextAlign",{get:function(){return this.$popupTextAlign},set:function(e){this.$popupTextAlign=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textAlign",{get:function(){return this.$textAlign},set:function(e){this.$textAlign=e,this.invalidateFlags|=t.Align,this.lateUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"source",{get:function(){return this.$source},set:function(e){this.$source=e,this.invalidateFlags|=t.Source,this.selectedIndexes.length=0;for(var i=0,n=e;i<n.length;i++){var r=n[i];this.selectedIndexes.push(null!=r.selectedIndex?r.selectedIndex:0)}this.lateUpdate()},enumerable:!0,configurable:!0}),n.prototype.getSelectedIndexes=function(){return this.selectedIndexes},n.prototype.getSelectedIndex=function(e){return e<this.selectedIndexes.length?this.selectedIndexes[e]:-1},n.prototype.setSelectedIndexes=function(e){var i=e.length;i=Math.min(i,this.source.length);for(var n=0;n<i;n++)this.selectedIndexes[n]=e[n];this.invalidateFlags|=t.SelectedIndex,this.lateUpdate()},n.prototype.setSelectedIndex=function(e,i){e<this.items.length&&(this.selectedIndexes[e]=i,this.invalidateFlags|=t.SelectedIndex,this.lateUpdate())},n.prototype.lateUpdate=function(){var e=this;this.isLate||(this.isLate=!0,egret.callLater(function(){e.onDrawComponent(),e.isLate=!1},this))},n.prototype.onDrawComponent=function(){if((this.invalidateFlags==t.Any||this.invalidateFlags&t.Source)&&(this.clearItems(),this.initItems()),this.invalidateFlags==t.Any||this.invalidateFlags&t.Align)for(var e=0,i=this.items;e<i.length;e++){var n=i[e];n.textAlign=this.textAlign,n.popupTextAlign=this.popupTextAlign}if(this.invalidateFlags==t.Any||this.invalidateFlags&t.SelectedIndex)for(var r=0;r<this.selectedIndexes.length;r++)this.getItemAt(r).selectedIndex=this.selectedIndexes[r];this.invalidateFlags=0},n.prototype.clearItems=function(){for(;this.items.length;){var e=this.items.pop();this.removeChild(e),this.pools.recycle(e)}},n.prototype.initItems=function(){if(this.source&&0!=this.source.length)for(var e=0;e<this.source.length;e++){var t=this.source[e],i=this.getItemAt(e);i.selectedIndex=this.selectedIndexes[e],i.textAlign=this.textAlign,i.popupTextAlign=this.popupTextAlign,i.popupItemHeight=this.popupItemHeight?this.popupItemHeight:n.defaultPopupItemHeight,i.source=t.source,i.skinName=this.dropdownSkinName||n.defaultDropdownSkinName,i.popupItemRenderSkinName=this.popupItemRenderSkinName}},n.prototype.getItemAt=function(e){var t=this;if(!this.items[e]){var i=this.pools.fetch(function(){return t.fetchDropdownList?t.fetchDropdownList():n.defaultFetchDropdownList()},this);i.onSelectChanged().add(this.onSelectChangeHandler,this),this.items[e]=i,this.addChildAt(i,e)}return this.items[e]},n.prototype.indexOf=function(e){return this.items.indexOf(e)},n.prototype.onSelectChangeHandler=function(e,t,i){var n=this.indexOf(i);this.selectedIndexes[n]=e;for(var r=this.selectedIndexes.slice(),o=[],a=0;a<this.selectedIndexes.length;a++)o.push(this.getItemAt(a).source[this.selectedIndexes[a]]);this.callback_onSelectChanged.dispatch(n,r,o)},n.defaultDropdownSkinName="",n.defaultPopupItemHeight=30,n}(e.Group);e.DropdownListGroup=n,__reflect(n.prototype,"egretx.DropdownListGroup")}(egretx||(egretx={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.ITEM_CLICK="PopupMenuEvent_itemClick",t}(egret.Event);e.PopupMenuEvent=t,__reflect(t.prototype,"egretx.PopupMenuEvent");var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),Object.defineProperty(i.prototype,"item",{get:function(){return this.data},enumerable:!0,configurable:!0}),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.left=this.right=0},i.prototype.childrenCreated=function(){var i=this;e.prototype.childrenCreated.call(this),this.addClick(this,function(){i.item&&i.dispatchEvent(new t(t.ITEM_CLICK,!0,!0,i.item))},this)},i.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.item&&(this.lab_title.textFlow=(new egret.HtmlTextParser).parse("{0}".format(this.item.title)),this.item.textAlign&&(this.lab_title.textAlign=this.item.textAlign))},i}(e.ItemRenderer);e.PopupMenuItem=i,__reflect(i.prototype,"egretx.PopupMenuItem");var n=function(n){function r(t){var i=n.call(this,t.skinName||r.defaultSkinName)||this;i.options=t,i.callback_onSelect=new xgame.Signal1,i.arrowPadding=20,t.instance=i,t.offset&&(i.offset.x=t.offset.x,i.offset.y=t.offset.y),null==t.arrowPadding&&(t.arrowPadding=20),t.width&&(i.width=t.width),t.height&&(i.height=t.height),null==t.uiDirection&&(t.uiDirection=e.UIDirection.BOTTOM),null==t.uiAlign&&(t.uiAlign=e.UIAlign.CENTER),t.itemHeight=t.itemHeight?t.itemHeight:30,t.itemGap=null!=t.itemGap?t.itemGap:2,t.allowDirections&&t.allowDirections.length&&(i.allowDirections=t.allowDirections),i.$uiDirection=t.uiDirection,i.$uiAlign=t.uiAlign,i.arrowPadding=t.arrowPadding;var o=i.options.baseHeight||r.defaultBaseHeight;return i.options.height||(i.height=o+(i.options.itemHeight+i.options.itemGap)*i.options.items.length-i.options.itemGap),!i.options.width&&i.options.minWidth&&i.width<i.options.minWidth&&(i.width=i.options.minWidth),i}return __extends(r,n),r.toOptions=function(e,t){for(var i={items:[],selected:null==t?0:t},n=0;n<e.length;n++)i.items.push({index:n,title:e[n]});return i},r.prototype.onSelect=function(){return this.options.callback||this.callback_onSelect},r.prototype.fixedUIDirection=function(e){this.updateArrow(e)},r.prototype.onClose=function(){this.onSelect().dispatch(this.selectedItem),this.list_item.removeEventListener(t.ITEM_CLICK,this.onItemClickHandler,this),this.options&&(this.options.instance=void 0),n.prototype.onClose.call(this)},r.prototype.onItemClickHandler=function(e){e.stopPropagation(),this.selectedItem=e.data,this.close()},r.prototype.onOpen=function(){if(n.prototype.onOpen.call(this),this.list_item.itemRenderer=this.options.itemRender,this.list_item.layout.gap=this.options.itemGap,this.options.itemRenderSkinName&&(this.list_item.itemRendererSkinName=this.options.itemRenderSkinName),this.options.itemRender?this.list_item.itemRenderer=this.options.itemRender:this.list_item.itemRenderer=i,this.list_item.addEventListener(t.ITEM_CLICK,this.onItemClickHandler,this),this.list_item.replaceAll(this.options.items),null!=this.options.selected){var e=this.options.selected;e>=0&&(this.list_item.selectedIndex=e)}},r.prototype.updateArrow=function(t){this.arrow_down.visible=!1,this.arrow_up.visible=!1,this.arrow_left.visible=!1,this.arrow_right.visible=!1,t==e.UIDirection.BOTTOM?(this.arrow_down.visible=!0,this.uiAlign==e.UIAlign.LEFT?(this.arrow_down.horizontalCenter=NaN,this.arrow_down.left=this.arrowPadding,this.arrow_down.right=NaN):this.uiAlign==e.UIAlign.RIGHT?(this.arrow_down.horizontalCenter=NaN,this.arrow_down.left=NaN,this.arrow_down.right=this.arrowPadding):(this.arrow_down.horizontalCenter=0,this.arrow_down.left=NaN,this.arrow_down.right=NaN)):t==e.UIDirection.TOP?(this.arrow_up.visible=!0,this.uiAlign==e.UIAlign.LEFT?(this.arrow_up.horizontalCenter=NaN,this.arrow_up.left=this.arrowPadding,this.arrow_up.right=NaN):this.uiAlign==e.UIAlign.RIGHT?(this.arrow_up.horizontalCenter=NaN,this.arrow_up.left=NaN,this.arrow_up.right=this.arrowPadding):(this.arrow_up.horizontalCenter=0,this.arrow_up.left=NaN,this.arrow_up.right=NaN)):t==e.UIDirection.RIGHT?(this.arrow_right.visible=!0,this.uiAlign==e.UIAlign.TOP?(this.arrow_right.verticalCenter=NaN,this.arrow_right.top=this.arrowPadding,this.arrow_right.bottom=NaN):this.uiAlign==e.UIAlign.BOTTOM?(this.arrow_right.verticalCenter=NaN,this.arrow_right.top=NaN,this.arrow_right.bottom=this.arrowPadding):(this.arrow_right.verticalCenter=0,this.arrow_right.top=NaN,this.arrow_right.bottom=NaN)):t==e.UIDirection.LEFT?(this.arrow_left.visible=!0,this.uiAlign==e.UIAlign.TOP?(this.arrow_left.verticalCenter=NaN,this.arrow_left.top=this.arrowPadding,this.arrow_left.bottom=NaN):this.uiAlign==e.UIAlign.BOTTOM?(this.arrow_left.verticalCenter=NaN,this.arrow_left.top=NaN,this.arrow_left.bottom=this.arrowPadding):(this.arrow_left.verticalCenter=0,this.arrow_left.top=NaN,this.arrow_left.bottom=NaN)):(this.arrow_down.visible=!0,this.uiAlign==e.UIAlign.LEFT?(this.arrow_down.horizontalCenter=NaN,this.arrow_down.left=this.arrowPadding,this.arrow_down.right=NaN):this.uiAlign==e.UIAlign.RIGHT?(this.arrow_down.horizontalCenter=NaN,this.arrow_down.left=NaN,this.arrow_down.right=this.arrowPadding):(this.arrow_down.horizontalCenter=0,this.arrow_down.left=NaN,this.arrow_down.right=NaN))},r.NAME="PopupMenu",r.defaultSkinName="",r.defaultBaseHeight=40,r}(e.Popup);e.PopupMenu=n,__reflect(n.prototype,"egretx.PopupMenu"),e.showPopupMenu=function(t,i){var r;if((r=Array.isArray(i)?n.toOptions(i):i).callback=new xgame.Signal1,r.textAlign)for(var o=0,a=r.items;o<a.length;o++)a[o].textAlign=r.textAlign;return xgame.that.getService(e.IUIManager).openPopup(n,t,r),r.callback}}(egretx||(egretx={})),function(e){var t;!function(e){e[e.FadeIn=1]="FadeIn",e[e.Stay=2]="Stay",e[e.FadeOut=3]="FadeOut"}(t=e.TipsState||(e.TipsState={}));var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.durationFadeIn=500,t.durationStay=1e3,t.durationFadeOut=500,t.durationPosition=500,t.time=0,t.index=0,t}return __extends(i,e),Object.defineProperty(i.prototype,"state",{get:function(){return this.$state},set:function(e){this.$state=e},enumerable:!0,configurable:!0}),i.prototype.release=function(){},i.prototype.dispose=function(){egret.Tween.removeTweens(this)},i.prototype.setMessage=function(e){this.time=this.durationStay,this.state=t.FadeIn,this.y=-this.height/2,this.alpha=0},i.prototype.doFadeIn=function(){var e=this;return new Promise(function(t){var i=e.alpha,n=Math.floor(e.durationFadeIn*(1-i));egret.Tween.get(e).to({alpha:1},n).call(function(){t()},e)})},i.prototype.doFadeOut=function(){var e=this;return new Promise(function(t){var i=e.alpha,n=Math.floor(e.durationFadeOut*i);egret.Tween.get(e).to({alpha:0},n).call(function(){t()},e)})},i.prototype.doStay=function(){var e=this;return new Promise(function(t){egret.Tween.get(e).to({time:0},e.time).call(function(){t()},e)})},i.prototype.playAnimation=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return egret.Tween.removeTweens(this),egret.Tween.get(this).to({y:-this.index*this.height-this.height/2},this.durationPosition),this.state!=t.FadeIn?[3,4]:[4,this.doFadeIn()];case 1:return e.sent(),this.state=t.Stay,[4,this.doStay()];case 2:return e.sent(),this.state=t.FadeOut,[4,this.doFadeOut()];case 3:return e.sent(),[3,9];case 4:return this.state!=t.Stay?[3,7]:[4,this.doStay()];case 5:return e.sent(),this.state=t.FadeOut,[4,this.doFadeOut()];case 6:return e.sent(),[3,9];case 7:return this.state!=t.FadeOut?[3,9]:[4,this.doFadeOut()];case 8:e.sent(),e.label=9;case 9:return[2]}})})},i}(eui.Component);e.TipsView=i,__reflect(i.prototype,"egretx.TipsView",["egretx.ITipsView","xgame.IPoolable","xgame.IDisposable","xgame.IXObject"]);var n=function(t){function n(){var e=t.call(this)||this;return e.pools=new xgame.PoolObject(i),e.parallelMax=5,e.waitQueues=[],e}return __extends(n,t),Object.defineProperty(n.prototype,"container",{get:function(){return this.$container},enumerable:!0,configurable:!0}),n.prototype.append=function(e){this.container.numChildren<this.parallelMax?this.play(e):this.waitQueues.push(e)},n.prototype.play=function(e){var t=this,i=this.pools.fetch(function(){return t.fetch()},this);this.container.addChildAt(i,0),i.setMessage(e);for(var n=function(e){var i=r.container.getChildAt(e);i.index=e,egret.Tween.removeTweens(i),i.playAnimation().then(function(){t.endView(i)})},r=this,o=0;o<this.container.numChildren;o++)n(o)},n.prototype.endView=function(e){if(e.parent&&this.container.removeChild(e),e.dispose(),this.pools.recycle(e),this.waitQueues.length>0&&this.container.numChildren<this.parallelMax){var t=this.waitQueues.shift();this.play(t)}},n.prototype.clear=function(){for(;this.container.numChildren;){var e=this.container.removeChildAt(0);e.dispose(),this.pools.recycle(e)}this.waitQueues.length=0},n.prototype.initialize=function(){this.$container=new eui.Group,this.$container.width=this.$container.height=1,this.$container.touchChildren=!1,this.$container.touchEnabled=!1,this.$container.touchThrough=!0,this.$container.horizontalCenter=0,this.$container.verticalCenter=0,xgame.that.getService(e.IUIManager).getLayerManager(e.UILayerID.Layer_11_Toast).addChild(this.$container)},n}(xgame.Singleton);e.TipsManager=n,__reflect(n.prototype,"egretx.TipsManager"),e.tips=function(e){n.Instance().append(e)}}(egretx||(egretx={})),function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.gap=10,t}return __extends(t,e),t}(xgame.XObject);e.UIOptions=t,__reflect(t.prototype,"egretx.UIOptions")}(egretx||(egretx={})),function(e){e.ISceneTransition=Symbol.for("ISceneTransition")}(egretx||(egretx={})),function(e){var t=function(t){function i(){var e=t.call(this)||this;return xgame.injectInstance(e),e}return __extends(i,t),i.prototype.start=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},__decorate([xgame.inject(e.IUIManager),__metadata("design:type",Object)],i.prototype,"uiManager",void 0),i=__decorate([xgame.impl(e.ISceneTransition),__metadata("design:paramtypes",[])],i)}(xgame.XObject);e.SceneTransition=t,__reflect(t.prototype,"egretx.SceneTransition",["egretx.ISceneTransition","xgame.IXObject"])}(egretx||(egretx={})),function(e){var t=function(t){function i(i,n,r){void 0===i&&(i=128),void 0===n&&(n=500),void 0===r&&(r=e.SceneMotion.RANDOM);var o=t.call(this)||this;return o.blockSize=i,o.duration=n,o.style=r,o}return __extends(i,t),i.prototype.start=function(t){var i=this;return new Promise(function(n,r){var o=i.uiManager.getLayerManager(e.UILayerID.Layer_3_SceneMask),a=i.uiManager.stage.stageWidth,s=i.uiManager.stage.stageHeight,c=new eui.Group;c.top=c.bottom=c.left=c.right=0,o.addChild(c);for(var h=i.blockSize,l=h,u=h,p=Math.ceil(a/l),g=Math.ceil(s/u),d=p*g,f=i.duration,m=0,y=0,v=0;v<d;v++){m=v%p,y=Math.floor(v/p);var _=v%p*l,I=Math.floor(v/p)*u,x=new egret.RenderTexture;x.drawToTexture(t,new egret.Rectangle(_,I,l,u));var b=e.BitmapPools.Instance().fetch();b.alpha=1,b.scaleX=b.scaleY=1,b.rotation=0,b.texture=x,b.anchorOffsetX=l/2,b.anchorOffsetY=u/2,b.x=_+l/2,b.y=I+u/2,c.addChild(b);var T=0;T=i.style==e.SceneMotion.TOP?10*v:i.style==e.SceneMotion.BOTTOM?10*(d-1-v):i.style==e.SceneMotion.LEFT?m*g*10+10*y:i.style==e.SceneMotion.RIGHT?(p-m)*g*10+10*y:i.style==e.SceneMotion.TOP_LEFT?m*y*10:i.style==e.SceneMotion.TOP_RIGHT?(p-m)*y*10:i.style==e.SceneMotion.BOTTOM_LEFT?m*(g-y)*10:i.style==e.SceneMotion.BOTTOM_RIGHT?(p-m)*(g-y)*10:Math.floor(300*Math.random()),egret.Tween.get(b).wait(T).to({alpha:0},f,egret.Ease.circIn).call(M,i,[b])}var C=0;function M(t){e.BitmapPools.Instance().recycle(t),++C==d&&(o.removeChild(c),n())}})},i}(e.SceneTransition);e.SceneFadeTransition=t,__reflect(t.prototype,"egretx.SceneFadeTransition")}(egretx||(egretx={})),function(e){var t=function(t){function i(e,i){void 0===e&&(e=8),void 0===i&&(i=500);var n=t.call(this)||this;return n.countBlocks=e,n.duration=i,n}return __extends(i,t),i.prototype.start=function(t){var i=this;return new Promise(function(n,r){var o=i.uiManager.getLayerManager(e.UILayerID.Layer_3_SceneMask),a=i.uiManager.stage.stageWidth,s=i.uiManager.stage.stageHeight,c=new eui.Group;c.top=c.bottom=c.left=c.right=0,o.addChild(c);for(var h=i.countBlocks,l=a/1,u=s/(h/1),p=i.duration,g=0;g<h;g++){var d=g%1*l,f=Math.floor(g/1)*u,m=new egret.RenderTexture;m.drawToTexture(t,new egret.Rectangle(d,f,l,u));var y=e.BitmapPools.Instance().fetch();y.alpha=1,y.scaleX=y.scaleY=1,y.rotation=0,y.texture=m,y.anchorOffsetX=l/2,y.anchorOffsetY=u/2,y.x=d+l/2,y.y=f+u/2,c.addChild(y),egret.Tween.get(y).to({scaleX:1,scaleY:.2,alpha:0},p,egret.Ease.circIn).call(_,i,[y])}var v=0;function _(t){e.BitmapPools.Instance().recycle(t),++v==h&&(o.removeChild(c),n())}})},i}(e.SceneTransition);e.SceneHShuttersTransition=t,__reflect(t.prototype,"egretx.SceneHShuttersTransition")}(egretx||(egretx={})),function(e){!function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT",e[e.RANDOM=4]="RANDOM",e[e.TOP_LEFT=5]="TOP_LEFT",e[e.TOP_RIGHT=6]="TOP_RIGHT",e[e.BOTTOM_LEFT=7]="BOTTOM_LEFT",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(e.SceneMotion||(e.SceneMotion={}))}(egretx||(egretx={})),function(e){var t=function(t){function i(i,n,r){void 0===i&&(i=128),void 0===n&&(n=500),void 0===r&&(r=e.SceneMotion.RANDOM);var o=t.call(this)||this;return o.blockSize=i,o.duration=n,o.style=r,o}return __extends(i,t),i.prototype.start=function(t){var i=this;return new Promise(function(n,r){var o=i.uiManager.getLayerManager(e.UILayerID.Layer_3_SceneMask),a=i.uiManager.stage.stageWidth,s=i.uiManager.stage.stageHeight,c=new eui.Group;c.top=c.bottom=c.left=c.right=0,o.addChild(c);for(var h=i.blockSize,l=h,u=h,p=Math.ceil(a/l),g=Math.ceil(s/u),d=p*g,f=i.duration,m=0,y=0,v=0;v<d;v++){m=v%p,y=Math.floor(v/p);var _=v%p*l,I=Math.floor(v/p)*u,x=new egret.RenderTexture;x.drawToTexture(t,new egret.Rectangle(_,I,l,u));var b=e.BitmapPools.Instance().fetch();b.alpha=1,b.scaleX=b.scaleY=1,b.rotation=0,b.texture=x,b.anchorOffsetX=l/2,b.anchorOffsetY=u/2,b.x=_+l/2,b.y=I+u/2,c.addChild(b);var T=0;T=i.style==e.SceneMotion.TOP?10*v:i.style==e.SceneMotion.BOTTOM?10*(d-1-v):i.style==e.SceneMotion.LEFT?m*g*10+10*y:i.style==e.SceneMotion.RIGHT?(p-m)*g*10+10*y:i.style==e.SceneMotion.TOP_LEFT?m*y*10:i.style==e.SceneMotion.TOP_RIGHT?(p-m)*y*10:i.style==e.SceneMotion.BOTTOM_LEFT?m*(g-y)*10:i.style==e.SceneMotion.BOTTOM_RIGHT?(p-m)*(g-y)*10:Math.floor(300*Math.random()),egret.Tween.get(b).wait(T).to({scaleX:0,scaleY:0,alpha:0,rotation:359},f,egret.Ease.circIn).call(M,i,[b])}var C=0;function M(t){e.BitmapPools.Instance().recycle(t),++C==d&&(o.removeChild(c),n())}})},i}(e.SceneTransition);e.SceneRotateTransition=t,__reflect(t.prototype,"egretx.SceneRotateTransition")}(egretx||(egretx={})),function(e){var t=function(t){function i(i,n,r){void 0===i&&(i=128),void 0===n&&(n=500),void 0===r&&(r=e.SceneMotion.RANDOM);var o=t.call(this)||this;return o.blockSize=i,o.duration=n,o.style=r,o}return __extends(i,t),i.prototype.start=function(t){var i=this;return new Promise(function(n,r){var o=i.uiManager.getLayerManager(e.UILayerID.Layer_3_SceneMask),a=i.uiManager.stage.stageWidth,s=i.uiManager.stage.stageHeight,c=new eui.Group;c.top=c.bottom=c.left=c.right=0,o.addChild(c);for(var h=i.blockSize,l=h,u=h,p=Math.ceil(a/l),g=Math.ceil(s/u),d=p*g,f=i.duration,m=0,y=0,v=0;v<d;v++){m=v%p,y=Math.floor(v/p);var _=v%p*l,I=Math.floor(v/p)*u,x=new egret.RenderTexture;x.drawToTexture(t,new egret.Rectangle(_,I,l,u));var b=e.BitmapPools.Instance().fetch();b.alpha=1,b.scaleX=b.scaleY=1,b.rotation=0,b.texture=x,b.anchorOffsetX=l/2,b.anchorOffsetY=u/2,b.x=_+l/2,b.y=I+u/2,c.addChild(b);var T=0;T=i.style==e.SceneMotion.TOP?10*v:i.style==e.SceneMotion.BOTTOM?10*(d-1-v):i.style==e.SceneMotion.LEFT?m*g*10+10*y:i.style==e.SceneMotion.RIGHT?(p-m)*g*10+10*y:i.style==e.SceneMotion.TOP_LEFT?m*y*10:i.style==e.SceneMotion.TOP_RIGHT?(p-m)*y*10:i.style==e.SceneMotion.BOTTOM_LEFT?m*(g-y)*10:i.style==e.SceneMotion.BOTTOM_RIGHT?(p-m)*(g-y)*10:Math.floor(300*Math.random()),egret.Tween.get(b).wait(T).to({scaleX:0,scaleY:0,alpha:0},f,egret.Ease.circIn).call(M,i,[b])}var C=0;function M(t){e.BitmapPools.Instance().recycle(t),++C==d&&(o.removeChild(c),n())}})},i}(e.SceneTransition);e.SceneScaleTransition=t,__reflect(t.prototype,"egretx.SceneScaleTransition")}(egretx||(egretx={})),function(e){var t=function(t){function i(e,i){void 0===e&&(e=8),void 0===i&&(i=500);var n=t.call(this)||this;return n.countBlocks=e,n.duration=i,n}return __extends(i,t),i.prototype.start=function(t){var i=this;return new Promise(function(n,r){var o=i.uiManager.getLayerManager(e.UILayerID.Layer_3_SceneMask),a=i.uiManager.stage.stageWidth,s=i.uiManager.stage.stageHeight,c=new eui.Group;c.top=c.bottom=c.left=c.right=0,o.addChild(c);for(var h=i.countBlocks,l=i.countBlocks,u=a/l,p=s/(h/l),g=i.duration,d=0;d<h;d++){var f=d%l*u,m=Math.floor(d/l)*p,y=new egret.RenderTexture;y.drawToTexture(t,new egret.Rectangle(f,m,u,p));var v=e.BitmapPools.Instance().fetch();v.alpha=1,v.scaleX=v.scaleY=1,v.rotation=0,v.texture=y,v.anchorOffsetX=u/2,v.anchorOffsetY=p/2,v.x=f+u/2,v.y=m+p/2,c.addChild(v),egret.Tween.get(v).to({scaleX:.2,scaleY:1,alpha:0},g,egret.Ease.circIn).call(I,i,[v])}var _=0;function I(t){t.$bitmapData.$dispose(),e.BitmapPools.Instance().recycle(t),++_==h&&(o.removeChild(c),n())}})},i}(e.SceneTransition);e.SceneVShuttersTransition=t,__reflect(t.prototype,"egretx.SceneVShuttersTransition")}(egretx||(egretx={})),function(e){var t=function(e){function t(t){void 0===t&&(t=500);var i=e.call(this)||this;return i.duration=t,i}return __extends(t,e),t.prototype.start=function(e,t){var i=this;return void 0===t&&(t=!1),new Promise(function(n,r){egret.Tween.removeTweens(e);var o=0,a=1,s=egret.Ease.cubicOut;t&&(o=1,a=0,s=egret.Ease.cubicIn),e.alpha=o,egret.Tween.get(e).to({alpha:a},i.duration,s).call(function(){n()})})},t}(xgame.XObject);e.UIFadeTransition=t,__reflect(t.prototype,"egretx.UIFadeTransition",["egretx.IUITransition","xgame.IXObject"])}(egretx||(egretx={})),function(e){var t=function(e){function t(t){void 0===t&&(t=300);var i=e.call(this)||this;return i.duration=t,i}return __extends(t,e),t.prototype.start=function(e,t){var i=this;return void 0===t&&(t=!1),new Promise(function(n,r){egret.Tween.removeTweens(e);var o=0,a=e.scaleX,s=egret.Ease.backOut;t&&(o=e.scaleX,a=0,s=egret.Ease.backIn),e.scaleX=e.scaleY=o,egret.Tween.get(e).to({scaleX:a,scaleY:a},i.duration,s).call(function(){n()})})},t}(xgame.XObject);e.UIScaleTransition=t,__reflect(t.prototype,"egretx.UIScaleTransition",["egretx.IUITransition","xgame.IXObject"])}(egretx||(egretx={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.release=function(){},t.prototype.dispose=function(){this.$bitmapData&&this.$bitmapData.$dispose(),this.removeSelf()},t.prototype.removeSelf=function(){this.parent&&this.parent.removeChild(this)},t=__decorate([xgame.impl(xgame.IPoolable)],t)}(egret.Bitmap);e.Bitmap=t,__reflect(t.prototype,"egretx.Bitmap",["xgame.IPoolable","xgame.IDisposable","xgame.IXObject"]);var i=function(e){function i(){var i=e.call(this)||this;return i.pools=new xgame.PoolObject(t),i}return __extends(i,e),i.prototype.fetch=function(){return this.pools.fetch(function(){return new t},this)},i.prototype.recycle=function(e){this.pools.recycle(e)},i}(xgame.Singleton);e.BitmapPools=i,__reflect(i.prototype,"egretx.BitmapPools")}(egretx||(egretx={})),function(e){var t=new egret.Rectangle,i=new egret.Rectangle,n=function(){function n(){}return n.placeTipsWithHUD=function(n,r,o){void 0===o&&(o=10);var a=xgame.that.getService(e.IUIManager).stage,s=n.uiDirection,c=n.uiAlign,h=a.stageWidth,l=a.stageHeight;n.getBounds(i,!0),r.getTransformedBounds(n.parent,t);var u=r.width*r.scaleX,p=r.height*r.scaleY,g=n.width,d=n.height,f=t.x,m=t.y,y=f+u,v=m+p;n.allowUIDirection(e.UIDirection.BOTTOM)&&(l-v-2*o>=d&&s==e.UIDirection.ANY||s==e.UIDirection.BOTTOM)?(n.y=v+o,c==e.UIAlign.LEFT?n.x=f:c==e.UIAlign.RIGHT?n.x=y-g:n.x=f+u/2-g/2,n.fixedUIDirection(e.UIDirection.BOTTOM)):n.allowUIDirection(e.UIDirection.TOP)&&(m-2*o>=d&&s==e.UIDirection.ANY||s==e.UIDirection.TOP)?(n.y=m-o-d,c==e.UIAlign.LEFT?n.x=f:c==e.UIAlign.RIGHT?n.x=y-g:n.x=f+u/2-g/2,n.fixedUIDirection(e.UIDirection.TOP)):n.allowUIDirection(e.UIDirection.RIGHT)&&(h-y-2*o>=g&&s==e.UIDirection.ANY||s==e.UIDirection.RIGHT)?(n.x=y+o,c==e.UIAlign.TOP?n.y=m:c==e.UIAlign.BOTTOM?n.y=m+p-d:n.y=m+p/2-d/2,n.fixedUIDirection(e.UIDirection.RIGHT)):n.allowUIDirection(e.UIDirection.LEFT)&&(f-2*o>=g&&s==e.UIDirection.ANY||s==e.UIDirection.LEFT)&&(n.x=f-o-g,c==e.UIAlign.TOP?n.y=m:c==e.UIAlign.BOTTOM?n.y=m+p-d:n.y=m+p/2-d/2,n.fixedUIDirection(e.UIDirection.LEFT)),n.x+=n.offset.x,n.y+=n.offset.y,n.visible=!0},n}();e.TipsHelper=n,__reflect(n.prototype,"egretx.TipsHelper")}(egretx||(egretx={}));