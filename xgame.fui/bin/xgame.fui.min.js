window.fui={};var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i};window.__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(o,a){function r(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(r,s)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,n,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(o=n[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],n=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},__decorate=this&&this.__decorate||function(e,t,i,n){var o,a=arguments.length,r=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(r=(a<3?o(r):a>3?o(t,i,r):o(t,i))||r);return a>3&&r&&Object.defineProperty(t,i,r),r},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){xgame.XGame.prototype.useFGUI=function(t){this.registerServiceProvider(new e.FGUIProvider(t))}}(fui||(fui={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.main=e,i.priority=100,i}return __extends(i,t),i.prototype.onInit=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,!0]})})},i.prototype.onStart=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.getService(e.ITouchManagerInternal).initialize(),t.getService(e.IUIManagerInternal).initialize(),[2,!0]})})},i.prototype.onServiceRegister=function(t){t.singleton(e.ITouchManager,e.TouchManager).withInstance(new e.TouchManager(this.main)).setAlias(e.ITouchManagerInternal),console.log("[FGUIProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.TouchManager))),t.singleton(e.IUIManager,e.UIManager).withInstance(new e.UIManager(this.main)).setAlias(e.IUIManagerInternal),console.log("[FGUIProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.UIManager)))},i}(xgame.XObject);e.FGUIProvider=t,__reflect(t.prototype,"fui.FGUIProvider",["xgame.IServiceProvider"])}(fui||(fui={})),function(e){e.event=xgame.event}(fui||(fui={})),function(e){function t(e,t,i){switch(i){case"1":return e.getController(t);case"2":return e.getTransition(t);default:return e.getChild(t)}}function i(e,i,n){var o=(i=i.replace(/\./g,"/")).split("/");if(o.length>1){for(var a=o.pop(),r=0;r<o.length;r++){var s=e.getChild(o[r]);if(!s||!s.asCom)return null;e=s.asCom}return t(e,a,n)}return t(e,i,n)}e.fairy_ui=function(e){return function(t,n){Object.defineProperty(t,n,{get:function(){var t=this.view.asCom;return e||(e=n),i(t,e,"0")}})}},e.fairy_controller=function(e){return function(t,n){Object.defineProperty(t,n,{get:function(){var t=this.view.asCom;return e||(e=n),i(t,e,"1")}})}},e.fairy_transition=function(e){return function(t,n){Object.defineProperty(t,n,{get:function(){var t=this.view.asCom;return e||(e=n),i(t,e,"2")}})}}}(fui||(fui={})),function(e){e.impl=xgame.impl}(fui||(fui={})),function(e){e.inject=xgame.inject}(fui||(fui={})),function(e){e.injectable=xgame.injectable}(fui||(fui={})),function(e){e.ITouchManager=Symbol.for("fui.ITouchManager")}(fui||(fui={})),function(e){e.ITouchManagerInternal=Symbol.for("fui.ITouchManagerInternal")}(fui||(fui={})),function(e){e.TOUCH_TAP_BETWEEN_TIME=300,e.TOUCH_LONG_PRESS_TIME=300,e.TOUCH_SCALE_RADIO=.96,e.touchClickLastTime=0;var t=function(t){function i(e){var i=t.call(this)||this;return i.main=e,i.delegates=new xgame.Dictionary,i.stage=e.stage,i}return __extends(i,t),i.prototype.dispose=function(){this.delegates.clear(function(e){e.dispose()}),e.touchClickLastTime=0},i.prototype.initialize=function(){this.stage.addEventListener(egret.TouchEvent.LEAVE_STAGE,this.onLeaveStage,this)},i.prototype.onLeaveStage=function(e){this.delegates.forValues(function(t){t.onLeaveStage(e)},this)},i.prototype.removeTouchEvents=function(e){var t=0;(t="number"==typeof e?e:e.hashCode,this.delegates.containsKey(t))&&this.delegates.remove(t).dispose()},i.prototype.addTouchBegin=function(t,i,n){var o=t.hashCode;this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).addTouchBegin(i,n)},i.prototype.removeTouchBegin=function(t,i,n){var o=t.hashCode;this.delegates.containsKey(o)&&this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).removeTouchBegin(i,n)},i.prototype.addTouchMove=function(t,i,n){var o=t.hashCode;this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).addTouchMove(i,n)},i.prototype.removeTouchMove=function(t,i,n){var o=t.hashCode;this.delegates.containsKey(o)&&this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).removeTouchMove(i,n)},i.prototype.addTouchEnd=function(t,i,n){var o=t.hashCode;this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).addTouchEnd(i,n)},i.prototype.removeTouchEnd=function(t,i,n){var o=t.hashCode;this.delegates.containsKey(o)&&this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).removeTouchEnd(i,n)},i.prototype.addReleaseOutSide=function(t,i,n){var o=t.hashCode;this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).addReleaseOutSide(i,n)},i.prototype.removeReleaseOutSide=function(t,i,n){var o=t.hashCode;this.delegates.containsKey(o)&&this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).removeReleaseOutSide(i,n)},i.prototype.addClick=function(t,i,n){var o=t.hashCode;this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).addClick(i,n)},i.prototype.removeClick=function(t,i,n){var o=t.hashCode;this.delegates.containsKey(o)&&this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).removeClick(i,n)},i.prototype.addLongPress=function(t,i,n,o){var a=t.hashCode;this.delegates.allocf(a,function(){return new e.TouchDelegate(t)}).addLongPress(i,n,o)},i.prototype.removeLongPress=function(t,i,n){var o=t.hashCode;this.delegates.containsKey(o)&&this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).removeLongPress(i,n)},i.prototype.addRepeatPress=function(t,i,n,o){var a=t.hashCode;this.delegates.allocf(a,function(){return new e.TouchDelegate(t)}).addRepeatPress(i,n,o)},i.prototype.removeRepeatPress=function(t,i,n){var o=t.hashCode;this.delegates.containsKey(o)&&this.delegates.allocf(o,function(){return new e.TouchDelegate(t)}).removeRepeatPress(i,n)},i=__decorate([xgame.impl(xgame.IDisposable,e.ITouchManager,e.ITouchManagerInternal),__metadata("design:paramtypes",[egret.DisplayObjectContainer])],i)}(xgame.XObject);e.TouchManager=t,__reflect(t.prototype,"fui.TouchManager",["xgame.IDisposable","xgame.IXObject","fui.ITouchManager","fui.ITouchManagerInternal"])}(fui||(fui={})),function(e){var t=function(){function t(){}return t.prototype.setTouchManager=function(t){this.disposableGroup||(this.disposableGroup=new e.TouchDisposableGroup(t))},t.prototype.addTouchBegin=function(e,t,i){this.disposableGroup.addTouchBegin(e,t,i)},t.prototype.removeTouchBegin=function(e,t,i){this.disposableGroup.removeTouchBegin(e,t,i)},t.prototype.addTouchMove=function(e,t,i){this.disposableGroup.addTouchMove(e,t,i)},t.prototype.removeTouchMove=function(e,t,i){this.disposableGroup.removeTouchMove(e,t,i)},t.prototype.addTouchEnd=function(e,t,i){this.disposableGroup.addTouchEnd(e,t,i)},t.prototype.removeTouchEnd=function(e,t,i){this.disposableGroup.removeTouchEnd(e,t,i)},t.prototype.addReleaseOutSide=function(e,t,i){this.disposableGroup.addReleaseOutSide(e,t,i)},t.prototype.removeReleaseOutSide=function(e,t,i){this.disposableGroup.removeReleaseOutSide(e,t,i)},t.prototype.addClick=function(e,t,i){this.disposableGroup.addClick(e,t,i)},t.prototype.removeClick=function(e,t,i){this.disposableGroup.removeClick(e,t,i)},t.prototype.addLongPress=function(e,t,i,n){this.disposableGroup.addLongPress(e,t,i,n)},t.prototype.removeLongPress=function(e,t,i){this.disposableGroup.removeLongPress(e,t,i)},t.prototype.addRepeatPress=function(e,t,i,n){this.disposableGroup.addRepeatPress(e,t,i,n)},t.prototype.removeRepeatPress=function(e,t,i){this.disposableGroup.removeRepeatPress(e,t,i)},t}();e.TouchBehaviours=t,__reflect(t.prototype,"fui.TouchBehaviours")}(fui||(fui={})),function(e){var t=function(t){function i(i){var n=t.call(this)||this;return n.longPressTimeDelta=e.TOUCH_LONG_PRESS_TIME,n.repeatPressTimeDelta=e.TOUCH_LONG_PRESS_TIME,n.repeat_timer_id=0,n.target=i,n.initTouchEvents(),n}return __extends(i,t),i.prototype.onLeaveStage=function(e){this.onTouchEnd(e)},i.prototype.addTouchBegin=function(e,t){this.beginHandler.listeners.add(e,t)},i.prototype.removeTouchBegin=function(e,t){this.beginHandler.listeners.remove(e)},i.prototype.addTouchMove=function(e,t){this.moveHandler.listeners.add(e,t)},i.prototype.removeTouchMove=function(e,t){this.moveHandler.listeners.remove(e)},i.prototype.addTouchEnd=function(e,t){this.endHandler.listeners.add(e,t)},i.prototype.removeTouchEnd=function(e,t){this.endHandler.listeners.remove(e)},i.prototype.addReleaseOutSide=function(e,t){this.releaseOutsideHandler.listeners.add(e,t)},i.prototype.removeReleaseOutSide=function(e,t){this.releaseOutsideHandler.listeners.remove(e)},i.prototype.addClick=function(e,t){this.clickHandler.listeners.add(e,t)},i.prototype.removeClick=function(e,t){this.clickHandler.listeners.remove(e)},i.prototype.addLongPress=function(e,t,i){void 0===i&&(i=300),this.longPressTimeDelta=i,this.longPressHandler.listeners.add(e,t)},i.prototype.removeLongPress=function(e,t){this.longPressHandler.listeners.remove(e)},i.prototype.addRepeatPress=function(e,t,i){void 0===i&&(i=300),this.repeatPressTimeDelta=i,this.repeatPressHandler.listeners.add(e,t)},i.prototype.removeRepeatPress=function(e,t){this.repeatPressHandler.listeners.remove(e)},i.prototype.initTouchEvents=function(){this.inited=!0,this.clickHandler={listeners:new xgame.Signal1,happend:!1},this.longPressHandler={listeners:new xgame.Signal1,happend:!1},this.repeatPressHandler={listeners:new xgame.Signal1,happend:!1},this.releaseOutsideHandler={listeners:new xgame.Signal1,happend:!1},this.beginHandler={listeners:new xgame.Signal1,happend:!1},this.moveHandler={listeners:new xgame.Signal1,happend:!1},this.endHandler={listeners:new xgame.Signal1,happend:!1},this.target.displayObject.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.target.displayObject.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.target.displayObject.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.target.displayObject.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)},i.prototype.setRepeatTimer=function(){var e=this;this.clearRepeatTimer(),this.repeat_timer_id=egret.setInterval(function(){e.repeatPressHandler.happend=!0,e.repeatPressHandler.listeners.dispatch(null)},this,this.repeatPressTimeDelta)},i.prototype.clearRepeatTimer=function(){this.repeat_timer_id&&egret.clearInterval(this.repeat_timer_id),this.repeat_timer_id=0},i.prototype.onTouchBegin=function(e){this.beginHandler.happend=!0,this.beginHandler.time=egret.getTimer(),this.beginHandler.identifier=e.touchPointID,this.beginHandler.listeners.dispatch(e),this.repeatPressHandler.listeners.numListeners&&this.setRepeatTimer()},i.prototype.onTouchMove=function(e){this.beginHandler.happend&&this.moveHandler.listeners.dispatch(e)},i.prototype.onTouchEnd=function(t){if(this.beginHandler.happend){if(t.type==egret.TouchEvent.TOUCH_RELEASE_OUTSIDE)this.releaseOutsideHandler.listeners.dispatch(t);else{this.endHandler.listeners.dispatch(t);var i=egret.getTimer();!this.repeatPressHandler.happend&&this.longPressHandler.listeners.numListeners&&i-this.beginHandler.time>=this.longPressTimeDelta&&(this.longPressHandler.happend=!0,this.longPressHandler.listeners.dispatch(t)),this.longPressHandler.happend||this.repeatPressHandler.happend||i-e.touchClickLastTime>e.TOUCH_TAP_BETWEEN_TIME&&(e.touchClickLastTime=i,this.clickHandler.listeners.dispatch(t))}this.clearRepeatTimer(),this.beginHandler.happend=!1,this.endHandler.happend=!1,this.moveHandler.happend=!1,this.releaseOutsideHandler.happend=!1,this.longPressHandler.happend=!1,this.repeatPressHandler.happend=!1}},i.prototype.dispose=function(){this.target&&(this.target.displayObject.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.target.displayObject.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.target.displayObject.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.target.displayObject.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this)),this.clickHandler.listeners.removeAll(),this.clickHandler.happend=!1,this.longPressHandler.listeners.removeAll(),this.longPressHandler.happend=!1,this.repeatPressHandler.listeners.removeAll(),this.repeatPressHandler.happend=!1,this.releaseOutsideHandler.listeners.removeAll(),this.releaseOutsideHandler.happend=!1,this.beginHandler.listeners.removeAll(),this.beginHandler.happend=!1,this.moveHandler.listeners.removeAll(),this.moveHandler.happend=!1,this.endHandler.listeners.removeAll(),this.endHandler.happend=!1,this.target=void 0,this.inited=!1},i}(xgame.XObject);e.TouchDelegate=t,__reflect(t.prototype,"fui.TouchDelegate",["xgame.IDisposable","xgame.IXObject"])}(fui||(fui={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.displayObject=e,i.touches=new xgame.List,xgame.injectInstance(i),i.displayObject&&i.displayObject.displayObject&&i.displayObject.displayObject.addEventListener(egret.Event.REMOVED_FROM_STAGE,i.onRemovedFromStage,i),i}return __extends(i,t),i.prototype.onRemovedFromStage=function(){this.dispose()},i.prototype.dispose=function(){var e=this;this.touches.forEach(function(t){e.manager.removeTouchEvents(t)}),this.touches.clear(),this.displayObject&&this.displayObject.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemovedFromStage,this),this.manager=void 0,this.displayObject=void 0},i.prototype.addTouchBegin=function(e,t,i){this.manager.addTouchBegin(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeTouchBegin=function(e,t,i){this.manager.removeTouchBegin(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addTouchMove=function(e,t,i){this.manager.addTouchMove(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeTouchMove=function(e,t,i){this.manager.removeTouchMove(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addTouchEnd=function(e,t,i){this.manager.addTouchEnd(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeTouchEnd=function(e,t,i){this.manager.removeTouchEnd(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addReleaseOutSide=function(e,t,i){this.manager.addReleaseOutSide(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeReleaseOutSide=function(e,t,i){this.manager.removeReleaseOutSide(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addClick=function(e,t,i){this.manager.addClick(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeClick=function(e,t,i){this.manager.removeClick(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addLongPress=function(e,t,i,n){this.manager.addLongPress(e,t,i,n),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeLongPress=function(e,t,i){this.manager.removeLongPress(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.addRepeatPress=function(e,t,i,n){this.manager.addRepeatPress(e,t,i,n),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},i.prototype.removeRepeatPress=function(e,t,i){this.manager.removeRepeatPress(e,t,i),this.touches.contains(e.hashCode)||this.touches.add(e.hashCode)},__decorate([xgame.inject(e.ITouchManager),__metadata("design:type",e.TouchManager)],i.prototype,"manager",void 0),i}(xgame.XObject);e.TouchDisposableGroup=t,__reflect(t.prototype,"fui.TouchDisposableGroup",["xgame.IDisposable","xgame.IXObject"])}(fui||(fui={})),function(e){e.IUIManager=Symbol.for("fgui.IUIManager")}(fui||(fui={})),function(e){e.IUIManagerInternal=Symbol.for("fgui.IUIManagerInternal")}(fui||(fui={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.main=e,i.pipelines=[],i.uiMap=new xgame.Dictionary,i.uiLayers=new xgame.Dictionary,i.root=fairygui.GRoot.inst,i.onSceneChanged=new xgame.Signal2,i.onUIOpened=new xgame.Signal1,i.onUIClosed=new xgame.Signal1,i.uiPackages=new xgame.Dictionary,i.stage=e.stage,i}return __extends(i,t),Object.defineProperty(i.prototype,"entityManager",{get:function(){return this.$entityManager},enumerable:!0,configurable:!0}),i.prototype.initialize=function(){this.$entityManager=new e.UIEntityManager(this),this.pipelines.push(this.checkIsOpened.bind(this)),this.pipelines.push(this.createUIPage.bind(this)),this.pipelines.push(this.openUIPage.bind(this)),this.root.displayObject.name="FUIRoot",this.main.addChild(this.root.displayObject);for(var t=e.UILayerID.Layer_0_Bottom;t<=e.UILayerID.Layer_15_Top;t++){var i=new e.UILayerManager(this,t);this.root.addChildAt(i,t),i.addRelation(this.root,fairygui.RelationType.Width),i.addRelation(this.root,fairygui.RelationType.Height),this.uiLayers.add(t,i)}this.register(e.Alert.NAME,e.Alert),this.register(e.PopupMenu.NAME,e.PopupMenu),e.TipsManager.Instance().initialize()},i.prototype.getLayerManager=function(e){return this.uiLayers.get(e)},i.prototype.register=function(e,t){this.uiMap.add(e,t)},i.prototype.popUI=function(){return!1},i.prototype.clearScene=function(){this.currentScene&&(this._closeUI(this.$currentScene),this.$currentScene=void 0)},i.prototype.closeUI=function(e){if("string"==typeof e){var t=e,i=[];if(this.$entityManager.tryGetEntities(t,i))for(var n=0,o=i;n<o.length;n++){var a=o[n];this._closeUI(a)}}else this._closeUI(e)},i.prototype._closeUI=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return e.isClosed?[2]:(this.uiLayers.get(e.uiPage.layerID).removeEntity(e),this.$entityManager.removeEntity(e),[4,(t=e.uiPage).doFadeOut()]);case 1:return i.sent(),t.view.parent&&e.uiPage.view.parent.removeChild(e.uiPage.view),e.mask&&e.mask.parent&&e.mask.parent.removeChild(e.mask),this.onUIClosed.dispatch(e),this.$entityManager.checkEntities(),e.onClose(),e.dispose(),e=void 0,[2]}})})},Object.defineProperty(i.prototype,"currentScene",{get:function(){return this.$currentScene},enumerable:!0,configurable:!0}),i.prototype.replaceScene=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,o,a;return __generator(this,function(r){switch(r.label){case 0:if(a=new e.UIOptions,"string"==typeof t){if(n=t,!this.uiMap.containsKey(n))throw new Error("此UI没有注册:{0}".format(n));o=this.uiMap.get(n)}else o=t;return a.uiClass=o,a.openArgs=i,a.name=xgame.getQualifiedClassName(o),this.currentScene&&this.$currentScene.onSceneChanging(),[4,this.startPipelines(a)];case 1:return[2,r.sent()]}})})},i.prototype.openUI=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,o,a;return __generator(this,function(r){switch(r.label){case 0:if(a=new e.UIOptions,"string"==typeof t){if(n=t,!this.uiMap.containsKey(n))throw new Error("此UI没有注册:{0}".format(n));o=this.uiMap.get(n)}else o=t;return a.uiClass=o,a.openArgs=i,a.name=xgame.getQualifiedClassName(o),[4,this.startPipelines(a)];case 1:return[2,r.sent()]}})})},i.prototype.openUIWithLayer=function(t,i){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return __awaiter(this,void 0,void 0,function(){var o,a,r;return __generator(this,function(s){switch(s.label){case 0:if(r=new e.UIOptions,"string"==typeof t){if(o=t,!this.uiMap.containsKey(o))throw new Error("此UI没有注册:{0}".format(o));a=this.uiMap.get(o)}else a=t;return r.uiClass=a,r.layerID=i,r.openArgs=n,r.name=xgame.getQualifiedClassName(a),[4,this.startPipelines(r)];case 1:return[2,s.sent()]}})})},i.prototype.openUIWithRoot=function(t,i){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return __awaiter(this,void 0,void 0,function(){var o,a,r;return __generator(this,function(s){switch(s.label){case 0:if(r=new e.UIOptions,"string"==typeof t){if(o=t,!this.uiMap.containsKey(o))throw new Error("此UI没有注册:{0}".format(o));a=this.uiMap.get(o)}else a=t;return r.uiClass=a,r.uiRoot=i,r.openArgs=n,r.name=xgame.getQualifiedClassName(a),[4,this.startPipelines(r)];case 1:return[2,s.sent()]}})})},i.prototype.openPopup=function(t,i){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return __awaiter(this,void 0,void 0,function(){var o,a,r;return __generator(this,function(s){switch(s.label){case 0:if(r=new e.UIOptions,"string"==typeof t){if(o=t,!this.uiMap.containsKey(o))throw new Error("此UI没有注册:{0}".format(o));a=this.uiMap.get(o)}else a=t;return r.uiClass=a,r.hud=i,r.openArgs=n,r.name=xgame.getQualifiedClassName(a),[4,this.startPipelines(r)];case 1:return[2,s.sent()]}})})},i.prototype.startPipelines=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(n){switch(n.label){case 0:t=0,i=this.pipelines,n.label=1;case 1:return t<i.length?[4,(0,i[t])(e)]:[3,4];case 2:if(!n.sent())return e.errorMessage&&console.error(e.errorMessage),[2,null];n.label=3;case 3:return t++,[3,1];case 4:return[2,e.entity]}})})},i.prototype.checkIsOpened=function(t){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(o){return i=[],this.$entityManager.tryGetEntities(t.uiClass,i)&&((n=i[0]).uiPage.flags&e.UIFlags.allowMultiple||(t.entity=n)),[2,!0]})})},i.prototype.createUIPage=function(t){return __awaiter(this,void 0,void 0,function(){var i,n,o,a,r,s=this;return __generator(this,function(u){switch(u.label){case 0:return(i=t.entity)?[3,3]:((i=new e.UIEntity).uiManager=this,i.name=t.name,t.entity=i,n=new((r=t.uiClass).bind.apply(r,[void 0].concat(t.openArgs))),xgame.injectInstance(n),n.entity=i,i.uiPage=n,this.$entityManager.addEntity(i),n.onInit(),[4,n.load()]);case 1:return u.sent(),n.view.visible=!1,n.view.displayObject.name=t.name,t.hud&&n.renderWatcher.onChanged().add(function(){egret.callLater(function(){e.TipsHelper.placeTipsWithHUD(n,t.hud,t.gap)},s)},this),t.uiRoot?t.uiRoot.addChild(n.view):(t.layerID&&n.setLayerID(t.layerID),a=this.uiLayers.get(n.layerID),n.flags&e.UIFlags.useMask&&(i.createMask(n.maskColor,n.maskAlpha,n.flags&e.UIFlags.closeByMask),i.mask.addRelation(a,fairygui.RelationType.Size),a.addChild(i.mask)),t.hud||n.flags&e.UIFlags.isPlugin||n.flags&e.UIFlags.isPopupMenu||(n.flags&e.UIFlags.isWindow?(n.view.x=this.stage.stageWidth-n.view.width>>1,n.view.y=this.stage.stageHeight-n.view.height>>1,n.view.addRelation(a,fairygui.RelationType.Center_Center)):(n.view.makeFullScreen(),n.view.addRelation(a,fairygui.RelationType.Size))),a.addEntity(i),a.addChild(n.view)),n.onOpen(),[4,xgame.waitEndFrames()];case 2:return u.sent(),t.hud||(n.view.visible=!0),[3,4];case 3:o=i.uiPage,null!=t.layerID&&t.layerID!=o.layerID?((a=this.uiLayers.get(o.layerID)).removeEntity(i),i.mask&&i.mask.parent&&i.mask.parent.removeChild(i.mask),i.uiPage&&i.uiPage.view.parent&&i.uiPage.view.parent.removeChild(i.uiPage.view),(a=this.uiLayers.get(t.layerID)).addEntity(i),i.mask&&a.addChild(i.mask),i.uiPage&&(i.uiPage.setLayerID(t.layerID),a.addChild(i.uiPage.view))):(a=this.uiLayers.get(o.layerID)).orderToFront(i),u.label=4;case 4:return this.$entityManager.checkEntities(),[2,!0]}})})},i.prototype.openUIPage=function(t){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(o){switch(o.label){case 0:return(i=t.entity)?(n=i.uiPage).isLoaded?n.flags&e.UIFlags.isScene?this.currentScene?(this.onSceneChanged.dispatch(i,this.currentScene),[4,this._closeUI(this.$currentScene)]):[3,2]:[3,3]:(t.errorMessage="UIPage:{0}还没有加载完成".format(t.name),[2,!1]):(t.errorMessage="UIEntity:{0}不能为空".format(t.name),[2,!1]);case 1:o.sent(),o.label=2;case 2:this.$currentScene=i,o.label=3;case 3:return[4,n.doFadeIn()];case 4:return o.sent(),this.onUIOpened.dispatch(i),[2,!0]}})})},i.prototype.loadPackage=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return this.uiPackages.containsKey(e)?[2]:[4,fairygui.UIPackage.loadPackage(e)];case 1:return t=i.sent(),this.uiPackages.set(e,t),[2]}})})},i.prototype.createObject=function(e,t,i){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:return(n=this.uiPackages.get(e))?[3,2]:[4,this.loadPackage(e)];case 1:o.sent(),n=this.uiPackages.get(e),o.label=2;case 2:return[2,n.createObject(t,i)]}})})},i=__decorate([e.impl(e.IUIManager,e.IUIManagerInternal),__metadata("design:paramtypes",[egret.DisplayObjectContainer])],i)}(xgame.XObject);e.UIManager=t,__reflect(t.prototype,"fui.UIManager",["fui.IUIManager","xgame.IXObject","fui.IUIManagerInternal"])}(fui||(fui={})),function(e){!function(e){e[e.CENTER=0]="CENTER",e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT"}(e.UIAlign||(e.UIAlign={}))}(fui||(fui={})),function(e){!function(e){e[e.ANY=0]="ANY",e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT"}(e.UIDirection||(e.UIDirection={}))}(fui||(fui={})),function(e){var t=function(t){function i(i,n,o){var a=t.call(this)||this;return a.packageName=i,a.comName=n,a.userClass=o,a.flags=e.UIFlags.isStack|e.UIFlags.isFullScreen,a.guideValues=new xgame.Dictionary,a.onComplete=new xgame.Signal0,a.$isLoaded=!1,a.$isLoading=!1,a.deferred=new xgame.Deferred,a.$maskAlpha=.3,a.$maskColor=3355443,a.$layerID=e.UILayerID.Layer_5_UI,a}return __extends(i,t),Object.defineProperty(i.prototype,"view",{get:function(){return this.$view},enumerable:!0,configurable:!0}),i.prototype.injectGuideValue=function(e,t,i){this.guideManager.injectValue(e,t,i),this.guideValues.add(e,i||0)},Object.defineProperty(i.prototype,"isLoaded",{get:function(){return this.$isLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isLoading",{get:function(){return this.$isLoading},enumerable:!0,configurable:!0}),i.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.$isLoading=!0,!this.packageName||this.isLoaded?[3,5]:[4,this.uiManager.loadPackage(this.packageName)];case 1:return t.sent(),this.comName?(e=this,[4,this.uiManager.createObject(this.packageName,this.comName,this.userClass)]):[3,3];case 2:return e.$view=t.sent(),this.doComplete(),[3,4];case 3:this.doComplete(),t.label=4;case 4:return[3,6];case 5:this.doComplete(),t.label=6;case 6:return[2,this.deferred.promise]}})})},i.prototype.doComplete=function(){var e=this;this.$view||(this.$view=new fairygui.GComponent),this.setTouchManager(this.view),egret.callLater(function(){e.$isLoaded=!0,e.onComplete.dispatch(),e.deferred.resolve()},this)},Object.defineProperty(i.prototype,"maskAlpha",{get:function(){return this.$maskAlpha},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maskColor",{get:function(){return this.$maskColor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerID",{get:function(){return this.$layerID},enumerable:!0,configurable:!0}),i.prototype.setLayerID=function(e){this.$layerID=e},i.prototype.onInit=function(){this.addEventObserves&&this.addEventObserves()},i.prototype.onOpen=function(){},i.prototype.onSceneChanging=function(){},i.prototype.onClose=function(){var e=this;this.guideValues.length&&(this.guideValues.forKeys(function(t){var i=e.guideValues.get(t);e.guideManager.removeValue(t,i)},this),this.guideValues.clear());this.removeEventObserves&&this.removeEventObserves(),this.entity=void 0},i.prototype.onShow=function(){},i.prototype.onHide=function(){},i.prototype.close=function(){this.entity&&this.entity.closePage()},i.prototype.doFadeIn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},i.prototype.doFadeOut=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},__decorate([e.inject(e.IUIManager),__metadata("design:type",Object)],i.prototype,"uiManager",void 0),__decorate([e.inject(egretx.IGuideManager),__metadata("design:type",Object)],i.prototype,"guideManager",void 0),i=__decorate([xgame.mixin(e.TouchBehaviours),__metadata("design:paramtypes",[String,String,Object])],i)}(xgame.XObject);e.UIPage=t,__reflect(t.prototype,"fui.UIPage")}(fui||(fui={})),function(e){!function(e){e[e.None=0]="None",e[e.useMask=1]="useMask",e[e.isStack=2]="isStack",e[e.isFullScreen=4]="isFullScreen",e[e.allowMultiple=8]="allowMultiple",e[e.closeByMask=16]="closeByMask",e[e.isPopupMenu=32]="isPopupMenu",e[e.isPlugin=64]="isPlugin",e[e.isScene=128]="isScene",e[e.isWindow=256]="isWindow"}(e.UIFlags||(e.UIFlags={}))}(fui||(fui={})),function(e){var t=function(t){function i(i,n,o){var a=t.call(this,i,n,o)||this;return a.flags=e.UIFlags.isPlugin,a}return __extends(i,t),i}(e.UIPage);e.PluginPage=t,__reflect(t.prototype,"fui.PluginPage")}(fui||(fui={})),function(e){var t=function(t){function i(i,n,o){var a=t.call(this,i,n,o)||this;return a.flags=e.UIFlags.isStack|e.UIFlags.isWindow|e.UIFlags.useMask|e.UIFlags.closeByMask,a.setLayerID(e.UILayerID.Layer_8_Window),a}return __extends(i,t),i}(e.UIPage);e.Window=t,__reflect(t.prototype,"fui.Window")}(fui||(fui={})),function(e){!function(e){e[e.Layer_0_Bottom=0]="Layer_0_Bottom",e[e.Layer_1=1]="Layer_1",e[e.Layer_2_Scene=2]="Layer_2_Scene",e[e.Layer_3_SceneMask=3]="Layer_3_SceneMask",e[e.Layer_4_SceneFrame=4]="Layer_4_SceneFrame",e[e.Layer_5_UI=5]="Layer_5_UI",e[e.Layer_6_UIMask=6]="Layer_6_UIMask",e[e.Layer_7_UIFrame=7]="Layer_7_UIFrame",e[e.Layer_8_Window=8]="Layer_8_Window",e[e.Layer_9=9]="Layer_9",e[e.Layer_10_Popup=10]="Layer_10_Popup",e[e.Layer_11_Guide=11]="Layer_11_Guide",e[e.Layer_12_Toast=12]="Layer_12_Toast",e[e.Layer_13_Loading=13]="Layer_13_Loading",e[e.Layer_14=14]="Layer_14",e[e.Layer_15_Top=15]="Layer_15_Top"}(e.UILayerID||(e.UILayerID={}))}(fui||(fui={})),function(e){var t=function(e){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=e.call(this)||this;n.views=new xgame.Dictionary,n.callback_onChanged=new xgame.Signal0,n.isDispatching=!1;for(var o=0,a=t;o<a.length;o++){var r=a[o];n.addWatcher(r)}return n}return __extends(t,e),t.prototype.addWatcher=function(e){this.views.containsKey(e.hashCode)||(this.views.add(e.hashCode,e),e.addEventListener(fairygui.GObject.SIZE_CHANGED,this.onWatcher,this),this.onWatcher())},t.prototype.removeWatcher=function(e){this.views.containsKey(e.hashCode)&&(e.removeEventListener(fairygui.GObject.SIZE_CHANGED,this.onWatcher,this),this.views.remove(e.hashCode))},t.prototype.onWatcher=function(){this.lateDispatch()},t.prototype.lateDispatch=function(){var e=this;this.isDispatching||(this.isDispatching=!0,egret.callLater(function(){e.callback_onChanged.dispatch(),e.isDispatching=!1},this))},t.prototype.onChanged=function(){return this.callback_onChanged},t.prototype.dispose=function(){var e=this;this.callback_onChanged.removeAll(),this.views.clear(function(t){t.removeEventListener(fairygui.GObject.SIZE_CHANGED,e.onWatcher,e)})},t}(xgame.XObject);e.RenderWatcher=t,__reflect(t.prototype,"fui.RenderWatcher");var i=function(i){function n(n,o,a){var r=i.call(this,n,o,a)||this;return r.renderWatcher=new t,r.offset=new egret.Point,r.$uiDirection=e.UIDirection.ANY,r.$uiAlign=e.UIAlign.CENTER,r.flags=e.UIFlags.isStack|e.UIFlags.isPopupMenu|e.UIFlags.useMask|e.UIFlags.closeByMask|e.UIFlags.allowMultiple,r.setLayerID(e.UILayerID.Layer_10_Popup),r.$maskAlpha=0,r}return __extends(n,i),Object.defineProperty(n.prototype,"uiDirection",{get:function(){return this.$uiDirection},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"uiAlign",{get:function(){return this.$uiAlign},enumerable:!0,configurable:!0}),n.prototype.allowUIDirection=function(e){return!this.allowDirections||!this.allowDirections.length||this.allowDirections.indexOf(e)>=0},n.prototype.fixedUIDirection=function(e){},n.prototype.onOpen=function(){this.renderWatcher.addWatcher(this.view),i.prototype.onOpen.call(this)},n.prototype.onClose=function(){this.renderWatcher&&this.renderWatcher.dispose(),i.prototype.onClose.call(this)},n}(e.UIPage);e.Popup=i,__reflect(i.prototype,"fui.Popup")}(fui||(fui={})),function(e){var t=function(t){function i(i,n,o){var a=t.call(this,i,n,o)||this;return a.flags=e.UIFlags.isScene|e.UIFlags.isFullScreen,a.setLayerID(e.UILayerID.Layer_2_Scene),a}return __extends(i,t),i}(e.UIPage);e.Scene=t,__reflect(t.prototype,"fui.Scene")}(fui||(fui={})),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"isClosed",{get:function(){return this.$isClosed},enumerable:!0,configurable:!0}),t.prototype.createMask=function(e,t,i){this.mask||(this.mask=new fairygui.GGraph,this.mask.drawRect(0,0,0,0,t),this.mask.makeFullScreen(),i&&this.mask.addClickListener(this.onMaskClose,this))},t.prototype.onMaskClose=function(){this.mask.removeClickListener(this.onMaskClose,this),this.closePage()},t.prototype.onSceneChanging=function(){this.uiPage&&this.uiPage.onSceneChanging()},t.prototype.onClose=function(){this.$isClosed=!0,this.uiPage&&this.uiPage.onClose()},t.prototype.closePage=function(){this.uiManager&&this.uiManager.closeUI(this)},t.prototype.showPage=function(){this.uiPage&&this.uiPage.view&&(this.uiPage.view.visible=!0)},t.prototype.hidePage=function(){this.uiPage&&this.uiPage.view&&(this.uiPage.view.visible=!1)},t.prototype.dispose=function(){this.mask&&this.mask.removeClickListener(this.onMaskClose,this),this.uiPage=void 0,this.mask=void 0},t}(xgame.XObject);e.UIEntity=t,__reflect(t.prototype,"fui.UIEntity",["fui.IUIEntity","xgame.IDisposable","xgame.IXObject"])}(fui||(fui={})),function(e){var t=function(){function t(){}return t.isFullScreenUI=function(t){var i=t.uiPage.flags;return!!(i&e.UIFlags.isStack)&&!!(i&e.UIFlags.isFullScreen)},t.isWindowUI=function(i){var n=i.uiPage.flags;return!!(n&e.UIFlags.isStack)&&(!(n&e.UIFlags.isFullScreen)&&!t.isPopupMenuUI(i))},t.isPopupMenuUI=function(t){var i=t.uiPage.flags;return!!(i&e.UIFlags.isStack)&&(!(i&e.UIFlags.isFullScreen)&&!!(i&e.UIFlags.isPopupMenu))},t.isPluginUI=function(t){return!!(t.uiPage.flags&e.UIFlags.isPlugin)},t.isSceneUI=function(t){return!!(t.uiPage.flags&e.UIFlags.isScene)},t}();e.UIHelper=t,__reflect(t.prototype,"fui.UIHelper")}(fui||(fui={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.manager=e,i.entityMap=new xgame.Dictionary,i.stackList=new xgame.List,i}return __extends(i,t),i.prototype.addEntity=function(t){var i=this.entityMap.get(t.name);i||(i=[],this.entityMap.add(t.name,i)),-1==i.indexOf(t)&&(i.push(t),t.uiPage.flags&e.UIFlags.isStack&&this.stackList.add(t))},Object.defineProperty(i.prototype,"stackCount",{get:function(){return this.stackList.count()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"topUI",{get:function(){if(this.stackCount>0)return this.stackList.last()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"topFullScreenUI",{get:function(){for(var t=this.stackCount-1;t>=0;){var i=this.stackList.elementAt(t);if(i.uiPage.flags&e.UIFlags.isFullScreen)return i;t--}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasPopUp",{get:function(){for(var t=this.stackCount-1;t>=0;){var i=this.stackList.elementAt(t);if(e.UIHelper.isWindowUI(i))return!0;t--}return!1},enumerable:!0,configurable:!0}),i.prototype.checkEntities=function(){for(var t=!0,i=!1,n=this.stackCount-1;n>=0;){var o=this.stackList.elementAt(n);t?o.showPage():o.hidePage(),o.uiPage.flags&e.UIFlags.isFullScreen&&(i=!0,t=!1),n--}i?this.hideUIUnderLayers():this.showUIUnderLayers()},i.prototype.hideUIUnderLayers=function(){var t=this;this.manager.uiLayers.forKeys(function(i){if(i>=e.UILayerID.Layer_5_UI)return!0;t.manager.uiLayers.get(i).visible=!1},this)},i.prototype.showUIUnderLayers=function(){var t=this;this.manager.uiLayers.forKeys(function(i){if(i>=e.UILayerID.Layer_5_UI)return!0;t.manager.uiLayers.get(i).visible=!0},this)},i.prototype.removeEntity=function(t){if(this.entityMap.containsKey(t.name)){var i=this.entityMap.get(t.name),n=i.indexOf(t);n>=0&&(i.splice(n,1),t.uiPage.flags&e.UIFlags.isStack&&this.stackList.remove(t))}},i.prototype.tryGetEntities=function(e,t){var i,n,o;if("string"==typeof e){if(i=e,!this.manager.uiMap.containsKey(i))throw new Error("此UI没有注册:{0}".format(i));n=this.manager.uiMap.get(i)}else n=e;if(o=xgame.getQualifiedClassName(n),this.entityMap.containsKey(o)){var a=this.entityMap.get(o);if(a&&a.length)return t&&(t.length=0,t.push.apply(t,a)),!0}return!1},i}(xgame.XObject);e.UIEntityManager=t,__reflect(t.prototype,"fui.UIEntityManager")}(fui||(fui={})),function(e){var t=function(t){function i(i,n){var o=t.call(this)||this;return o.manager=i,o.layerID=n,o.entities=new xgame.List,o.displayObject.name=""+e.UILayerID[n],o.opaque=!1,o.makeFullScreen(),o}return __extends(i,t),Object.defineProperty(i.prototype,"count",{get:function(){return this.entities.count()},enumerable:!0,configurable:!0}),i.prototype.addEntity=function(e){this.entities.contains(e)||this.entities.add(e)},i.prototype.removeEntity=function(e){this.entities.contains(e)&&this.entities.remove(e)},i.prototype.orderToFront=function(e){if(this.entities.contains(e)){this.entities.remove(e);var t=this.numChildren-1;t<0&&(t=0),this.setChildIndex(e.uiPage.view,t),e.mask&&((t=this.numChildren-2)<0&&(t=0),this.setChildIndex(e.mask,t)),this.entities.add(e)}},i}(fairygui.GComponent);e.UILayerManager=t,__reflect(t.prototype,"fui.UILayerManager")}(fui||(fui={})),function(e){e.alert=function(i,n,o,a){var r;return void 0===a&&(a=!0),"string"==typeof i?(r={message:i,title:n,showCloseButton:!0,closeByMask:!0},null!=o&&(Array.isArray(o)?(r.buttons=o,r.closeByMask=a):"number"==typeof o?(r.numButton=o,r.closeByMask=a):"boolean"==typeof o&&(r.closeByMask=o))):r=i,r.callback=new xgame.Signal1,xgame.that.getService(e.IUIManager).openUI(t,r),r.callback};var t=function(t){function i(n){var o=t.call(this,n.packageName||i.defaultPackageName,n.comName||i.defaultComName)||this;return o.options=n,o.clickButtonIndex=void 0,o.options.closeByMask||(o.flags&=~e.UIFlags.closeByMask),o}return __extends(i,t),i.prototype.close=function(){this.options.callback&&this.options.callback.dispatch(this.clickButtonIndex),t.prototype.close.call(this)},i.prototype.onClose=function(){this.options.callback&&this.options.callback.removeAll(),this.options.callback=void 0,this.options.buttons=void 0,t.prototype.onClose.call(this)},i.prototype.getButton=function(e){return this.com_btns.getChild("btn_"+e)},i.prototype.onOpen=function(){var e=this;t.prototype.onOpen.call(this),this.options.width&&(this.view.width=this.options.width),this.options.height&&(this.view.height=this.options.height),this.addClick(this.btn_close,function(){e.close()},this),this.options.showCloseButton||(this.btn_close.visible=!1),this.options.title&&this.com_frame.setTitle(this.options.title),this.lab_content.text=this.options.message;for(var i=[],n=0;;){var o=this.getButton(n);if(!o)break;i.push(o),n++}for(var a=0;a<i.length;a++)i[a].name=a.toString(),this.addClick(i[a],this.onButtonClick,this);if(this.options.buttons&&this.options.buttons.length){for(a=0;a<this.options.buttons.length;a++)i[a].text=this.options.buttons[a];this.buttonsState.selectedIndex=this.options.buttons.length-1}else{var r=this.options.numButton||2;this.buttonsState.selectedIndex=r-1}},i.prototype.onButtonClick=function(e){var t=e.target;this.clickButtonIndex=parseInt(t.name),this.close()},i.defaultPackageName="",i.defaultComName="",i.NAME="Alert",__decorate([e.fairy_ui(),__metadata("design:type",e.PopupFrame)],i.prototype,"com_frame",void 0),__decorate([e.fairy_ui(),__metadata("design:type",fairygui.GRichTextField)],i.prototype,"lab_content",void 0),__decorate([e.fairy_ui(),__metadata("design:type",fairygui.GButton)],i.prototype,"com_btns",void 0),__decorate([e.fairy_ui(),__metadata("design:type",fairygui.GButton)],i.prototype,"btn_close",void 0),__decorate([e.fairy_controller("com_btns/buttonsState"),__metadata("design:type",fairygui.Controller)],i.prototype,"buttonsState",void 0),__decorate([e.inject(e.IUIManager),__metadata("design:type",Object)],i.prototype,"uiManager",void 0),i}(e.Window);e.Alert=t,__reflect(t.prototype,"fui.Alert")}(fui||(fui={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this.lab_title=this.getChild("lab_title").asRichTextField},t.prototype.setTitle=function(e){this.lab_title.text=e},t}(fairygui.GComponent);e.PopupFrame=t,__reflect(t.prototype,"fui.PopupFrame")}(fui||(fui={})),function(e){var t=function(t){function i(n){var o=t.call(this,n.packageName||i.defaultPackageName,n.comName||i.defaultComName)||this;return o.options=n,o.callback_onSelect=new xgame.Signal1,o.arrowPadding=20,n.instance=o,n.offset&&(o.offset.x=n.offset.x,o.offset.y=n.offset.y),null==n.arrowPadding&&(n.arrowPadding=20),null==n.uiDirection&&(n.uiDirection=e.UIDirection.BOTTOM),null==n.uiAlign&&(n.uiAlign=e.UIAlign.CENTER),n.itemHeight=n.itemHeight?n.itemHeight:25,n.itemGap=null!=n.itemGap?n.itemGap:2,n.allowDirections&&n.allowDirections.length&&(o.allowDirections=n.allowDirections),o.$uiDirection=n.uiDirection,o.$uiAlign=n.uiAlign,o.arrowPadding=n.arrowPadding,o}return __extends(i,t),i.toOptions=function(e,t){for(var i={items:[],selected:null==t?0:t},n=0;n<e.length;n++)i.items.push({index:n,title:e[n]});return i},i.prototype.onSelect=function(){return this.options.callback||this.callback_onSelect},i.prototype.fixedUIDirection=function(e){this.updateArrow(e)},i.prototype.onClose=function(){this.onSelect().dispatch(this.selectedItem),this.list_item.removeEventListener(fairygui.ItemEvent.CLICK,this.onItemClickHandler,this),this.options&&(this.options.instance=void 0),t.prototype.onClose.call(this)},i.prototype.onItemClickHandler=function(e){this.selectedItem=e.itemObject.itemData,this.close()},i.prototype.onOpen=function(){t.prototype.onOpen.call(this);var e=this.options;e.width&&(this.view.width=e.width),e.height&&(this.view.height=e.height);var n=this.options.baseHeight||i.defaultBaseHeight;this.options.height||(this.view.height=n+this.options.itemHeight*this.options.items.length),!this.options.width&&this.options.minWidth&&this.view.width<this.options.minWidth&&(this.view.width=this.options.minWidth),this.list_item.addEventListener(fairygui.ItemEvent.CLICK,this.onItemClickHandler,this);for(var o=0;o<e.items.length;o++){var a=e.items[o],r=this.list_item.addItemFromPool();r.setItemData(a),this.list_item.addChild(r)}if(null!=this.options.selected){var s=this.options.selected;s>=0&&(this.list_item.selectedIndex=s)}},i.prototype.updateArrow=function(t){t==e.UIDirection.BOTTOM?this.arrowState.selectedIndex=0:t==e.UIDirection.TOP?this.arrowState.selectedIndex=1:t==e.UIDirection.RIGHT?this.arrowState.selectedIndex=2:t==e.UIDirection.LEFT&&(this.arrowState.selectedIndex=3)},i.NAME="PopupMenu",i.defaultPackageName="",i.defaultComName="",i.defaultBaseHeight=30,__decorate([e.fairy_ui(),__metadata("design:type",fairygui.GList)],i.prototype,"list_item",void 0),__decorate([e.fairy_controller(),__metadata("design:type",fairygui.Controller)],i.prototype,"arrowState",void 0),i}(e.Popup);e.PopupMenu=t,__reflect(t.prototype,"fui.PopupMenu"),e.showPopupMenu=function(i,n){var o;if((o=Array.isArray(n)?t.toOptions(n):n).callback=new xgame.Signal1,o.textAlign)for(var a=0,r=o.items;a<r.length;a++)r[a].textAlign=o.textAlign;return xgame.that.getService(e.IUIManager).openPopup(t,i,o),o.callback}}(fui||(fui={})),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this.lab_title=this.getChild("title").asTextField},t.prototype.setItemData=function(e){this.itemData=e,this.text=e.title,e.textAlign&&this.lab_title&&("center"==e.textAlign?this.lab_title.align=fairygui.AlignType.Center:"left"==e.textAlign?this.lab_title.align=fairygui.AlignType.Left:"right"==e.textAlign&&(this.lab_title.align=fairygui.AlignType.Right))},t}(fairygui.GButton);e.PopupMenuItem=t,__reflect(t.prototype,"fui.PopupMenuItem")}(fui||(fui={})),function(e){var t;!function(e){e[e.FadeIn=1]="FadeIn",e[e.Stay=2]="Stay",e[e.FadeOut=3]="FadeOut"}(t=e.TipsState||(e.TipsState={}));var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.durationFadeIn=500,t.durationStay=1e3,t.durationFadeOut=500,t.durationPosition=500,t.time=0,t.index=0,t}return __extends(i,e),Object.defineProperty(i.prototype,"state",{get:function(){return this.$state},set:function(e){this.$state=e},enumerable:!0,configurable:!0}),i.prototype.release=function(){},i.prototype.dispose=function(){egret.Tween.removeTweens(this)},i.prototype.setMessage=function(e){this.time=this.durationStay,this.state=t.FadeIn,this.y=-this.height/2,this.alpha=0},i.prototype.doFadeIn=function(){var e=this;return new Promise(function(t){var i=e.alpha,n=Math.floor(e.durationFadeIn*(1-i));egret.Tween.get(e).to({alpha:1},n).call(function(){t()},e)})},i.prototype.doFadeOut=function(){var e=this;return new Promise(function(t){var i=e.alpha,n=Math.floor(e.durationFadeOut*i);egret.Tween.get(e).to({alpha:0},n).call(function(){t()},e)})},i.prototype.doStay=function(){var e=this;return new Promise(function(t){egret.Tween.get(e).to({time:0},e.time).call(function(){t()},e)})},i.prototype.playAnimation=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return egret.Tween.removeTweens(this),egret.Tween.get(this).to({y:-this.index*this.height-this.height/2},this.durationPosition),this.state!=t.FadeIn?[3,4]:[4,this.doFadeIn()];case 1:return e.sent(),this.state=t.Stay,[4,this.doStay()];case 2:return e.sent(),this.state=t.FadeOut,[4,this.doFadeOut()];case 3:return e.sent(),[3,9];case 4:return this.state!=t.Stay?[3,7]:[4,this.doStay()];case 5:return e.sent(),this.state=t.FadeOut,[4,this.doFadeOut()];case 6:return e.sent(),[3,9];case 7:return this.state!=t.FadeOut?[3,9]:[4,this.doFadeOut()];case 8:e.sent(),e.label=9;case 9:return[2]}})})},i}(fairygui.GComponent);e.TipsView=i,__reflect(i.prototype,"fui.TipsView",["fui.ITipsView","xgame.IPoolable","xgame.IDisposable","xgame.IXObject"]);var n=function(t){function n(){var e=t.call(this)||this;return e.pools=new xgame.PoolObject(i),e.parallelMax=5,e.waitQueues=[],e}return __extends(n,t),Object.defineProperty(n.prototype,"container",{get:function(){return this.$container},enumerable:!0,configurable:!0}),n.prototype.append=function(e){this.container.numChildren<this.parallelMax?this.play(e):this.waitQueues.push(e)},n.prototype.play=function(e){var t=this,i=this.pools.fetch(function(){return t.fetch()},this);this.container.addChildAt(i,0),i.setMessage(e);for(var n=function(e){var i=o.container.getChildAt(e);i.index=e,egret.Tween.removeTweens(i),i.playAnimation().then(function(){t.endView(i)})},o=this,a=0;a<this.container.numChildren;a++)n(a)},n.prototype.endView=function(e){if(e.parent&&this.container.removeChild(e),e.dispose(),this.pools.recycle(e),this.waitQueues.length>0&&this.container.numChildren<this.parallelMax){var t=this.waitQueues.shift();this.play(t)}},n.prototype.clear=function(){for(;this.container.numChildren;){var e=this.container.removeChildAt(0);e.dispose(),this.pools.recycle(e)}this.waitQueues.length=0},n.prototype.initialize=function(){this.$container=new fairygui.GComponent,this.container.width=this.container.height=1,this.container.touchable=!1,this.container.opaque=!1;var t=xgame.that.getService(e.IUIManager).getLayerManager(e.UILayerID.Layer_12_Toast);t.addChild(this.container),this.container.x=t.width>>1,this.container.y=t.height>>1,this.container.addRelation(t,fairygui.RelationType.Center_Center)},n}(xgame.Singleton);e.TipsManager=n,__reflect(n.prototype,"fui.TipsManager"),e.tips=function(e){n.Instance().append(e)}}(fui||(fui={})),function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.gap=10,t}return __extends(t,e),t}(xgame.XObject);e.UIOptions=t,__reflect(t.prototype,"fui.UIOptions")}(fui||(fui={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.release=function(){},t.prototype.dispose=function(){this.$bitmapData&&this.$bitmapData.$dispose(),this.removeSelf()},t.prototype.removeSelf=function(){this.parent&&this.parent.removeChild(this)},t=__decorate([xgame.impl(xgame.IPoolable)],t)}(egret.Bitmap);e.Bitmap=t,__reflect(t.prototype,"fui.Bitmap",["xgame.IPoolable","xgame.IDisposable","xgame.IXObject"]);var i=function(e){function i(){var i=e.call(this)||this;return i.pools=new xgame.PoolObject(t),i}return __extends(i,e),i.prototype.fetch=function(){return this.pools.fetch(function(){return new t},this)},i.prototype.recycle=function(e){this.pools.recycle(e)},i}(xgame.Singleton);e.BitmapPools=i,__reflect(i.prototype,"fui.BitmapPools")}(fui||(fui={})),function(e){var t=new egret.Rectangle,i=new egret.Rectangle,n=function(){function n(){}return n.placeTipsWithHUD=function(n,o,a){void 0===a&&(a=10);var r=xgame.that.getService(e.IUIManager).stage,s=n.uiDirection,u=n.uiAlign,c=r.stageWidth,h=r.stageHeight;n.view.displayObject.getBounds(i,!0),o.displayObject.getTransformedBounds(n.view.parent.displayObject,t);var l=o.width*o.scaleX,p=o.height*o.scaleY,d=n.view.width,g=n.view.height,f=t.x,y=t.y,m=f+l,v=y+p;n.allowUIDirection(e.UIDirection.BOTTOM)&&(h-v-2*a>=g&&s==e.UIDirection.ANY||s==e.UIDirection.BOTTOM)?(n.view.y=v+a,u==e.UIAlign.LEFT?n.view.x=f:u==e.UIAlign.RIGHT?n.view.x=m-d:n.view.x=f+l/2-d/2,n.fixedUIDirection(e.UIDirection.BOTTOM)):n.allowUIDirection(e.UIDirection.TOP)&&(y-2*a>=g&&s==e.UIDirection.ANY||s==e.UIDirection.TOP)?(n.view.y=y-a-g,u==e.UIAlign.LEFT?n.view.x=f:u==e.UIAlign.RIGHT?n.view.x=m-d:n.view.x=f+l/2-d/2,n.fixedUIDirection(e.UIDirection.TOP)):n.allowUIDirection(e.UIDirection.RIGHT)&&(c-m-2*a>=d&&s==e.UIDirection.ANY||s==e.UIDirection.RIGHT)?(n.view.x=m+a,u==e.UIAlign.TOP?n.view.y=y:u==e.UIAlign.BOTTOM?n.view.y=y+p-g:n.view.y=y+p/2-g/2,n.fixedUIDirection(e.UIDirection.RIGHT)):n.allowUIDirection(e.UIDirection.LEFT)&&(f-2*a>=d&&s==e.UIDirection.ANY||s==e.UIDirection.LEFT)&&(n.view.x=f-a-d,u==e.UIAlign.TOP?n.view.y=y:u==e.UIAlign.BOTTOM?n.view.y=y+p-g:n.view.y=y+p/2-g/2,n.fixedUIDirection(e.UIDirection.LEFT)),n.view.x+=n.offset.x,n.view.y+=n.offset.y,n.view.visible=!0},n}();e.TipsHelper=n,__reflect(n.prototype,"fui.TipsHelper")}(fui||(fui={}));