window.fui={};var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i};window.__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(a,r){function o(e){try{u(n.next(e))}catch(e){r(e)}}function s(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){e.done?a(e.value):new i(function(t){t(e.value)}).then(o,s)}u((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){var i,n,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(a=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(n,r[1])).done)return a;switch(n=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){o.label=r[1];break}if(6===r[0]&&o.label<a[1]){o.label=a[1],a=r;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(r);break}a[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},__decorate=this&&this.__decorate||function(e,t,i,n){var a,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,i,o):a(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){xgame.XGame.prototype.useFGUI=function(t){this.registerServiceProvider(new e.FGUIProvider(t))}}(fui||(fui={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.main=e,i.priority=100,i}return __extends(i,t),i.prototype.onInit=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,!0]})})},i.prototype.onStart=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(i){return t.getService(e.IUIManagerInternal).initialize(),[2,!0]})})},i.prototype.onServiceRegister=function(t){t.singleton(e.IUIManager,e.UIManager).withInstance(new e.UIManager(this.main)).setAlias(e.IUIManagerInternal),console.log("[EgretProvider]: 注册管理器{0}".format(xgame.getQualifiedClassName(e.UIManager)))},i}(xgame.XObject);e.FGUIProvider=t,__reflect(t.prototype,"fui.FGUIProvider",["xgame.IServiceProvider"])}(fui||(fui={})),function(e){e.event=xgame.event}(fui||(fui={})),function(e){function t(e,t,i){switch(i){case"1":return e.getController(t);case"2":return e.getTransition(t);default:return e.getChild(t)}}function i(e,i,n){var a=(i=i.replace(/\./g,"/")).split("/");if(a.length>1){for(var r=a.pop(),o=0;o<a.length;o++){var s=e.getChild(a[o]);if(!s||!s.asCom)return null;e=s.asCom}return t(e,r,n)}return t(e,i,n)}e.fairy_ui=function(e){return function(t,n){Object.defineProperty(t,n,{get:function(){var t=this.view.asCom;return e||(e=n),i(t,e,"0")}})}},e.fairy_controller=function(e){return function(t,n){Object.defineProperty(t,n,{get:function(){var t=this.view.asCom;return e||(e=n),i(t,e,"1")}})}},e.fairy_transition=function(e){return function(t,n){Object.defineProperty(t,n,{get:function(){var t=this.view.asCom;return e||(e=n),i(t,e,"2")}})}}}(fui||(fui={})),function(e){e.impl=xgame.impl}(fui||(fui={})),function(e){e.inject=xgame.inject}(fui||(fui={})),function(e){e.injectable=xgame.injectable}(fui||(fui={})),function(e){e.IUIManager=Symbol.for("fgui.IUIManager")}(fui||(fui={})),function(e){e.IUIManagerInternal=Symbol.for("fgui.IUIManagerInternal")}(fui||(fui={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.main=e,i.pipelines=[],i.uiMap=new xgame.Dictionary,i.uiLayers=new xgame.Dictionary,i.root=fairygui.GRoot.inst,i.onSceneChanged=new xgame.Signal2,i.onUIOpened=new xgame.Signal1,i.onUIClosed=new xgame.Signal1,i.uiPackages=new xgame.Dictionary,i.stage=e.stage,i}return __extends(i,t),Object.defineProperty(i.prototype,"entityManager",{get:function(){return this.$entityManager},enumerable:!0,configurable:!0}),i.prototype.initialize=function(){this.$entityManager=new e.UIEntityManager(this),this.pipelines.push(this.checkIsOpened.bind(this)),this.pipelines.push(this.createUIPage.bind(this)),this.pipelines.push(this.openUIPage.bind(this)),this.root.displayObject.name="FUIRoot",this.main.addChild(this.root.displayObject);for(var t=e.UILayerID.Layer_0_Bottom;t<=e.UILayerID.Layer_15_Top;t++){var i=new e.UILayerManager(this,t);this.root.addChildAt(i,t),i.addRelation(this.root,fairygui.RelationType.Width),i.addRelation(this.root,fairygui.RelationType.Height),this.uiLayers.add(t,i)}this.register(e.Alert.NAME,e.Alert),this.register(e.PopupMenu.NAME,e.PopupMenu),e.TipsManager.Instance().initialize()},i.prototype.getLayerManager=function(e){return this.uiLayers.get(e)},i.prototype.register=function(e,t){this.uiMap.add(e,t)},i.prototype.popUI=function(){return!1},i.prototype.clearScene=function(){this.currentScene&&(this._closeUI(this.$currentScene),this.$currentScene=void 0)},i.prototype.closeUI=function(e){if("string"==typeof e){var t=e,i=[];if(this.$entityManager.tryGetEntities(t,i))for(var n=0,a=i;n<a.length;n++){var r=a[n];this._closeUI(r)}}else this._closeUI(e)},i.prototype._closeUI=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return e.isClosed?[2]:(this.uiLayers.get(e.uiPage.layerID).removeEntity(e),this.$entityManager.removeEntity(e),[4,(t=e.uiPage).doFadeOut()]);case 1:return i.sent(),t.view.parent&&e.uiPage.view.parent.removeChild(e.uiPage.view),e.mask&&e.mask.parent&&e.mask.parent.removeChild(e.mask),this.onUIClosed.dispatch(e),this.$entityManager.checkEntities(),e.onClose(),e.dispose(),e=void 0,[2]}})})},Object.defineProperty(i.prototype,"currentScene",{get:function(){return this.$currentScene},enumerable:!0,configurable:!0}),i.prototype.replaceScene=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,a,r;return __generator(this,function(o){switch(o.label){case 0:if(r=new e.UIOptions,"string"==typeof t){if(n=t,!this.uiMap.containsKey(n))throw new Error("此UI没有注册:{0}".format(n));a=this.uiMap.get(n)}else a=t;return r.uiClass=a,r.openArgs=i,r.name=xgame.getQualifiedClassName(a),this.currentScene&&this.$currentScene.onSceneChanging(),[4,this.startPipelines(r)];case 1:return[2,o.sent()]}})})},i.prototype.openUI=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return __awaiter(this,void 0,void 0,function(){var n,a,r;return __generator(this,function(o){switch(o.label){case 0:if(r=new e.UIOptions,"string"==typeof t){if(n=t,!this.uiMap.containsKey(n))throw new Error("此UI没有注册:{0}".format(n));a=this.uiMap.get(n)}else a=t;return r.uiClass=a,r.openArgs=i,r.name=xgame.getQualifiedClassName(a),[4,this.startPipelines(r)];case 1:return[2,o.sent()]}})})},i.prototype.openUIWithLayer=function(t,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];return __awaiter(this,void 0,void 0,function(){var a,r,o;return __generator(this,function(s){switch(s.label){case 0:if(o=new e.UIOptions,"string"==typeof t){if(a=t,!this.uiMap.containsKey(a))throw new Error("此UI没有注册:{0}".format(a));r=this.uiMap.get(a)}else r=t;return o.uiClass=r,o.layerID=i,o.openArgs=n,o.name=xgame.getQualifiedClassName(r),[4,this.startPipelines(o)];case 1:return[2,s.sent()]}})})},i.prototype.openUIWithRoot=function(t,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];return __awaiter(this,void 0,void 0,function(){var a,r,o;return __generator(this,function(s){switch(s.label){case 0:if(o=new e.UIOptions,"string"==typeof t){if(a=t,!this.uiMap.containsKey(a))throw new Error("此UI没有注册:{0}".format(a));r=this.uiMap.get(a)}else r=t;return o.uiClass=r,o.uiRoot=i,o.openArgs=n,o.name=xgame.getQualifiedClassName(r),[4,this.startPipelines(o)];case 1:return[2,s.sent()]}})})},i.prototype.openPopup=function(t,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];return __awaiter(this,void 0,void 0,function(){var a,r,o;return __generator(this,function(s){switch(s.label){case 0:if(o=new e.UIOptions,"string"==typeof t){if(a=t,!this.uiMap.containsKey(a))throw new Error("此UI没有注册:{0}".format(a));r=this.uiMap.get(a)}else r=t;return o.uiClass=r,o.hud=i,o.openArgs=n,o.name=xgame.getQualifiedClassName(r),[4,this.startPipelines(o)];case 1:return[2,s.sent()]}})})},i.prototype.startPipelines=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(n){switch(n.label){case 0:t=0,i=this.pipelines,n.label=1;case 1:return t<i.length?[4,(0,i[t])(e)]:[3,4];case 2:if(!n.sent())return e.errorMessage&&console.error(e.errorMessage),[2,null];n.label=3;case 3:return t++,[3,1];case 4:return[2,e.entity]}})})},i.prototype.checkIsOpened=function(t){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(a){return i=[],this.$entityManager.tryGetEntities(t.uiClass,i)&&((n=i[0]).uiPage.flags&e.UIFlags.allowMultiple||(t.entity=n)),[2,!0]})})},i.prototype.createUIPage=function(t){return __awaiter(this,void 0,void 0,function(){var i,n,a,r,o,s=this;return __generator(this,function(u){switch(u.label){case 0:return(i=t.entity)?[3,3]:((i=new e.UIEntity).uiManager=this,i.name=t.name,t.entity=i,n=new((o=t.uiClass).bind.apply(o,[void 0].concat(t.openArgs))),xgame.injectInstance(n),n.entity=i,i.uiPage=n,this.$entityManager.addEntity(i),n.onInit(),[4,n.load()]);case 1:return u.sent(),n.view.visible=!1,n.view.displayObject.name=t.name,t.hud&&n.renderWatcher.onChanged().add(function(){egret.callLater(function(){e.TipsHelper.placeTipsWithHUD(n,t.hud,t.gap)},s)},this),t.uiRoot?t.uiRoot.addChild(n.view):(t.layerID&&n.setLayerID(t.layerID),r=this.uiLayers.get(n.layerID),n.flags&e.UIFlags.useMask&&(i.createMask(n.maskColor,n.maskAlpha,n.flags&e.UIFlags.closeByMask),r.addChild(i.mask)),t.hud||n.flags&e.UIFlags.isPlugin||n.flags&e.UIFlags.isPopupMenu||(n.flags&e.UIFlags.isWindow?(n.view.x=this.stage.stageWidth-n.view.width>>1,n.view.y=this.stage.stageHeight-n.view.height>>1,n.view.addRelation(r,fairygui.RelationType.Center_Center)):(n.view.makeFullScreen(),n.view.addRelation(r,fairygui.RelationType.Size))),r.addEntity(i),r.addChild(n.view)),n.onOpen(),[4,xgame.waitEndFrames()];case 2:return u.sent(),t.hud||(n.view.visible=!0),[3,4];case 3:a=i.uiPage,null!=t.layerID&&t.layerID!=a.layerID?((r=this.uiLayers.get(a.layerID)).removeEntity(i),i.mask&&i.mask.parent&&i.mask.parent.removeChild(i.mask),i.uiPage&&i.uiPage.view.parent&&i.uiPage.view.parent.removeChild(i.uiPage.view),(r=this.uiLayers.get(t.layerID)).addEntity(i),i.mask&&r.addChild(i.mask),i.uiPage&&(i.uiPage.setLayerID(t.layerID),r.addChild(i.uiPage.view))):(r=this.uiLayers.get(a.layerID)).orderToFront(i),u.label=4;case 4:return this.$entityManager.checkEntities(),[2,!0]}})})},i.prototype.openUIPage=function(t){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(a){switch(a.label){case 0:return(i=t.entity)?(n=i.uiPage).isLoaded?n.flags&e.UIFlags.isScene?this.currentScene?(this.onSceneChanged.dispatch(i,this.currentScene),[4,this._closeUI(this.$currentScene)]):[3,2]:[3,3]:(t.errorMessage="UIPage:{0}还没有加载完成".format(t.name),[2,!1]):(t.errorMessage="UIEntity:{0}不能为空".format(t.name),[2,!1]);case 1:a.sent(),a.label=2;case 2:this.$currentScene=i,a.label=3;case 3:return[4,n.doFadeIn()];case 4:return a.sent(),this.onUIOpened.dispatch(i),[2,!0]}})})},i.prototype.loadPackage=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return this.uiPackages.containsKey(e)?[2]:[4,fairygui.UIPackage.loadPackage(e)];case 1:return t=i.sent(),this.uiPackages.set(e,t),[2]}})})},i.prototype.createObject=function(e,t,i){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(a){switch(a.label){case 0:return(n=this.uiPackages.get(e))?[3,2]:[4,this.loadPackage(e)];case 1:a.sent(),n=this.uiPackages.get(e),a.label=2;case 2:return[2,n.createObject(t,i)]}})})},i=__decorate([e.impl(e.IUIManager,e.IUIManagerInternal),__metadata("design:paramtypes",[egret.DisplayObjectContainer])],i)}(xgame.XObject);e.UIManager=t,__reflect(t.prototype,"fui.UIManager",["fui.IUIManager","xgame.IXObject","fui.IUIManagerInternal"])}(fui||(fui={})),function(e){!function(e){e[e.CENTER=0]="CENTER",e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT"}(e.UIAlign||(e.UIAlign={}))}(fui||(fui={})),function(e){!function(e){e[e.ANY=0]="ANY",e[e.TOP=1]="TOP",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT",e[e.RIGHT=4]="RIGHT"}(e.UIDirection||(e.UIDirection={}))}(fui||(fui={})),function(e){var t=function(t){function i(i,n,a){var r=t.call(this)||this;return r.packageName=i,r.comName=n,r.userClass=a,r.flags=e.UIFlags.isStack|e.UIFlags.isFullScreen,r.guideValues=new xgame.Dictionary,r.onComplete=new xgame.Signal0,r.$isLoaded=!1,r.$isLoading=!1,r.deferred=new xgame.Deferred,r.$maskAlpha=.3,r.$maskColor=3355443,r.$layerID=e.UILayerID.Layer_5_UI,r}return __extends(i,t),Object.defineProperty(i.prototype,"view",{get:function(){return this.$view},enumerable:!0,configurable:!0}),i.prototype.addClick=function(e,t,i){e.addClickListener(t,i)},i.prototype.injectGuideValue=function(e,t,i){this.guideManager.injectValue(e,t,i),this.guideValues.add(e,i||0)},Object.defineProperty(i.prototype,"isLoaded",{get:function(){return this.$isLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isLoading",{get:function(){return this.$isLoading},enumerable:!0,configurable:!0}),i.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this.$isLoading=!0,!this.packageName||this.isLoaded?[3,5]:[4,this.uiManager.loadPackage(this.packageName)];case 1:return t.sent(),this.comName?(e=this,[4,this.uiManager.createObject(this.packageName,this.comName,this.userClass)]):[3,3];case 2:return e.$view=t.sent(),this.doComplete(),[3,4];case 3:this.doComplete(),t.label=4;case 4:return[3,6];case 5:this.doComplete(),t.label=6;case 6:return[2,this.deferred.promise]}})})},i.prototype.doComplete=function(){var e=this;this.$view||(this.$view=new fairygui.GComponent),egret.callLater(function(){e.$isLoaded=!0,e.onComplete.dispatch(),e.deferred.resolve()},this)},Object.defineProperty(i.prototype,"maskAlpha",{get:function(){return this.$maskAlpha},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maskColor",{get:function(){return this.$maskColor},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layerID",{get:function(){return this.$layerID},enumerable:!0,configurable:!0}),i.prototype.setLayerID=function(e){this.$layerID=e},i.prototype.onInit=function(){this.addEventObserves&&this.addEventObserves()},i.prototype.onOpen=function(){},i.prototype.onSceneChanging=function(){},i.prototype.onClose=function(){var e=this;this.guideValues.length&&(this.guideValues.forKeys(function(t){var i=e.guideValues.get(t);e.guideManager.removeValue(t,i)},this),this.guideValues.clear());this.removeEventObserves&&this.removeEventObserves(),this.entity=void 0},i.prototype.onShow=function(){},i.prototype.onHide=function(){},i.prototype.close=function(){this.entity&&this.entity.closePage()},i.prototype.doFadeIn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},i.prototype.doFadeOut=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},__decorate([e.inject(e.IUIManager),__metadata("design:type",Object)],i.prototype,"uiManager",void 0),__decorate([e.inject(egretx.IGuideManager),__metadata("design:type",Object)],i.prototype,"guideManager",void 0),i}(xgame.XObject);e.UIPage=t,__reflect(t.prototype,"fui.UIPage")}(fui||(fui={})),function(e){!function(e){e[e.None=0]="None",e[e.useMask=1]="useMask",e[e.isStack=2]="isStack",e[e.isFullScreen=4]="isFullScreen",e[e.allowMultiple=8]="allowMultiple",e[e.closeByMask=16]="closeByMask",e[e.isPopupMenu=32]="isPopupMenu",e[e.isPlugin=64]="isPlugin",e[e.isScene=128]="isScene",e[e.isWindow=256]="isWindow"}(e.UIFlags||(e.UIFlags={}))}(fui||(fui={})),function(e){var t=function(t){function i(i,n,a){var r=t.call(this,i,n,a)||this;return r.flags=e.UIFlags.isPlugin,r}return __extends(i,t),i}(e.UIPage);e.PluginPage=t,__reflect(t.prototype,"fui.PluginPage")}(fui||(fui={})),function(e){var t=function(t){function i(i,n,a){var r=t.call(this,i,n,a)||this;return r.flags=e.UIFlags.isStack|e.UIFlags.isWindow|e.UIFlags.useMask|e.UIFlags.closeByMask,r.setLayerID(e.UILayerID.Layer_8_Window),r}return __extends(i,t),i}(e.UIPage);e.Window=t,__reflect(t.prototype,"fui.Window")}(fui||(fui={})),function(e){!function(e){e[e.Layer_0_Bottom=0]="Layer_0_Bottom",e[e.Layer_1=1]="Layer_1",e[e.Layer_2_Scene=2]="Layer_2_Scene",e[e.Layer_3_SceneMask=3]="Layer_3_SceneMask",e[e.Layer_4_SceneFrame=4]="Layer_4_SceneFrame",e[e.Layer_5_UI=5]="Layer_5_UI",e[e.Layer_6_UIMask=6]="Layer_6_UIMask",e[e.Layer_7_UIFrame=7]="Layer_7_UIFrame",e[e.Layer_8_Window=8]="Layer_8_Window",e[e.Layer_9=9]="Layer_9",e[e.Layer_10_Popup=10]="Layer_10_Popup",e[e.Layer_11_Guide=11]="Layer_11_Guide",e[e.Layer_12_Toast=12]="Layer_12_Toast",e[e.Layer_13_Loading=13]="Layer_13_Loading",e[e.Layer_14=14]="Layer_14",e[e.Layer_15_Top=15]="Layer_15_Top"}(e.UILayerID||(e.UILayerID={}))}(fui||(fui={})),function(e){var t=function(e){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=e.call(this)||this;n.views=new xgame.Dictionary,n.callback_onChanged=new xgame.Signal0,n.isDispatching=!1;for(var a=0,r=t;a<r.length;a++){var o=r[a];n.addWatcher(o)}return n}return __extends(t,e),t.prototype.addWatcher=function(e){this.views.containsKey(e.hashCode)||(this.views.add(e.hashCode,e),e.addEventListener(fairygui.GObject.SIZE_CHANGED,this.onWatcher,this),this.onWatcher())},t.prototype.removeWatcher=function(e){this.views.containsKey(e.hashCode)&&(e.removeEventListener(fairygui.GObject.SIZE_CHANGED,this.onWatcher,this),this.views.remove(e.hashCode))},t.prototype.onWatcher=function(){this.lateDispatch()},t.prototype.lateDispatch=function(){var e=this;this.isDispatching||(this.isDispatching=!0,egret.callLater(function(){e.callback_onChanged.dispatch(),e.isDispatching=!1},this))},t.prototype.onChanged=function(){return this.callback_onChanged},t.prototype.dispose=function(){var e=this;this.callback_onChanged.removeAll(),this.views.clear(function(t){t.removeEventListener(fairygui.GObject.SIZE_CHANGED,e.onWatcher,e)})},t}(xgame.XObject);e.RenderWatcher=t,__reflect(t.prototype,"fui.RenderWatcher");var i=function(i){function n(n,a,r){var o=i.call(this,n,a,r)||this;return o.renderWatcher=new t,o.offset=new egret.Point,o.$uiDirection=e.UIDirection.ANY,o.$uiAlign=e.UIAlign.CENTER,o.flags=e.UIFlags.isStack|e.UIFlags.isPopupMenu|e.UIFlags.useMask|e.UIFlags.closeByMask|e.UIFlags.allowMultiple,o.setLayerID(e.UILayerID.Layer_10_Popup),o.$maskAlpha=0,o}return __extends(n,i),Object.defineProperty(n.prototype,"uiDirection",{get:function(){return this.$uiDirection},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"uiAlign",{get:function(){return this.$uiAlign},enumerable:!0,configurable:!0}),n.prototype.allowUIDirection=function(e){return!this.allowDirections||!this.allowDirections.length||this.allowDirections.indexOf(e)>=0},n.prototype.fixedUIDirection=function(e){},n.prototype.onOpen=function(){this.renderWatcher.addWatcher(this.view),i.prototype.onOpen.call(this)},n.prototype.onClose=function(){this.renderWatcher&&this.renderWatcher.dispose(),i.prototype.onClose.call(this)},n}(e.UIPage);e.Popup=i,__reflect(i.prototype,"fui.Popup")}(fui||(fui={})),function(e){var t=function(t){function i(i,n,a){var r=t.call(this,i,n,a)||this;return r.flags=e.UIFlags.isScene|e.UIFlags.isFullScreen,r.setLayerID(e.UILayerID.Layer_2_Scene),r}return __extends(i,t),i}(e.UIPage);e.Scene=t,__reflect(t.prototype,"fui.Scene")}(fui||(fui={})),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"isClosed",{get:function(){return this.$isClosed},enumerable:!0,configurable:!0}),t.prototype.createMask=function(e,t,i){this.mask||(this.mask=new fairygui.GGraph,this.mask.drawRect(0,0,0,0,t),this.mask.makeFullScreen(),i&&this.mask.addClickListener(this.onMaskClose,this))},t.prototype.onMaskClose=function(){this.mask.removeClickListener(this.onMaskClose,this),this.closePage()},t.prototype.onSceneChanging=function(){this.uiPage&&this.uiPage.onSceneChanging()},t.prototype.onClose=function(){this.$isClosed=!0,this.uiPage&&this.uiPage.onClose()},t.prototype.closePage=function(){this.uiManager&&this.uiManager.closeUI(this)},t.prototype.showPage=function(){this.uiPage&&this.uiPage.view&&(this.uiPage.view.visible=!0)},t.prototype.hidePage=function(){this.uiPage&&this.uiPage.view&&(this.uiPage.view.visible=!1)},t.prototype.dispose=function(){this.mask&&this.mask.removeClickListener(this.onMaskClose,this),this.uiPage=void 0,this.mask=void 0},t}(xgame.XObject);e.UIEntity=t,__reflect(t.prototype,"fui.UIEntity",["fui.IUIEntity","xgame.IDisposable","xgame.IXObject"])}(fui||(fui={})),function(e){var t=function(){function t(){}return t.isFullScreenUI=function(t){var i=t.uiPage.flags;return!!(i&e.UIFlags.isStack)&&!!(i&e.UIFlags.isFullScreen)},t.isWindowUI=function(i){var n=i.uiPage.flags;return!!(n&e.UIFlags.isStack)&&(!(n&e.UIFlags.isFullScreen)&&!t.isPopupMenuUI(i))},t.isPopupMenuUI=function(t){var i=t.uiPage.flags;return!!(i&e.UIFlags.isStack)&&(!(i&e.UIFlags.isFullScreen)&&!!(i&e.UIFlags.isPopupMenu))},t.isPluginUI=function(t){return!!(t.uiPage.flags&e.UIFlags.isPlugin)},t.isSceneUI=function(t){return!!(t.uiPage.flags&e.UIFlags.isScene)},t}();e.UIHelper=t,__reflect(t.prototype,"fui.UIHelper")}(fui||(fui={})),function(e){var t=function(t){function i(e){var i=t.call(this)||this;return i.manager=e,i.entityMap=new xgame.Dictionary,i.stackList=new xgame.List,i}return __extends(i,t),i.prototype.addEntity=function(t){var i=this.entityMap.get(t.name);i||(i=[],this.entityMap.add(t.name,i)),-1==i.indexOf(t)&&(i.push(t),t.uiPage.flags&e.UIFlags.isStack&&this.stackList.add(t))},Object.defineProperty(i.prototype,"stackCount",{get:function(){return this.stackList.count()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"topUI",{get:function(){if(this.stackCount>0)return this.stackList.last()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"topFullScreenUI",{get:function(){for(var t=this.stackCount-1;t>=0;){var i=this.stackList.elementAt(t);if(i.uiPage.flags&e.UIFlags.isFullScreen)return i;t--}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasPopUp",{get:function(){for(var t=this.stackCount-1;t>=0;){var i=this.stackList.elementAt(t);if(e.UIHelper.isWindowUI(i))return!0;t--}return!1},enumerable:!0,configurable:!0}),i.prototype.checkEntities=function(){for(var t=!0,i=!1,n=this.stackCount-1;n>=0;){var a=this.stackList.elementAt(n);t?a.showPage():a.hidePage(),a.uiPage.flags&e.UIFlags.isFullScreen&&(i=!0,t=!1),n--}i?this.hideUIUnderLayers():this.showUIUnderLayers()},i.prototype.hideUIUnderLayers=function(){var t=this;this.manager.uiLayers.forKeys(function(i){if(i>=e.UILayerID.Layer_5_UI)return!0;t.manager.uiLayers.get(i).visible=!1},this)},i.prototype.showUIUnderLayers=function(){var t=this;this.manager.uiLayers.forKeys(function(i){if(i>=e.UILayerID.Layer_5_UI)return!0;t.manager.uiLayers.get(i).visible=!0},this)},i.prototype.removeEntity=function(t){if(this.entityMap.containsKey(t.name)){var i=this.entityMap.get(t.name),n=i.indexOf(t);n>=0&&(i.splice(n,1),t.uiPage.flags&e.UIFlags.isStack&&this.stackList.remove(t))}},i.prototype.tryGetEntities=function(e,t){var i,n,a;if("string"==typeof e){if(i=e,!this.manager.uiMap.containsKey(i))throw new Error("此UI没有注册:{0}".format(i));n=this.manager.uiMap.get(i)}else n=e;if(a=xgame.getQualifiedClassName(n),this.entityMap.containsKey(a)){var r=this.entityMap.get(a);if(r&&r.length)return t&&(t.length=0,t.push.apply(t,r)),!0}return!1},i}(xgame.XObject);e.UIEntityManager=t,__reflect(t.prototype,"fui.UIEntityManager")}(fui||(fui={})),function(e){var t=function(t){function i(i,n){var a=t.call(this)||this;return a.manager=i,a.layerID=n,a.entities=new xgame.List,a.displayObject.name=""+e.UILayerID[n],a.opaque=!1,a.makeFullScreen(),a}return __extends(i,t),Object.defineProperty(i.prototype,"count",{get:function(){return this.entities.count()},enumerable:!0,configurable:!0}),i.prototype.addEntity=function(e){this.entities.contains(e)||this.entities.add(e)},i.prototype.removeEntity=function(e){this.entities.contains(e)&&this.entities.remove(e)},i.prototype.orderToFront=function(e){if(this.entities.contains(e)){this.entities.remove(e);var t=this.numChildren-1;t<0&&(t=0),this.setChildIndex(e.uiPage.view,t),e.mask&&((t=this.numChildren-2)<0&&(t=0),this.setChildIndex(e.mask,t)),this.entities.add(e)}},i}(fairygui.GComponent);e.UILayerManager=t,__reflect(t.prototype,"fui.UILayerManager")}(fui||(fui={})),function(e){e.alert=function(i,n,a,r){var o;return void 0===r&&(r=!0),"string"==typeof i?(o={message:i,title:n,showCloseButton:!0,closeByMask:!0},null!=a&&(Array.isArray(a)?(o.buttons=a,o.closeByMask=r):"number"==typeof a?(o.numButton=a,o.closeByMask=r):"boolean"==typeof a&&(o.closeByMask=a))):o=i,o.callback=new xgame.Signal1,xgame.that.getService(e.IUIManager).openUI(t,o),o.callback};var t=function(t){function i(n){var a=t.call(this,n.packageName||i.defaultPackageName,n.comName||i.defaultComName)||this;return a.options=n,a.clickButtonIndex=void 0,a.options.closeByMask||(a.flags&=~e.UIFlags.closeByMask),a}return __extends(i,t),i.prototype.close=function(){this.options.callback&&this.options.callback.dispatch(this.clickButtonIndex),t.prototype.close.call(this)},i.prototype.onClose=function(){this.options.callback&&this.options.callback.removeAll(),this.options.callback=void 0,this.options.buttons=void 0,t.prototype.onClose.call(this)},i.prototype.getButton=function(e){return this.com_btns.getChild("btn_"+e)},i.prototype.onOpen=function(){var e=this;t.prototype.onOpen.call(this),this.options.width&&(this.view.width=this.options.width),this.options.height&&(this.view.height=this.options.height),this.addClick(this.btn_close,function(){e.close()},this),this.options.showCloseButton||(this.btn_close.visible=!1),this.options.title&&this.com_frame.setTitle(this.options.title),this.lab_content.text=this.options.message;for(var i=[],n=0;;){var a=this.getButton(n);if(!a)break;i.push(a),n++}for(var r=0;r<i.length;r++)i[r].name=r.toString(),this.addClick(i[r],this.onButtonClick,this);if(this.options.buttons&&this.options.buttons.length){for(r=0;r<this.options.buttons.length;r++)i[r].text=this.options.buttons[r];this.buttonsState.selectedIndex=this.options.buttons.length-1}else{var o=this.options.numButton||2;this.buttonsState.selectedIndex=o-1}},i.prototype.onButtonClick=function(e){var t=e.target;this.clickButtonIndex=parseInt(t.name),this.close()},i.defaultPackageName="",i.defaultComName="",i.NAME="Alert",__decorate([e.fairy_ui(),__metadata("design:type",e.PopupFrame)],i.prototype,"com_frame",void 0),__decorate([e.fairy_ui(),__metadata("design:type",fairygui.GRichTextField)],i.prototype,"lab_content",void 0),__decorate([e.fairy_ui(),__metadata("design:type",fairygui.GButton)],i.prototype,"com_btns",void 0),__decorate([e.fairy_ui(),__metadata("design:type",fairygui.GButton)],i.prototype,"btn_close",void 0),__decorate([e.fairy_controller("com_btns/buttonsState"),__metadata("design:type",fairygui.Controller)],i.prototype,"buttonsState",void 0),__decorate([e.inject(e.IUIManager),__metadata("design:type",Object)],i.prototype,"uiManager",void 0),i}(e.Window);e.Alert=t,__reflect(t.prototype,"fui.Alert")}(fui||(fui={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this.lab_title=this.getChild("lab_title").asRichTextField},t.prototype.setTitle=function(e){this.lab_title.text=e},t}(fairygui.GComponent);e.PopupFrame=t,__reflect(t.prototype,"fui.PopupFrame")}(fui||(fui={})),function(e){var t=function(t){function i(n){var a=t.call(this,n.packageName||i.defaultPackageName,n.comName||i.defaultComName)||this;return a.options=n,a.callback_onSelect=new xgame.Signal1,a.arrowPadding=20,n.instance=a,n.offset&&(a.offset.x=n.offset.x,a.offset.y=n.offset.y),null==n.arrowPadding&&(n.arrowPadding=20),null==n.uiDirection&&(n.uiDirection=e.UIDirection.BOTTOM),null==n.uiAlign&&(n.uiAlign=e.UIAlign.CENTER),n.itemHeight=n.itemHeight?n.itemHeight:25,n.itemGap=null!=n.itemGap?n.itemGap:2,n.allowDirections&&n.allowDirections.length&&(a.allowDirections=n.allowDirections),a.$uiDirection=n.uiDirection,a.$uiAlign=n.uiAlign,a.arrowPadding=n.arrowPadding,a}return __extends(i,t),i.toOptions=function(e,t){for(var i={items:[],selected:null==t?0:t},n=0;n<e.length;n++)i.items.push({index:n,title:e[n]});return i},i.prototype.onSelect=function(){return this.options.callback||this.callback_onSelect},i.prototype.fixedUIDirection=function(e){this.updateArrow(e)},i.prototype.onClose=function(){this.onSelect().dispatch(this.selectedItem),this.list_item.removeEventListener(fairygui.ItemEvent.CLICK,this.onItemClickHandler,this),this.options&&(this.options.instance=void 0),t.prototype.onClose.call(this)},i.prototype.onItemClickHandler=function(e){this.selectedItem=e.itemObject.itemData,this.close()},i.prototype.onOpen=function(){t.prototype.onOpen.call(this);var e=this.options;e.width&&(this.view.width=e.width),e.height&&(this.view.height=e.height);var n=this.options.baseHeight||i.defaultBaseHeight;this.options.height||(this.view.height=n+this.options.itemHeight*this.options.items.length),!this.options.width&&this.options.minWidth&&this.view.width<this.options.minWidth&&(this.view.width=this.options.minWidth),this.list_item.addEventListener(fairygui.ItemEvent.CLICK,this.onItemClickHandler,this);for(var a=0;a<e.items.length;a++){var r=e.items[a],o=this.list_item.addItemFromPool();o.setItemData(r),this.list_item.addChild(o)}if(null!=this.options.selected){var s=this.options.selected;s>=0&&(this.list_item.selectedIndex=s)}},i.prototype.updateArrow=function(t){t==e.UIDirection.BOTTOM?this.arrowState.selectedIndex=0:t==e.UIDirection.TOP?this.arrowState.selectedIndex=1:t==e.UIDirection.RIGHT?this.arrowState.selectedIndex=2:t==e.UIDirection.LEFT&&(this.arrowState.selectedIndex=3)},i.NAME="PopupMenu",i.defaultPackageName="",i.defaultComName="",i.defaultBaseHeight=30,__decorate([e.fairy_ui(),__metadata("design:type",fairygui.GList)],i.prototype,"list_item",void 0),__decorate([e.fairy_controller(),__metadata("design:type",fairygui.Controller)],i.prototype,"arrowState",void 0),i}(e.Popup);e.PopupMenu=t,__reflect(t.prototype,"fui.PopupMenu"),e.showPopupMenu=function(i,n){var a;if((a=Array.isArray(n)?t.toOptions(n):n).callback=new xgame.Signal1,a.textAlign)for(var r=0,o=a.items;r<o.length;r++)o[r].textAlign=a.textAlign;return xgame.that.getService(e.IUIManager).openPopup(t,i,a),a.callback}}(fui||(fui={})),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.constructFromXML=function(t){e.prototype.constructFromXML.call(this,t),this.lab_title=this.getChild("title").asTextField},t.prototype.setItemData=function(e){this.itemData=e,this.text=e.title,e.textAlign&&this.lab_title&&("center"==e.textAlign?this.lab_title.align=fairygui.AlignType.Center:"left"==e.textAlign?this.lab_title.align=fairygui.AlignType.Left:"right"==e.textAlign&&(this.lab_title.align=fairygui.AlignType.Right))},t}(fairygui.GButton);e.PopupMenuItem=t,__reflect(t.prototype,"fui.PopupMenuItem")}(fui||(fui={})),function(e){var t;!function(e){e[e.FadeIn=1]="FadeIn",e[e.Stay=2]="Stay",e[e.FadeOut=3]="FadeOut"}(t=e.TipsState||(e.TipsState={}));var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.durationFadeIn=500,t.durationStay=1e3,t.durationFadeOut=500,t.durationPosition=500,t.time=0,t.index=0,t}return __extends(i,e),Object.defineProperty(i.prototype,"state",{get:function(){return this.$state},set:function(e){this.$state=e},enumerable:!0,configurable:!0}),i.prototype.release=function(){},i.prototype.dispose=function(){egret.Tween.removeTweens(this)},i.prototype.setMessage=function(e){this.time=this.durationStay,this.state=t.FadeIn,this.y=-this.height/2,this.alpha=0},i.prototype.doFadeIn=function(){var e=this;return new Promise(function(t){var i=e.alpha,n=Math.floor(e.durationFadeIn*(1-i));egret.Tween.get(e).to({alpha:1},n).call(function(){t()},e)})},i.prototype.doFadeOut=function(){var e=this;return new Promise(function(t){var i=e.alpha,n=Math.floor(e.durationFadeOut*i);egret.Tween.get(e).to({alpha:0},n).call(function(){t()},e)})},i.prototype.doStay=function(){var e=this;return new Promise(function(t){egret.Tween.get(e).to({time:0},e.time).call(function(){t()},e)})},i.prototype.playAnimation=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return egret.Tween.removeTweens(this),egret.Tween.get(this).to({y:-this.index*this.height-this.height/2},this.durationPosition),this.state!=t.FadeIn?[3,4]:[4,this.doFadeIn()];case 1:return e.sent(),this.state=t.Stay,[4,this.doStay()];case 2:return e.sent(),this.state=t.FadeOut,[4,this.doFadeOut()];case 3:return e.sent(),[3,9];case 4:return this.state!=t.Stay?[3,7]:[4,this.doStay()];case 5:return e.sent(),this.state=t.FadeOut,[4,this.doFadeOut()];case 6:return e.sent(),[3,9];case 7:return this.state!=t.FadeOut?[3,9]:[4,this.doFadeOut()];case 8:e.sent(),e.label=9;case 9:return[2]}})})},i}(fairygui.GComponent);e.TipsView=i,__reflect(i.prototype,"fui.TipsView",["fui.ITipsView","xgame.IPoolable","xgame.IDisposable","xgame.IXObject"]);var n=function(t){function n(){var e=t.call(this)||this;return e.pools=new xgame.PoolObject(i),e.parallelMax=5,e.waitQueues=[],e}return __extends(n,t),Object.defineProperty(n.prototype,"container",{get:function(){return this.$container},enumerable:!0,configurable:!0}),n.prototype.append=function(e){this.container.numChildren<this.parallelMax?this.play(e):this.waitQueues.push(e)},n.prototype.play=function(e){var t=this,i=this.pools.fetch(function(){return t.fetch()},this);this.container.addChildAt(i,0),i.setMessage(e);for(var n=function(e){var i=a.container.getChildAt(e);i.index=e,egret.Tween.removeTweens(i),i.playAnimation().then(function(){t.endView(i)})},a=this,r=0;r<this.container.numChildren;r++)n(r)},n.prototype.endView=function(e){if(e.parent&&this.container.removeChild(e),e.dispose(),this.pools.recycle(e),this.waitQueues.length>0&&this.container.numChildren<this.parallelMax){var t=this.waitQueues.shift();this.play(t)}},n.prototype.clear=function(){for(;this.container.numChildren;){var e=this.container.removeChildAt(0);e.dispose(),this.pools.recycle(e)}this.waitQueues.length=0},n.prototype.initialize=function(){this.$container=new fairygui.GComponent,this.container.width=this.container.height=1,this.container.touchable=!1,this.container.opaque=!1;var t=xgame.that.getService(e.IUIManager).getLayerManager(e.UILayerID.Layer_12_Toast);t.addChild(this.container),this.container.x=t.width>>1,this.container.y=t.height>>1,this.container.addRelation(t,fairygui.RelationType.Center_Center)},n}(xgame.Singleton);e.TipsManager=n,__reflect(n.prototype,"fui.TipsManager"),e.tips=function(e){n.Instance().append(e)}}(fui||(fui={})),function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.gap=10,t}return __extends(t,e),t}(xgame.XObject);e.UIOptions=t,__reflect(t.prototype,"fui.UIOptions")}(fui||(fui={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.release=function(){},t.prototype.dispose=function(){this.$bitmapData&&this.$bitmapData.$dispose(),this.removeSelf()},t.prototype.removeSelf=function(){this.parent&&this.parent.removeChild(this)},t=__decorate([xgame.impl(xgame.IPoolable)],t)}(egret.Bitmap);e.Bitmap=t,__reflect(t.prototype,"fui.Bitmap",["xgame.IPoolable","xgame.IDisposable","xgame.IXObject"]);var i=function(e){function i(){var i=e.call(this)||this;return i.pools=new xgame.PoolObject(t),i}return __extends(i,e),i.prototype.fetch=function(){return this.pools.fetch(function(){return new t},this)},i.prototype.recycle=function(e){this.pools.recycle(e)},i}(xgame.Singleton);e.BitmapPools=i,__reflect(i.prototype,"fui.BitmapPools")}(fui||(fui={})),function(e){var t=new egret.Rectangle,i=new egret.Rectangle,n=function(){function n(){}return n.placeTipsWithHUD=function(n,a,r){void 0===r&&(r=10);var o=xgame.that.getService(e.IUIManager).stage,s=n.uiDirection,u=n.uiAlign,c=o.stageWidth,l=o.stageHeight;n.view.displayObject.getBounds(i,!0),a.displayObject.getTransformedBounds(n.view.parent.displayObject,t);var h=a.width*a.scaleX,p=a.height*a.scaleY,f=n.view.width,g=n.view.height,d=t.x,y=t.y,_=d+h,m=y+p;n.allowUIDirection(e.UIDirection.BOTTOM)&&(l-m-2*r>=g&&s==e.UIDirection.ANY||s==e.UIDirection.BOTTOM)?(n.view.y=m+r,u==e.UIAlign.LEFT?n.view.x=d:u==e.UIAlign.RIGHT?n.view.x=_-f:n.view.x=d+h/2-f/2,n.fixedUIDirection(e.UIDirection.BOTTOM)):n.allowUIDirection(e.UIDirection.TOP)&&(y-2*r>=g&&s==e.UIDirection.ANY||s==e.UIDirection.TOP)?(n.view.y=y-r-g,u==e.UIAlign.LEFT?n.view.x=d:u==e.UIAlign.RIGHT?n.view.x=_-f:n.view.x=d+h/2-f/2,n.fixedUIDirection(e.UIDirection.TOP)):n.allowUIDirection(e.UIDirection.RIGHT)&&(c-_-2*r>=f&&s==e.UIDirection.ANY||s==e.UIDirection.RIGHT)?(n.view.x=_+r,u==e.UIAlign.TOP?n.view.y=y:u==e.UIAlign.BOTTOM?n.view.y=y+p-g:n.view.y=y+p/2-g/2,n.fixedUIDirection(e.UIDirection.RIGHT)):n.allowUIDirection(e.UIDirection.LEFT)&&(d-2*r>=f&&s==e.UIDirection.ANY||s==e.UIDirection.LEFT)&&(n.view.x=d-r-f,u==e.UIAlign.TOP?n.view.y=y:u==e.UIAlign.BOTTOM?n.view.y=y+p-g:n.view.y=y+p/2-g/2,n.fixedUIDirection(e.UIDirection.LEFT)),n.view.x+=n.offset.x,n.view.y+=n.offset.y,n.view.visible=!0},n}();e.TipsHelper=n,__reflect(n.prototype,"fui.TipsHelper")}(fui||(fui={}));